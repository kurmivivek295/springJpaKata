<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content=":docInfo1">
<title>JPA/Hibernate camp</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>JPA/Hibernate camp</h1>
<div class="details">
<span id="author" class="author">:docInfo1</span><br>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_o_mnie">1. O mnie</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Architect Solution - RiscoSoftware</p>
</li>
<li>
<p>JavaTech trener : Spring ekosystem, JPA , EIP Camel</p>
</li>
<li>
<p>Sages trener : JPA , EIP - Apache Camel</p>
</li>
<li>
<p>blog <a href="http://przewidywalna-java.blogspot.com" class="bare">http://przewidywalna-java.blogspot.com</a></p>
</li>
<li>
<p>twitter przodownikR1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image img-circle"><img src="https://pbs.twimg.com/profile_images/425289501980639233/tUWf7KiC.jpeg " alt="tUWf7KiC"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Źródła_wiedzy">2. Źródła wiedzy</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Hibernate in Action</p>
</li>
<li>
<p>Java Persistence with Hibernate</p>
</li>
<li>
<p>Java JEE 6</p>
</li>
<li>
<p>Pro JPA 2</p>
</li>
<li>
<p>Pro JPA 2: Mastering the Java&#8482; Persistence API (Expert&#8217;s Voice in Java Technology)</p>
</li>
<li>
<p>Hibernate from Novice to Professional</p>
</li>
<li>
<p>Spring Data Modern Data Access for Enterprise Java</p>
</li>
<li>
<p>Spring Data</p>
</li>
<li>
<p>Spring Boot</p>
</li>
<li>
<p>Spring Essentials</p>
</li>
<li>
<p>Spring in Action</p>
</li>
<li>
<p>etc</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hibernate_jpa">3. Hibernate / JPA</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_co_to_jest_w_ogóle_jest">4. Co to jest w ogóle jest :) ?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>najpopularniejsza implementacja odwzorowania</p>
</li>
<li>
<p>jedna z implemetacji standardu <strong>JPA</strong></p>
</li>
<li>
<p>obsługa asociacji, kompozycji, dziedziczenia, polimorfizmu</p>
</li>
<li>
<p>wysoka wydajność i skalowalność (dwuwarstwowy cache i wparcie dla clusteringu ) (<strong>Hibernate Shards</strong>)</p>
</li>
<li>
<p>wiele sposobów tworzenia i wydawania zapytań</p>
</li>
<li>
<p>nakładka na <strong>JDBC</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architektura">5. Architektura</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/data_access_layers.svg" alt="data access layers">
</div>
</div>
<div class="sect2">
<h3 id="_zasada_działania">5.1. Zasada działania</h3>
<div class="imageblock">
<div class="content">
<img src="img/ORM-jdbc.jpg" alt="ORM jdbc">
</div>
</div>
<div class="sect3">
<h4 id="_zalety">5.1.1. Zalety</h4>
<div class="paragraph">
<p>Standardowe podejście oparte na JDBC wymaga od programisty następujących czynności:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Opening a database connection</p>
</li>
<li>
<p>Maintaining an open connection</p>
</li>
<li>
<p>Building a query</p>
</li>
<li>
<p>Executing a query</p>
</li>
<li>
<p>Getting a response to the query</p>
</li>
<li>
<p>Mapping the query response with the custom classes</p>
</li>
<li>
<p>Closing the database connection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Czyli ORM :</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>redukuje znaczenie ilość kodu potrzebnego to stworzenia i wykonania zapytania</p>
</li>
<li>
<p>ochrona programisty przed czasochłonnym SQLem</p>
</li>
<li>
<p>redukuje koszt i czas deploymentu</p>
</li>
<li>
<p>redukcja boilerplate JDBC</p>
</li>
<li>
<p>skupienie na problemach biznesowych</p>
</li>
<li>
<p>mniej synchronizacji kodu z relacyjną bazą danych</p>
</li>
<li>
<p>zwiększa szybkość wytwarzania (produktywność - metaDane, query data)</p>
</li>
<li>
<p>dostarcza mechanizmy przenośności na inne bazy (nie musimy ograniczać się do danego typu bazy )  (portability)</p>
</li>
<li>
<p><strong>Dostępne dialekty :</strong></p>
<div class="ulist">
<ul>
<li>
<p>DB2Dialect (supports DB2)</p>
</li>
<li>
<p>FrontBaseDialect</p>
</li>
<li>
<p>HSQLDialect</p>
</li>
<li>
<p>InformixDialect</p>
</li>
<li>
<p>IngresDialect</p>
</li>
<li>
<p>InterbaseDialect</p>
</li>
<li>
<p>MySQLDialect</p>
</li>
<li>
<p>Oracle8Dialect</p>
</li>
<li>
<p>Oracle9Dialect</p>
</li>
<li>
<p>Oracle10Dialect</p>
</li>
<li>
<p>PointbaseDialect</p>
</li>
<li>
<p>PostgreSQLDialect</p>
</li>
<li>
<p>ProgressDialect</p>
</li>
<li>
<p>SybaseDialect</p>
<div class="ulist">
<ul>
<li>
<p>idealnie nadaje się do protytypowania</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Dodatkowo otwiera możliwości :</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>reużywalności kodu</p>
</li>
<li>
<p>zarządzania transakcjami</p>
</li>
<li>
<p>wydajnego operowania na kolekcjach relacji</p>
</li>
<li>
<p>wbudowany mechanizm cache&#8217;u</p>
</li>
<li>
<p>wprowadza obiektowe techniki do świata relacyjnych baz danych</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wady">5.1.2. Wady</h4>
<div class="ulist">
<ul>
<li>
<p>krzywa nauki</p>
</li>
<li>
<p>dodatkowy narzut na zapytania (overhead)</p>
</li>
<li>
<p>w pewnych przypadkach powoduje spadek wydajności z stosunku do zwykłych zapytania JDBC</p>
</li>
<li>
<p>wraz ze wzrostem złożoności modelu domenowego występują trudności z mapowaniem, wydajnością. Skutkuje to często wprowadzaniem 'haków'</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_moduły">6. Moduły</h2>
<div class="sectionbody">
<div class="ulist square">
<ul class="square">
<li>
<p><strong>Hibernate Core</strong></p>
<div class="ulist">
<ul>
<li>
<p>odpowiada za generowanie natywnych kwerent SQL</p>
</li>
<li>
<p>dostarcza dialekty</p>
</li>
<li>
<p>dostarcza mechanizmy obsługi i translacji zapytań jak : HQL, Criteria Query czy QBE</p>
</li>
<li>
<p>odpowiada za buforowanie i efektywne pobieranie danych - czyli optymalizuje zapytania</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Hibernate Annotation</strong></p>
<div class="ulist">
<ul>
<li>
<p>dostarcza znacziki metadanych równorzędne do konfiguracji mapować w XML</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Hibernate EntityManager</strong></p>
<div class="ulist">
<ul>
<li>
<p>jest implementacją interfejsu JPA</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Hibernate Search</strong></p>
<div class="ulist">
<ul>
<li>
<p>dostarcza rozwiązań użycia indeksów Lucene</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Hibernate Validator</strong></p>
<div class="ulist">
<ul>
<li>
<p>obsługa walidacji danych</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Hibernate OGM</strong></p>
<div class="ulist">
<ul>
<li>
<p>rozwiazania NoSql</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>DataSourcePool</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>hibernate-c3p0</strong> -   Integracja C3P0 z Hibernate</p>
</li>
</ul>
</div>
</li>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.c3p0.min_size</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5</span>&lt;/property&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.c3p0.max_size</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">10</span>&lt;/property&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.c3p0.timeout</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">300</span>&lt;/property&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.c3p0.max_statements</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">50</span>&lt;/property&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.c3p0.acquire_increment</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1</span>&lt;/property&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.c3p0.idle_test_period</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">3000</span>&lt;/property&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>min_size = minimalna liczba połączeń dostępna zawsze kiedy jest taka potrzeba</p>
</li>
<li>
<p>max_size = max liczba połączeń dostępnych w ramach puli</p>
</li>
<li>
<p>timeout = max czas bezczynności po którym połączenie jest usuwane z puli</p>
</li>
<li>
<p>idle_test_period = czas w sekundach przed którym połączenie jest automatycznie walidowane</p>
</li>
<li>
<p>max_statements = max liczba kwerend które mogą być buforowane w ramach puli</p>
</li>
<li>
<p>acquire_increment = liczba nowych połączeń jeśli pula jest wyczerpana</p>
<div class="ulist">
<ul>
<li>
<p>hibernate-hikaricp</p>
</li>
<li>
<p>hibernate-proxool</p>
</li>
</ul>
</div>
</li>
<li>
<p>Cache</p>
<div class="ulist">
<ul>
<li>
<p>hibernate-ehcache</p>
</li>
<li>
<p>hibernate-infinispan</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_minimalna_konfiguracja_projektu">7. Minimalna konfiguracja projektu :</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_hibernate">8. Hibernate</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Maven</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;dependencies&gt;</span>
                <span class="tag">&lt;dependency&gt;</span>
                        <span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
                        <span class="tag">&lt;artifactId&gt;</span>hibernate-core<span class="tag">&lt;/artifactId&gt;</span>
                        <span class="tag">&lt;version&gt;</span>4.3.5.Final<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Konfiguracja bazy</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.h2database<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>h2<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.4.178<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Możliwe typy konfiguracji :</strong>
  - konfiguracja bezpośrednio w kodzie</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">   <span class="predefined-type">Configuration</span> configuration = <span class="keyword">new</span> <span class="predefined-type">Configuration</span>().addResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">Book.hbm.xml</span><span class="delimiter">&quot;</span></span>)
.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.dialect.DerbyTenSevenDialect</span><span class="delimiter">&quot;</span></span>)
.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.connection.driver_class</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.derby.jdbc.EmbeddedDriver</span><span class="delimiter">&quot;</span></span>)
.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.connection.url</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:derby://localhost:1527/BookDB</span><span class="delimiter">&quot;</span></span>)
.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.connection.username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>)
.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.connection.password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">ServiceRegistry</span> serviceRegistry = <span class="keyword">new</span> StandardServiceRegistryBuilder().applySettings(configuration.getProperties()).build();
sessionFactory = configuration.buildSessionFactory(serviceRegistry);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>konfiguracja xml</p>
</li>
<li>
<p>konfiguracja z użyciem plików properties</p>
<div class="ulist">
<ul>
<li>
<p>Pojęcia</p>
<div class="ulist">
<ul>
<li>
<p>Encja</p>
</li>
<li>
<p>PersistenceUnit</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceUnit</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">pu-unit</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> EntityManagerFactory emf;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>PersistenceContext</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span> (unitName = <span class="string"><span class="delimiter">&quot;</span><span class="content">pu-unit</span><span class="delimiter">&quot;</span></span>)
EntityManager entityManager;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terminy_związane_z_hibernate">9. Terminy związane z Hibernate</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>przezroczyste utrwalanie danych</p>
</li>
<li>
<p>mapowania obiektów na tabele</p>
</li>
<li>
<p>sprawdzanie zabrudzeń (dirty-checking)</p>
</li>
<li>
<p>przechodność utrwalania (transitive persistence)</p>
</li>
<li>
<p>przechodność utrwalania (lazy loading/fetching)</p>
</li>
<li>
<p>generowanie schematu danych</p>
</li>
<li>
<p>symulacja dziedziczenia modelu relacyjnego</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_symbioza">10. Symbioza</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lombok">10.1. Lombok</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Data</span>
<span class="annotation">@AllArgsConstructor</span>
<span class="annotation">@Builder</span>
<span class="annotation">@NoArgsConstructor</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span>{</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jaxb">10.2. JAXB</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@XmlTransient</span>
<span class="annotation">@XmlJavaTypeAdapter</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json">10.3. JSON</h3>

</div>
<div class="sect2">
<h3 id="_bean_validation">10.4. Bean Validation</h3>
<div class="ulist">
<ul>
<li>
<p>@Pattern</p>
</li>
<li>
<p>@Size</p>
</li>
<li>
<p>@Max
-@Min</p>
</li>
<li>
<p>etc</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nowości_w_jpa_2_1">11. Nowości w JPA 2.1</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Querying Stored Procedure</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testCallStoreProcedure() {
        StoredProcedureQuery query = em.createStoredProcedureQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_sum</span><span class="delimiter">&quot;</span></span>);
        query.registerStoredProcedureParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>,<span class="predefined-type">Integer</span>.class,ParameterMode.IN);
        query.registerStoredProcedureParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>,<span class="predefined-type">Integer</span>.class,ParameterMode.IN);
        query.registerStoredProcedureParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span>,<span class="predefined-type">Integer</span>.class,ParameterMode.OUT);

        query.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>);
        query.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>, <span class="integer">4</span>);
        query.execute();
        <span class="predefined-type">Integer</span> sum = (<span class="predefined-type">Integer</span>) query.getOutputParameterValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span>);
        assertEquals(sum, <span class="keyword">new</span> <span class="predefined-type">Integer</span>(<span class="integer">9</span>));
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>source : <em><a href="https://en.wikibooks.org/wiki/Java_Persistence/Advanced_Topics#Stored_Procedures" class="bare">https://en.wikibooks.org/wiki/Java_Persistence/Advanced_Topics#Stored_Procedures</a></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedStoredProcedureQuery</span>(
    name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ReadAddressById</span><span class="delimiter">&quot;</span></span>,
    resultClasses = Address.class,
    procedureName = <span class="string"><span class="delimiter">&quot;</span><span class="content">READ_ADDRESS</span><span class="delimiter">&quot;</span></span>,
    parameters = {
        <span class="annotation">@StoredProcedureParameter</span>(mode=javax.persistence.ParameterMode.IN, name=<span class="string"><span class="delimiter">&quot;</span><span class="content">P_ADDRESS_ID</span><span class="delimiter">&quot;</span></span>, type=<span class="predefined-type">Long</span>.class)
    }
)
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
  ...
}

StoredProcedureQuery query = em.createNamedStoredProcedureQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">ReadAddressById</span><span class="delimiter">&quot;</span></span>);
query.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">P_ADDRESS_ID</span><span class="delimiter">&quot;</span></span>, <span class="integer">12345</span>);
<span class="predefined-type">List</span>&lt;Address&gt; result = query.getResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Attribute Converter</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Converter</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PasswordConverter</span> <span class="directive">implements</span> AttributeConverter&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> convertToDatabaseColumn(<span class="predefined-type">String</span> arg0) {
        <span class="keyword">if</span>(arg0!=<span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> Base64.getEncoder().encodeToString(arg0.getBytes());
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> convertToEntityAttribute(<span class="predefined-type">String</span> arg0) {
        <span class="keyword">if</span>(arg0!=<span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span>(Base64.getDecoder().decode(arg0));
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@Convert</span>(converter=PasswordConverter.class)
    <span class="predefined-type">String</span> password;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Constructor Result Mapping</strong>
@ConstructorResult annotation is a handy addition to the already existing @SqlResultSetMapping and can be used to map the result of a query to a constructor call.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Entity
@NamedNativeQuery(name = "findWithTodoResultSetMapper", query = "SELECT id, description FROM TODO where description like ?1", resultSetMapping = "TodoResultSetMapper")
@SqlResultSetMapping(name = "TodoResultSetMapper", classes = @ConstructorResult(targetClass = org.hall.jpa.model.TodoPOJO.class, columns = {
		@ColumnResult(name = "id", type = Long.class),
		@ColumnResult(name = "description") }))
public class Todo {
	private Long id;
	private String summary;
	private String description;

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Programmatic Named Queries</strong>
addNamedQuery(String name, Query query)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Query q = this.em.createQuery("SELECT a FROM Book b JOIN b.authors a WHERE b.title LIKE :title GROUP BY a");
this.em.getEntityManagerFactory().addNamedQuery("selectAuthorOfBook", q);

TypedQuery&lt;Author&gt; nq = this.em.createNamedQuery("selectAuthorOfBook", Author.class);
nq.setParameter("title", "%Java%");
List&lt;Author&gt; authors = nq.getResultList();</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Named Entity Graph</strong></p>
</li>
<li>
<p><strong>Java 8 Date Time API</strong>
The Hibernate support for Java 8 Date Time API is provided in a separate module called hibernate-java8</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connection_pooling">12. Connection pooling</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Tworzenie  połączeń do bazy danych  jest kosztowne.</p>
</li>
<li>
<p>Utrzymywanie wielu niewykorzystywanych połączeń jest kosztowne</p>
</li>
<li>
<p>Hibernate dostarcza gotowe rozwiązanie do poolingu. Jednak rozwiązanie nie jest zalecane w produkcyjnym środowisku.</p>
</li>
<li>
<p>Tworzenie kostrukcji przygotowawczych dla niektórych sterowników jest również kosztowne</p>
</li>
<li>
<p>Zalecane w środowiskach produkcyjnych jest wykorzystanie zewnętrzych poll poprzez odwołania z JNDI lub konfigurowane zewnętrznie poprzez classpath czy odpowienie pliki properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Przykład zewnętrznej puli połączeń c3p0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
   <span class="tag">&lt;dependency&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>hibernate-c3p0<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;version&gt;</span>[4.2.6,4.2.9)<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
       <span class="tag">&lt;groupId&gt;</span>com.mchange<span class="tag">&lt;/groupId&gt;</span>
       <span class="tag">&lt;artifactId&gt;</span>c3p0<span class="tag">&lt;/artifactId&gt;</span>
       <span class="tag">&lt;version&gt;</span>[0.9.2.1,)<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Aby użyć powyższą konfigurację c3p0 wszystko co musimy zrobić to dodać wpis do konfiguracji hibernate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c3p0.timeout</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>10<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>W ten sposób Hibernate wyłączy wewnętrzną pulę połączeń i przestawi się na zewnętrzną.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Inne rozwiązania to :</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>proxool</strong> <a href="http://proxool.sourceforge.net/" class="bare">http://proxool.sourceforge.net/</a></p>
</li>
<li>
<p><strong>boneCp</strong> <a href="http://www.jolbox.com/" class="bare">http://www.jolbox.com/</a></p>
</li>
<li>
<p><strong>Apache poll</strong> <a href="https://commons.apache.org/proper/commons-dbcp/" class="bare">https://commons.apache.org/proper/commons-dbcp/</a></p>
</li>
<li>
<p><strong>hikarii</strong> <a href="https://brettwooldridge.github.io/HikariCP/" class="bare">https://brettwooldridge.github.io/HikariCP/</a></p>
</li>
<li>
<p>Spring pool connection</p>
</li>
<li>
<p>Server/Container connection pool</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/HikariCP-bench-2.4.0.png" alt="HikariCP bench 2.4.0">
</div>
</div>
<div class="sect2">
<h3 id="_przykład_zestawienia_puli_połączeń_dla_springa">12.1. Przykład zestawienia puli połączeń dla Springa</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">employeeDataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mchange.v2.c3p0.ComboPooledDataSource</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">destroy-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">close</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverClass</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.driverClassName}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbcUrl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.employee_db_url}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.username}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.password}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxPoolSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.maxPoolSize}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">minPoolSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.minPoolSize}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxStatements</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.maxStatements}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testConnectionOnCheckout</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${jdbc.testConnection}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>przykładowy plik ustawień</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">jdbc.driverClassName=com.mysql.jdbc.Driver
jdbc.employee_db_url=jdbc:mysql://localhost:3306/testdb
jdbc.username=root
jdbc.password=root
jdbc.maxPoolSize=50
jdbc.minPoolSize=10
jdbc.maxStatements=100
jdbc.testConnection=true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_encja_trwała_klasa">13. Encja - Trwała klasa</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>klasa nie może być finalna</p>
</li>
<li>
<p>klasa musi zawierać bezargumentowy konstruktor</p>
</li>
<li>
<p>metody get/set dla trwałych pól</p>
</li>
<li>
<p>klasa oznaczona jest adnotacją @Entity</p>
</li>
<li>
<p>klasa zawiera unikalny identyfikator @Id</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cykl_życia">14. Cykl życia</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/lifecycle.jpeg" alt="lifecycle">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Transient</strong> (ulotny)  - obiekt istnie w pamięci i jest rozłączony od kontekstu Hibernate. Taki obiekt nie może być zarządzany przez Hibernate</p>
<div class="ulist">
<ul>
<li>
<p>Tworzony za pomocą operatora new. Nie skojarzony z sesją.</p>
<div class="literalblock">
<div class="content">
<pre>Utrwalenie:  save(), persist(), saveOrUpdate()
save() i persist() -&gt; Insert
update() i merge() -&gt; Update</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Persistence</strong> (trwały) - obiekt istnieje w bazie danych. Obiekt jest zarządzany przez Hibernate czyli jest związany z sesją.</p>
<div class="literalblock">
<div class="content">
<pre>EntityManager#persist()</pre>
</div>
</div>
</li>
<li>
<p><strong>Detached</strong> (odłączony) - obiekt ma reprezentacje w bazie danych, ale zmiana wartości obiektu nie ma wpływu na reprezentacje bazodanową i odwrotnie.</p>
<div class="literalblock">
<div class="content">
<pre>Był trwały ale został odłączony od sesji.
Możliwy do modyfikacji poza kontekstem.
Przyłączenie do sesji jest możliwe</pre>
</div>
</div>
</li>
<li>
<p><strong>Removed</strong> / Usunięcie  - obiekty były zarządzane przez Hibernate, ale w wyniku operacji remove() zostały skasowane z bazy danych.</p>
<div class="ulist">
<ul>
<li>
<p>delete() , EntityManager#remove()**</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_factory_entitymanagerfactory">15. Session Factory ~ EntityManagerFactory</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Służy do tworzenia obiektów Session (tworzenie, zarządzanie i pobieranie Session)</p>
</li>
<li>
<p>Jedna na kontekst (singleton pattern)</p>
</li>
<li>
<p>thread-safe (immutable)</p>
</li>
<li>
<p>ciężka i kosztowna do stworzenia</p>
</li>
<li>
<p>konfigurowalna programowo lub poprzez konfiguracją xml</p>
</li>
<li>
<p>współdzielony przez wiele wątków udostępniający egzemplarze Session</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SessionFactory factory = configuration.buildSessionFactory(serviceRegistry);
<span class="comment">//</span>
SessionFactory factory = <span class="keyword">new</span> AnnotationConfiguration().configure().buildSessionFactory();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hibernate-configuration&gt;</span>
<span class="tag">&lt;session-factory&gt;</span>
<span class="comment">&lt;!-- H2 Configuration --&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.driver_class</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>org.h2.Driver<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>jdbc:h2:file:./chapter1<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>sa<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>

<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>org.hibernate.dialect.H2Dialect<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>create<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;mapping</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Book.hbm.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;mapping</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Publisher.hbm.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/session-factory&gt;</span>
<span class="tag">&lt;/hibernate-configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>source : <em><a href="http://www.noesispoint.com/jsp/hibernate/HibernateIntro.htm" class="bare">http://www.noesispoint.com/jsp/hibernate/HibernateIntro.htm</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/HibSessionFactory.jpg" alt="HibSessionFactory">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_entitymanager_zarząda_trwałości_obiektów_persistence_manager">16. Session ~ EntityManager (zarząda trwałości obiektów (persistence manager))</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>'Unit of work' <a href="http://martinfowler.com/eaaCatalog/unitOfWork.html" class="bare">http://martinfowler.com/eaaCatalog/unitOfWork.html</a></p>
</li>
<li>
<p>Obsługuje transakcje</p>
</li>
<li>
<p>Lekka i szybka do stworzenia</p>
</li>
<li>
<p>można ją traktować jako fizyczne buforowalne połączenie z bazą danych</p>
</li>
<li>
<p>jedno wątkowy</p>
</li>
<li>
<p>krótki okres życia</p>
</li>
<li>
<p>zapewnia dostęp do podstawowych operacji CRUD</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_otwieranie_i_zamykanie_sesji">17. Otwieranie i zamykanie sesji</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Session session = factory.openSession();
<span class="keyword">try</span> {
<span class="comment">// Using the session to retrieve objects</span>
}<span class="keyword">catch</span>(<span class="exception">Exception</span> e)
{
e.printStackTrace();
} <span class="keyword">finally</span> {
session.close();
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_ponowne_użycie_istniejącej_już_sesji">17.1. Ponowne użycie istniejącej już sesji</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SessionFactory sessionFactory = HibernateUtil.getSessionFactory();
Session session = sessionFactory.getCurrentSession();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.current_session_context_class</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Thread<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Jeśli używasz Springa do zarządzania transakcjami nigdy nie używaj tej opcji chyba, że korzystasz z JTA. Spring domyślnie konfiguruje CurrentSessionContext korzystając z SpringSessionContext
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_otwieranie_sesji_bezstanowej">17.2. Otwieranie sesji bezstanowej</h3>
<div class="ulist">
<ul>
<li>
<p>wykorzystywane dla pojedyńczego zadania</p>
</li>
<li>
<p>nie wykorzystuje żadnego cache</p>
</li>
<li>
<p>nie korzysta z dirty-checking</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Przykładowe wykorzystanie to : czytanie danych z pliku i wstawianie do bazy danych. (Cache jest zbyteczny to tego typu działań)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SessionFactory sessionFactory = HibernateUtil.getSessionFactory();
Session session = sessionFactory.openStatelessSession();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transaction">18. Transaction</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>abstrakcyjna warstwa obsługi transakcji bez względu na jej implementację (JDBC, JTA)</p>
</li>
<li>
<p>jedno wątkowy</p>
</li>
<li>
<p>określa granice jednej transakcji</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Company company = <span class="keyword">new</span> Company(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Scalatech</span><span class="delimiter">&quot;</span></span>);
Transaction tx = session.beginTransaction();
session.save(company);
tx.commit();
session.flush();
session.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_odświeżanie_encji">19. Odświeżanie encji</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>operacja <strong>refresh();</strong></p>
</li>
<li>
<p>odświeża stan encji z bazy nadpisuje dane wprowadzone do encji</p>
</li>
<li>
<p>anuluje zmiany dokonane na instancji w pamięci</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Anti-pattern
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_opróżnianie_sesji">20. Opróżnianie sesji</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>operacja <strong>flush();</strong></p>
</li>
<li>
<p>synchronizuje persistence context z bazą danych</p>
</li>
<li>
<p>wszystkie encje zostaną wstawione/uaktualnione/skasowane z bazie (wysyła instrukcje CRUD do bazy)</p>
</li>
<li>
<p>Hibernate zatwierdza wszystkie zmiany będące w kolejce.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Anti-pattern &#8594; System.gc()
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_czyszczenie_kontekstu_jpa">21. Czyszczenie kontekstu (JPA)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>czyści kontekst utrwalania</p>
</li>
<li>
<p>wszystkie encje zostaną odłączone</p>
<div class="literalblock">
<div class="content">
<pre>odśwież stan instancji encji danymi z bazy danych, nadpisując wprowadzone zmiany w encji</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_czy_sesja_jest_zanieczyszczona">22. Czy sesja jest zanieczyszczona ?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>isDirty()</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adnotacje">23. Adnotacje</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pola">23.1. Pola</h3>
<div class="paragraph">
<p>Ten rodzaj mapowania  oparty jest na typach i nazwach pól.</p>
</div>
</div>
<div class="sect2">
<h3 id="_metody">23.2. Metody</h3>
<div class="paragraph">
<p>Na poziomie właściwości klasy. Adnotację umieszcza się przy @Getter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mieszany_access">23.3. Mieszany @Access</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Access</span>(AccessType.FIELD)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span>{
<span class="annotation">@Id</span>
<span class="annotation">@Setter</span>
<span class="annotation">@Getter</span>
<span class="directive">private</span> <span class="predefined-type">Long</span> id;

<span class="directive">private</span> <span class="predefined-type">String</span> name;

<span class="annotation">@Access</span>(AccessType.PROPERTY)
<span class="directive">public</span> <span class="predefined-type">String</span> getName()...
public <span class="type">void</span> setName(<span class="predefined-type">String</span> name)...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_entity_strong">24. <strong>@Entity</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>oznacza klasy klasy,  które mają brać udział w procesie utrwalania</p>
</li>
<li>
<p>taka klasa może być abstract</p>
</li>
<li>
<p>klasa nie może być final</p>
</li>
<li>
<p>klasa nie może zawierać pola i metody final</p>
</li>
<li>
<p>klasa musi posiadać bezargumentowy konstruktor</p>
</li>
<li>
<p>klasa musi posiadać klucz główny <strong>@Id</strong></p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Dla komunikacji (distributed/web/session/serializable) powinna implementować Serializable. Klasa posiada wyróżnioną tożsamość
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Simple</span> {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_klucze_strong_id_strong">25. Klucze <strong>@Id</strong></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prosty">25.1. Prosty</h3>

</div>
<div class="sect2">
<h3 id="_ustawianie_wartości">25.2. Ustawianie wartości</h3>
<div class="sect3">
<h4 id="_ręcznie">25.2.1. ręcznie</h4>

</div>
<div class="sect3">
<h4 id="_automatyczne">25.2.2. automatyczne</h4>
<div class="ulist">
<ul>
<li>
<p>każda klasa encyjna musi posiadać unikalny identyfikator.</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Id</span>
<span class="directive">public</span> <span class="predefined-type">Long</span> id;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Database sequence</strong> - wykorzystuje sekwencje. Wsparcie dla baz DB2, PostgreSQL, Oracle, SAP DB.</p>
</li>
<li>
<p><strong>Native generator</strong> - wybiera jedną ze strategii generowania identyfikatorów : identity, sequence, hilo w zależności od możliwości bazy</p>
<div class="ulist">
<ul>
<li>
<p>wsparcie dla kolumn identity w bazach DB2, MySQL, MS SQL Server, Sybase, HypersonicSQL.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Increment generator</strong> (Identity)</p>
</li>
<li>
<p><strong>Hilo generator</strong> - identyfikatory są unikalne w ramach całej bazy.</p>
</li>
<li>
<p><strong>UUID</strong> - generuje Stringi (unikalny w sieci adres ip + znacznik czasu). Jest to  kosztowne rozwiązanie.</p>
</li>
<li>
<p><strong>assigned</strong> - pozwala aplikacji nadać identyfikator zanim obiekt zostanie zapisany.(persist, save)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="__tablegenerator">25.2.3. @TableGenerator</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TableGenerator</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Book_Gen</span><span class="delimiter">&quot;</span></span>, table=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID_GEN</span><span class="delimiter">&quot;</span></span>,pkColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">GEN_NAME</span><span class="delimiter">&quot;</span></span>, valueColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">GEN_VAL</span><span class="delimiter">&quot;</span></span>, initialValue=<span class="integer">10000</span>, allocationSize=<span class="integer">100</span>)

<span class="annotation">@Id</span>
<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.TABLE,generator=<span class="string"><span class="delimiter">&quot;</span><span class="content">Book_Gen</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Long</span> id;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Entity</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
        ...
        <span class="annotation">@TableGenerator</span>(
            name=<span class="string"><span class="delimiter">&quot;</span><span class="content">empGen</span><span class="delimiter">&quot;</span></span>,
            table=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID_GEN</span><span class="delimiter">&quot;</span></span>,
            pkColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">GEN_KEY</span><span class="delimiter">&quot;</span></span>,
            valueColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">GEN_VALUE</span><span class="delimiter">&quot;</span></span>,
            pkColumnValue=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>,
            allocationSize=<span class="integer">1</span>)
        <span class="annotation">@Id</span>
        <span class="annotation">@GeneratedValue</span>(strategy=TABLE, generator=<span class="string"><span class="delimiter">&quot;</span><span class="content">empGen</span><span class="delimiter">&quot;</span></span>)
        <span class="type">int</span> id;
        ...
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__sequencegenerator">25.2.4. @SequenceGenerator</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SequenceGenerator</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Book_Gen</span><span class="delimiter">&quot;</span></span>, sequenceName=<span class="string"><span class="delimiter">&quot;</span><span class="content">Book_Seq</span><span class="delimiter">&quot;</span></span>,initialValue=<span class="integer">10000</span>,allocationSize=<span class="integer">100</span>)

<span class="annotation">@Id</span>
<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.SEQUENCE,generator=<span class="string"><span class="delimiter">&quot;</span><span class="content">Book_Gen</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Long</span> id;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_klucz_złożony">25.3. Klucz złożony</h3>
<div class="sect3">
<h4 id="_primary_key_column_id_and_idclass">25.3.1. Primary key column – @Id and @IdClass</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">BookPK</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span>{

<span class="directive">private</span> <span class="predefined-type">String</span> name;
<span class="directive">private</span> <span class="predefined-type">String</span> isbn;
<span class="directive">public</span> <span class="type">int</span> hashCode() {
<span class="keyword">return</span> ...;
}
<span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> obj) {
<span class="keyword">return</span> ...;
}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@IdClass</span>(BookPK.class)
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span>{
<span class="annotation">@Id</span>
<span class="directive">private</span> <span class="predefined-type">String</span> id;
<span class="annotation">@Id</span>
<span class="directive">private</span> <span class="predefined-type">String</span> isbn;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__embeddedid">25.3.2. @EmbeddedId</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="type">class</span> <span class="class">User</span> {
   <span class="annotation">@EmbeddedId</span>
   <span class="annotation">@AttributeOverride</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, column=<span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">fld_firstname</span><span class="delimiter">&quot;</span></span>)
   UserId id;

   <span class="predefined-type">Integer</span> age;
}

<span class="annotation">@Embeddable</span>
<span class="type">class</span> <span class="class">UserId</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
   <span class="predefined-type">String</span> firstName;
   <span class="predefined-type">String</span> lastName;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>NOTE : Może być wykorzystywany przez  @ElementCollection</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_elementcollection">25.4. ElementCollection</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@ElementCollection</span>
  <span class="annotation">@CollectionTable</span>(
        name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PHONE</span><span class="delimiter">&quot;</span></span>,
        joinColumns=<span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">OWNER_ID</span><span class="delimiter">&quot;</span></span>)
  )
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Phone&gt; phones;
  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Embeddable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Phone</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> type;
  <span class="directive">private</span> <span class="predefined-type">String</span> areaCode;
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">P_NUMBER</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> number;
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_attributeoverride">25.5. AttributeOverride</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@Embedded</span>
  <span class="annotation">@AttributeOverrides</span>({
    <span class="annotation">@AttributeOverride</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span>, column=<span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">START_DATE</span><span class="delimiter">&quot;</span></span>)),
    <span class="annotation">@AttributeOverride</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">endDate</span><span class="delimiter">&quot;</span></span>, column=<span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">END_DATE</span><span class="delimiter">&quot;</span></span>))
  })
  <span class="directive">private</span> Period employmentPeriod;
  ...
}

<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@Embedded</span>
  <span class="annotation">@AttributeOverrides</span>({
    <span class="annotation">@AttributeOverride</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span>, column=<span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">SDATE</span><span class="delimiter">&quot;</span></span>)),
    <span class="annotation">@AttributeOverride</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">endDate</span><span class="delimiter">&quot;</span></span>, column=<span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EDATE</span><span class="delimiter">&quot;</span></span>))
  })
  <span class="directive">private</span> Period period;
  ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_table_strong">26. <strong>@Table</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>domyślnie nazwa tabeli jest taka sama jak nazwa klasy.</p>
</li>
<li>
<p>jeśli domyślne ustawienie jest nie wystarczające z różnych powodów możemy użyć @Table</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ITEMS</span><span class="delimiter">&quot;</span></span>,uniqueConstraints =<span class="annotation">@UniqueConstraint</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">UNQ_NAME</span><span class="delimiter">&quot;</span></span>,columnNames = { <span class="string"><span class="delimiter">&quot;</span><span class="content">ITEM_NAME</span><span class="delimiter">&quot;</span></span> })
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Item</span> <span class="directive">extends</span> AbstractEntity {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">5474170031394030929L</span>;
    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ITEM_NAME</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">    <span class="class">create</span> <span class="type">table</span> ITEMS (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        ITEM_NAME <span class="predefined-type">varchar</span>(<span class="integer">255</span>),
        <span class="directive">primary</span> <span class="type">key</span> (id)
    )
    <span class="class">alter</span> <span class="type">table</span> ITEMS  <span class="class">add</span> <span class="type">constraint</span> UNQ_NAME <span class="directive">unique</span> (ITEM_NAME)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_określenie_schematu_bazy_w_persistence_xml">26.1. Określenie schematu bazy w persistence.xml</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;entity-mappings&gt;</span>
    <span class="tag">&lt;persistence-unit-metadata&gt;</span>
        <span class="tag">&lt;persistence-unit-defaults&gt;</span>
            <span class="tag">&lt;schema</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purchasing</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/persistence-unit-defaults&gt;</span>
    <span class="tag">&lt;/persistence-unit-metadata&gt;</span>
    ....
<span class="tag">&lt;/entity-mappings&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__index">26.2. @Index</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ITEMS</span><span class="delimiter">&quot;</span></span>,
indexes = {<span class="annotation">@Index</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">IDX_USERNAME</span><span class="delimiter">&quot;</span></span>, columnList = <span class="string"><span class="delimiter">&quot;</span><span class="content">ITEM_NAME</span><span class="delimiter">&quot;</span></span>)}
<span class="directive">public</span> <span class="type">class</span> <span class="class">Item</span> <span class="directive">extends</span> AbstractEntity {

    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ITEM_NAME</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"> <span class="class">create</span> <span class="type">table</span> ITEMS (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        ITEM_NAME <span class="predefined-type">varchar</span>(<span class="integer">255</span>),
        <span class="directive">primary</span> <span class="type">key</span> (id)
    )
     <span class="class">create</span> <span class="type">index</span> IDX_USERNAME <span class="keyword">on</span> ITEMS (ITEM_NAME)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_column_strong">27. <strong>@Column</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>analogiczne zachowanie do adnotacji @Table</p>
</li>
<li>
<p>insertable/updatable - określa czy dana kolumna będzie brała udział w operacjach insert/update</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">retryattempt</span><span class="delimiter">&quot;</span></span>, columnDefinition = <span class="string"><span class="delimiter">&quot;</span><span class="content">numeric</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">true</span>)
    <span class="directive">private</span> <span class="type">int</span> retryAttempt = <span class="integer">0</span>;

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">messageerror</span><span class="delimiter">&quot;</span></span>, columnDefinition = <span class="string"><span class="delimiter">&quot;</span><span class="content">nvarchar</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> messageError;

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">messagebody</span><span class="delimiter">&quot;</span></span>, length = <span class="predefined-type">Integer</span>.MAX_VALUE, columnDefinition = <span class="string"><span class="delimiter">&quot;</span><span class="content">nvarchar</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> body;

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">detailstatus</span><span class="delimiter">&quot;</span></span>, columnDefinition = <span class="string"><span class="delimiter">&quot;</span><span class="content">nvarchar</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Enumerated</span>(EnumType.STRING)
    <span class="directive">private</span> DetailStatus status;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Column</span>(nullable=<span class="predefined-constant">false</span>,scale=<span class="integer">2</span>,precision=<span class="integer">2</span>)
 <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> price;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"> price <span class="predefined-type">decimal</span>(<span class="integer">2</span>,<span class="integer">2</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Column</span>
 <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> price;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"> price <span class="predefined-type">decimal</span>(<span class="integer">19</span>,<span class="integer">2</span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 3</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ITEM_NAME</span><span class="delimiter">&quot;</span></span>,length=<span class="integer">20</span>,unique=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="type">table</span> Item (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        version <span class="predefined-type">bigint</span>,
        ITEM_NAME <span class="predefined-type">varchar</span>(<span class="integer">20</span>),
        price <span class="predefined-type">decimal</span>(<span class="integer">2</span>,<span class="integer">2</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        <span class="directive">primary</span> <span class="type">key</span> (id)
    )
     <span class="class">alter</span> <span class="type">table</span> Item  <span class="class">add</span> <span class="type">constraint</span> UK_bjye5lp3xnccmg4ovtumigp3v <span class="directive">unique</span> (ITEM_NAME)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 4</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Column</span>(columnDefinition =<span class="string"><span class="delimiter">&quot;</span><span class="content">varchar(15) not null unique check (not substring(lower(OWNER), 0, 5) = 'admin')</span><span class="delimiter">&quot;</span></span>)
 <span class="directive">private</span> <span class="predefined-type">String</span> owner;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"> <span class="class">create</span> <span class="type">table</span> Item (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        version <span class="predefined-type">bigint</span>,
        ITEM_NAME <span class="predefined-type">varchar</span>(<span class="integer">20</span>),
        owner <span class="predefined-type">varchar</span>(<span class="integer">15</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span> <span class="directive">unique</span> <span class="keyword">check</span> (<span class="keyword">not</span> <span class="predefined">substring</span>(lower(OWNER), <span class="integer">0</span>, <span class="integer">5</span>) = <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>),
        price <span class="predefined-type">decimal</span>(<span class="integer">2</span>,<span class="integer">2</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        <span class="directive">primary</span> <span class="type">key</span> (id)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__check">28. @Check</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@org</span>.hibernate.annotations.Check(
constraints = <span class="string"><span class="delimiter">&quot;</span><span class="content">AUCTIONSTART &lt; AUCTIONEND</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Offer</span> <span class="directive">extends</span> AbstractEntity{
<span class="annotation">@NotNull</span>
<span class="directive">protected</span> <span class="predefined-type">Date</span> auctionStart;
<span class="annotation">@NotNull</span>
<span class="directive">protected</span> <span class="predefined-type">Date</span> auctionEnd;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">  <span class="class">create</span> <span class="type">table</span> Offer (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        version <span class="predefined-type">bigint</span>,
        auctionEnd <span class="predefined-type">binary</span>(<span class="integer">255</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        auctionStart <span class="predefined-type">binary</span>(<span class="integer">255</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        offer_value <span class="predefined-type">decimal</span>(<span class="integer">19</span>,<span class="integer">2</span>),
        ITEM_ID <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        <span class="directive">primary</span> <span class="type">key</span> (id),
        <span class="keyword">check</span> (AUCTIONSTART &lt; AUCTIONEND)
    )</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_transient_strong">29. <strong>@Transient</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>pole nie podlega procesowi utrwalania</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_basic_strong">30. <strong>@Basic</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>określa czy pole ma być opcjonalne (przydatne podczas generowania schematu przez Hibernate).</p>
</li>
<li>
<p>określa również sposób pobierania danych, czy pole ma być wypełniane od razu przy odczycie obiektu czy dopiero przy pierwszym odwołaniu.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__embeddable_i_embedded">31. @Embeddable i @Embedded**</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>umożliwia osadzanie nieencyjnych obiektów Java w objektach encyjnych</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source: <em><a href="https://en.wikibooks.org/wiki/Java_Persistence/Embeddables" class="bare">https://en.wikibooks.org/wiki/Java_Persistence/Embeddables</a></em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/Embeddable.PNG" alt="Embeddable"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Embeddable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmploymentPeriod</span> {
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">START_DATE</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> java.sql.Date startDate;

  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">END_DATE</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> java.sql.Date endDate;
  ....
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@Embedded</span>
  <span class="directive">private</span> EmploymentPeriod period;
  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Embeddable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> line1;

    <span class="directive">private</span> <span class="predefined-type">String</span> line2;

    <span class="annotation">@Embedded</span>
    <span class="directive">private</span> ZipCode zipCode;

    ...

    <span class="annotation">@Embeddable</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Zip</span> {

        <span class="directive">private</span> <span class="predefined-type">String</span> postalCode;

        <span class="directive">private</span> <span class="predefined-type">String</span> plus4;

        ...
    }
}
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {

    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;

    <span class="annotation">@Embedded</span>
    <span class="directive">private</span> <span class="predefined-type">Name</span> name;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>@Multiple embeddable types</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Contact</span> {

    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;

    <span class="annotation">@Embedded</span>
    <span class="directive">private</span> <span class="predefined-type">Name</span> name;

    <span class="annotation">@Embedded</span>
    <span class="directive">private</span> Address homeAddress;

    <span class="annotation">@Embedded</span>
    <span class="directive">private</span> Address mailingAddress;

    <span class="annotation">@Embedded</span>
    <span class="directive">private</span> Address workAddress;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>@AttributeOverride</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Contact</span> {

    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;

    <span class="annotation">@Embedded</span>
    <span class="directive">private</span> <span class="predefined-type">Name</span> name;

    <span class="annotation">@Embedded</span>
    <span class="annotation">@AttributeOverrides</span>(
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">line1</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">home_address_line1</span><span class="delimiter">&quot;</span></span> ),
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">line2</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">home_address_line2</span><span class="delimiter">&quot;</span></span> )
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">zipCode.postalCode</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">home_address_postal_cd</span><span class="delimiter">&quot;</span></span> )
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">zipCode.plus4</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">home_address_postal_plus4</span><span class="delimiter">&quot;</span></span> )
        )
    )
    <span class="directive">private</span> Address homeAddress;

    <span class="annotation">@Embedded</span>
    <span class="annotation">@AttributeOverrides</span>(
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">line1</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">mailing_address_line1</span><span class="delimiter">&quot;</span></span> ),
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">line2</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">mailing_address_line2</span><span class="delimiter">&quot;</span></span> )
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">zipCode.postalCode</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">mailing_address_postal_cd</span><span class="delimiter">&quot;</span></span> )
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">zipCode.plus4</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">mailing_address_postal_plus4</span><span class="delimiter">&quot;</span></span> )
        )
    )
    <span class="directive">private</span> Address mailingAddress;

    <span class="annotation">@Embedded</span>
    <span class="annotation">@AttributeOverrides</span>(
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">line1</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">work_address_line1</span><span class="delimiter">&quot;</span></span> ),
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">line2</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">work_address_line2</span><span class="delimiter">&quot;</span></span> )
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">zipCode.postalCode</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">work_address_postal_cd</span><span class="delimiter">&quot;</span></span> )
        ),
        <span class="annotation">@AttributeOverride</span>(
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">zipCode.plus4</span><span class="delimiter">&quot;</span></span>,
            column = <span class="annotation">@Column</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">work_address_postal_plus4</span><span class="delimiter">&quot;</span></span> )
        )
    )
    <span class="directive">private</span> Address workAddress;

    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_enumerated_strong">32. <strong>@Enumerated</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>mapowanie enum</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
   <span class="annotation">@Enumerated</span>
    <span class="directive">public</span> Gender gender;
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">enum</span> Gender {
        MALE,
        FEMALE
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@AttribureConverter</strong></p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> Gender {

    MALE(<span class="string"><span class="delimiter">'</span><span class="content">M</span><span class="delimiter">'</span></span>),
    FEMALE(<span class="string"><span class="delimiter">'</span><span class="content">F</span><span class="delimiter">'</span></span>);

    <span class="directive">private</span> <span class="directive">final</span> <span class="type">char</span> code;

    <span class="directive">private</span> Gender( <span class="type">char</span> code ) {
        <span class="local-variable">this</span>.code = code;
    }

    <span class="directive">public</span> <span class="directive">static</span> Gender fromCode( <span class="type">char</span> code ) {
        <span class="keyword">if</span> ( code == <span class="string"><span class="delimiter">'</span><span class="content">M</span><span class="delimiter">'</span></span> || code == <span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span> ) {
            <span class="keyword">return</span> MALE;
        }
        <span class="keyword">if</span> ( code == <span class="string"><span class="delimiter">'</span><span class="content">F</span><span class="delimiter">'</span></span> || code == <span class="string"><span class="delimiter">'</span><span class="content">f</span><span class="delimiter">'</span></span> ) {
            <span class="keyword">return</span> FEMALE;
        }
        <span class="keyword">throw</span>...
    }

    <span class="directive">public</span> <span class="type">char</span> getCode() {
        <span class="keyword">return</span> code;
    }
}

<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
    ...

    <span class="annotation">@Basic</span>
    <span class="annotation">@Convert</span>( converter = GenderConverter.class )
    <span class="directive">public</span> Gender gender;
}

<span class="annotation">@Converter</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">GenderConverter</span> <span class="directive">implements</span> AttributeConverter&lt;<span class="predefined-type">Character</span>, Gender&gt; {

    <span class="directive">public</span> <span class="predefined-type">Character</span> convertToDatabaseColumn( Gender value ) {
        <span class="keyword">if</span> ( value == <span class="predefined-constant">null</span> ) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="keyword">return</span> value.getCode();
    }

    <span class="directive">public</span> Gender convertToEntityAttribute( <span class="predefined-type">Character</span> value ) {
        <span class="keyword">if</span> ( value == <span class="predefined-constant">null</span> ) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="keyword">return</span> Gender.fromCode( value );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_lob_strong">33. <strong>@Lob</strong></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java_sql_blob">33.1. java.sql.Blob</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Step</span> {
    ...
    <span class="annotation">@Lob</span>
    <span class="annotation">@Basic</span>
    <span class="directive">public</span> <span class="type">byte</span><span class="type">[]</span> instructions;
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_sql_clob">33.2. java.sql.Clob</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Product</span> {
    ...
    <span class="annotation">@Lob</span>
    <span class="annotation">@Basic</span>
    <span class="directive">public</span> <span class="predefined-type">Clob</span> description;
    ...
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Product</span> {
    ...

    <span class="annotation">@Lob</span>
    <span class="annotation">@Basic</span>
    <span class="directive">public</span> <span class="predefined-type">Clob</span> description;
    ...

    <span class="annotation">@Lob</span>
    <span class="annotation">@Basic</span>
    <span class="directive">public</span> <span class="type">char</span><span class="type">[]</span> description;


    <span class="annotation">@Lob</span>
    <span class="annotation">@Basic</span>
    <span class="directive">public</span> <span class="predefined-type">Blob</span> instructions;

     <span class="annotation">@Lob</span>
    <span class="annotation">@Basic</span>
    <span class="directive">public</span> <span class="type">byte</span><span class="type">[]</span> instructions;
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_date_time_strong">34. <strong>Date &amp; time</strong></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_date">34.1. DATE</h3>
<div class="ulist">
<ul>
<li>
<p>java.sql.Date</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_time">34.2. TIME</h3>
<div class="ulist">
<ul>
<li>
<p>java.sql.Time</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_timestamp">34.3. TIMESTAMP</h3>
<div class="ulist">
<ul>
<li>
<p>java.sql.Timestamp</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mapping_java_8_date_time_values">35. Mapping Java 8 Date/Time Values</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>hibernate-java8<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${hibernate.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_date_2">35.1. DATE</h3>
<div class="ulist">
<ul>
<li>
<p>java.time.LocalDate</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">INSERT</span> <span class="class">INTO</span> DateEvent( <span class="predefined-type">timestamp</span>, id ) <span class="keyword">VALUES</span> ( <span class="string"><span class="delimiter">'</span><span class="content">2015-12-29</span><span class="delimiter">'</span></span>, <span class="integer">1</span> )</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_time_2">35.2. TIME</h3>
<div class="ulist">
<ul>
<li>
<p>java.time.LocalTime</p>
</li>
<li>
<p>java.time.OffsetTime</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">INSERT</span> <span class="class">INTO</span> DateEvent( <span class="predefined-type">timestamp</span>, id ) <span class="keyword">VALUES</span> ( <span class="string"><span class="delimiter">'</span><span class="content">16:51:58</span><span class="delimiter">'</span></span>, <span class="integer">1</span> )</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_timestamp_2">35.3. TIMESTAMP</h3>
<div class="ulist">
<ul>
<li>
<p>java.time.Instant,</p>
</li>
<li>
<p>java.time.LocalDateTime</p>
</li>
<li>
<p>java.time.OffsetDateTime</p>
</li>
<li>
<p>java.time.ZonedDateTime</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">INSERT</span> <span class="class">INTO</span> DateEvent  ( <span class="predefined-type">timestamp</span>, id ) <span class="keyword">VALUES</span> ( <span class="string"><span class="delimiter">'</span><span class="content">2015-12-29 16:54:04.544</span><span class="delimiter">'</span></span>, <span class="integer">1</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_attributeconverters">36. AttributeConverters</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Converter</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PeriodStringConverter</span> <span class="directive">implements</span> AttributeConverter&lt;Period, <span class="predefined-type">String</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> convertToDatabaseColumn(Period attribute) {
        <span class="keyword">return</span> attribute.toString();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Period convertToEntityAttribute(<span class="predefined-type">String</span> dbData) {
        <span class="keyword">return</span> Period.parse(dbData);
    }
}

<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Event</span>  {
    <span class="annotation">@Convert</span>(converter = PeriodStringConverter.class)
    <span class="directive">private</span> Period span;

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__formula">37. @Formula</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Formula</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">obj_length * obj_height * obj_width</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">long</span> objectVolume;


<span class="annotation">@Formula</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">UPPER(name)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">String</span> capitalName;

<span class="annotation">@Formula</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">(SELECT c.name FROM category c WHERE c.id=category_id)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">String</span> categoryName;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_secondarytable_strong">38. <strong>@SecondaryTable</strong></h2>
<div class="sectionbody">
<div class="paragraph">
<p>source : <em><a href="https://en.wikibooks.org/wiki/Java_Persistence/Tables" class="bare">https://en.wikibooks.org/wiki/Java_Persistence/Tables</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/Emp_Tables_(Database).PNG" alt="Emp Tables (Database)">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMPLOYEE</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SecondaryTable</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_DATA</span><span class="delimiter">&quot;</span></span>,
                pkJoinColumns = <span class="annotation">@PrimaryKeyJoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>)
               )
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
    ...
    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">YEAR_OF_SERV</span><span class="delimiter">&quot;</span></span>, table=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_DATA</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="type">int</span> yearsOfService;

    <span class="annotation">@OneToOne</span>
    <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">MGR_ID</span><span class="delimiter">&quot;</span></span>, table=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_DATA</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> Employee manager;
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__attributeoverride">39. @AttributeOverride</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Patrz wyżej w przykładzie z  @Embedded.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__version_blokowanie_optymistyczne">40. @Version - blokowanie optymistyczne</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Employee employee = <span class="keyword">new</span> Employee();
employee.setId(<span class="integer">1</span>);
employee.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span>);
session.saveOrUpdate(employee);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">Hibernate: <span class="class">update</span> employee <span class="class">set</span> name=<span class="error">?</span>, version=<span class="error">?</span> <span class="keyword">where</span> id=<span class="error">?</span> <span class="keyword">and</span> version=<span class="error">?</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__ordercolumn">41. @OrderColumn</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OrderColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">index_id</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Change&gt; changes = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__foreignkey">42. @ForeignKey</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Phone</span> {
 <span class="annotation">@ManyToOne</span>
    <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">person_id</span><span class="delimiter">&quot;</span></span>,
            foreignKey = <span class="annotation">@ForeignKey</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PERSON_ID_FK</span><span class="delimiter">&quot;</span></span>)
    )
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> Phone (
    id <span class="predefined-type">BIGINT</span> <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span> ,
    number <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>) ,
    person_id <span class="predefined-type">BIGINT</span> ,
    <span class="directive">PRIMARY</span> <span class="type">KEY</span> ( id )
 )

<span class="class">ALTER</span> <span class="type">TABLE</span> Phone <span class="class">ADD</span> <span class="type">CONSTRAINT</span> PERSON_ID_FK <span class="directive">FOREIGN</span> <span class="type">KEY</span> (person_id) <span class="keyword">REFERENCES</span> Person</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__type_hibernate_only">43. @Type (Hibernate only)</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@org</span>.hibernate.annotations.Type( type = <span class="string"><span class="delimiter">&quot;</span><span class="content">nstring</span><span class="delimiter">&quot;</span></span> )
<span class="directive">private</span> <span class="predefined-type">String</span> name;

<span class="annotation">@org</span>.hibernate.annotations.Type( type = <span class="string"><span class="delimiter">&quot;</span><span class="content">materialized_nclob</span><span class="delimiter">&quot;</span></span> )
<span class="directive">private</span> <span class="predefined-type">String</span> description;</code></pre>
</div>
</div>
<div class="paragraph">
<p>@UniqueConstraint(columnNames = { "id" , "empCode"}))</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__elementcollection_dla_typów_prostych_lub_klas_osadzonych">44. @ElementCollection**  - dla typów prostych lub klas osadzonych</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ElementCollection</span>(fetch=FetchType.LAZY)
<span class="annotation">@CollectionTable</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@IndexColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">email_index</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; emails;

<span class="annotation">@ElementCollection</span>(targetClass = CarBrands.class)
<span class="annotation">@Enumerated</span>(EnumType.STRING)
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;CarBrands&gt; brands;
}

<span class="directive">public</span> <span class="type">enum</span> CarBrands {
SUZUKI, STAR, FERRARI,JAGUAR;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_orderby_strong">45. <strong>@OrderBy</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>kolekcja może zostać uporządkowana według określonych kryteriów</p>
</li>
<li>
<p>w przypadku kolekcji uporządkowanej wykorzystać należy typ <strong>List</strong></p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@OrderBy</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;User&gt; children;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__strong_jointable_strong">46. <strong>@JoinTable</strong></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>name to  nazwa tabeli</p>
</li>
<li>
<p>joinColumns – kolumna tabeli złączenia, stanowiąca klucz dla encji</p>
</li>
<li>
<p>inverseJoinColumns – kolumna tabel złączenia, stanowiąca klucz dla encji po drugiej stronie relacji</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relacje">47. Relacje</h2>
<div class="sectionbody">
<div class="paragraph">
<p>@JoinColumn + @JoinTable</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One-To-One 1:1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Entity
public class Message {
@Id
Long id;

@Column
String content;

@OneToOne
Email email;

}
//ommit mutators and accessors
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>One-To-Many 1:N
Za pomoca kluczu obcego</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Item</span> <span class="directive">extends</span> AbstractEntity {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> price;

    <span class="annotation">@OneToMany</span>(fetch = FetchType.LAZY) <span class="comment">// Defaults to EAGER</span>
    <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ITEM_ID</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Offer&gt; offers;


}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Offer</span> <span class="directive">extends</span> AbstractEntity{
    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">offer_value</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> value;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Generowany SQL :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">  <span class="class">create</span> <span class="type">table</span> Item (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        version <span class="predefined-type">bigint</span>,
        name <span class="predefined-type">varchar</span>(<span class="integer">255</span>),
        price <span class="predefined-type">decimal</span>(<span class="integer">19</span>,<span class="integer">2</span>),
        <span class="directive">primary</span> <span class="type">key</span> (id)
    )

     <span class="class">create</span> <span class="type">table</span> Offer (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        version <span class="predefined-type">bigint</span>,
        offer_value <span class="predefined-type">decimal</span>(<span class="integer">19</span>,<span class="integer">2</span>),
        ITEM_ID <span class="predefined-type">bigint</span>,
        <span class="directive">primary</span> <span class="type">key</span> (id)
    )

     <span class="class">alter</span> <span class="type">table</span> Offer
        <span class="class">add</span> <span class="type">constraint</span> FKp6fm8wffictppkc0m3ufurbpy
        <span class="directive">foreign</span> <span class="type">key</span> (ITEM_ID)
        <span class="keyword">references</span> Item</code></pre>
</div>
</div>
<div class="paragraph">
<p>Za pomoca kluczu głównego</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Many-To-One N:1</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Item</span>  <span class="directive">extends</span> AbstractEntity{
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> price;
}
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Offer</span> <span class="directive">extends</span> AbstractEntity{
    <span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY) <span class="comment">// Defaults to EAGER</span>
    <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ITEM_ID</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>,
    foreignKey = <span class="annotation">@ForeignKey</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">FK_ITEM_ID</span><span class="delimiter">&quot;</span></span>) )
    <span class="directive">private</span> Item item;

    <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">offer_value</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> value;
 }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"> <span class="class">create</span> <span class="type">table</span> Item (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        version <span class="predefined-type">bigint</span>,
        name <span class="predefined-type">varchar</span>(<span class="integer">255</span>),
        price <span class="predefined-type">decimal</span>(<span class="integer">19</span>,<span class="integer">2</span>),
        <span class="directive">primary</span> <span class="type">key</span> (id)
    )
      <span class="class">create</span> <span class="type">table</span> Offer (
        id <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        version <span class="predefined-type">bigint</span>,
        offer_value <span class="predefined-type">decimal</span>(<span class="integer">19</span>,<span class="integer">2</span>),
        ITEM_ID <span class="predefined-type">bigint</span> <span class="keyword">not</span> <span class="predefined-constant">null</span>,
        <span class="directive">primary</span> <span class="type">key</span> (id)
    )
    <span class="class">alter</span> <span class="type">table</span> Offer
        <span class="class">add</span> <span class="type">constraint</span> FK_ITEM_ID
        <span class="directive">foreign</span> <span class="type">key</span> (ITEM_ID)
        <span class="keyword">references</span> Item</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Many-To-Many N:M</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__mapkey">48. @MapKey</h2>
<div class="sectionbody">
<div class="paragraph">
<p>source : <em><a href="https://en.wikibooks.org/wiki/Java_Persistence/Relationships#Nested_Collections.2C_Maps_and_Matrices" class="bare">https://en.wikibooks.org/wiki/Java_Persistence/Relationships#Nested_Collections.2C_Maps_and_Matrices</a></em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="directive">private</span> <span class="type">long</span> id;
  <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">List</span>&lt;Project&gt;&gt; projects;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@GeneratedValue</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@MapKey</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, ProjectType&gt; projects;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ProjectType</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@GeneratedValue</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  <span class="annotation">@ManyToOne</span>
  <span class="directive">private</span> Employee employee;
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PROJ_TYPE</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> type;
  <span class="annotation">@ManyToMany</span>
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Project&gt; projects;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_callbacks">49. Callbacks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__prepersist">49.1. @PrePersist</h3>
<div class="literalblock">
<div class="content">
<pre>Wykonanie operacji przed operacją zapisu</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__preremove">49.2. @PreRemove</h3>
<div class="literalblock">
<div class="content">
<pre>Wykonanie operacji przez operacją usunięcia</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__postpersist">49.3. @PostPersist</h3>
<div class="literalblock">
<div class="content">
<pre>Wykonanie operacji po operacji zapisu</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__postremove">49.4. @PostRemove</h3>
<div class="literalblock">
<div class="content">
<pre>Wykonanie operacji po operacji usunięcia</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__preupdate">49.5. @PreUpdate</h3>
<div class="literalblock">
<div class="content">
<pre>Wykonanie kodu przed operacją aktualizacji</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__postupdate">49.6. @PostUpdate</h3>
<div class="literalblock">
<div class="content">
<pre>Wykonanie kodu po operacji aktualizacji</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__postload">49.7. @PostLoad</h3>
<div class="literalblock">
<div class="content">
<pre>Wykonanie akcji po załadowaniu encji z kontekstu trwałości</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eventlistener">50. EventListener</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@EntityListeners</span>( LastUpdateListener.class )
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Person</span> {

    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">private</span> <span class="predefined-type">Date</span> dateOfBirth;

    <span class="annotation">@Transient</span>
    <span class="directive">private</span> <span class="type">long</span> age;

    <span class="directive">private</span> <span class="predefined-type">Date</span> lastUpdate;

    <span class="annotation">@PostLoad</span>
    <span class="directive">public</span> <span class="type">void</span> calculateAge() {
        age = ChronoUnit.YEARS.between( LocalDateTime.ofInstant(
                Instant.ofEpochMilli( dateOfBirth.getTime()), ZoneOffset.UTC),
            LocalDateTime.now()
        );
    }
}

<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">LastUpdateListener</span> {

    <span class="annotation">@PreUpdate</span>
    <span class="annotation">@PrePersist</span>
    <span class="directive">public</span> <span class="type">void</span> setLastUpdate( Person p ) {
        p.setLastUpdate( <span class="keyword">new</span> <span class="predefined-type">Date</span>() );
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_criteria">51. Query, Criteria</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>umożliwia dostęp do danych w bazie za pomocą wyspecjalizowanych zapytań czy API</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tożsamość_obiektu_equals_hashcode">52. Tożsamość obiektu : Equals &amp; hashcode</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>brak (Object) - (oparte na nie odłączanych encjach)</p>
</li>
<li>
<p>ID tożsamość bazodanowa</p>
</li>
<li>
<p>klucz biznesowy</p>
</li>
<li>
<p>application managed id - (z bazy danych na aplikacje) (moment poczęcia lub urodzenia)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_identyczność_obiektów">53. Identyczność obiektów</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_identyczność_obiektów_2">53.1. Identyczność obiektów</h3>
<div class="ulist">
<ul>
<li>
<p>Są identyczne jeśli zajmują tą samą referencje w VM.
Sprawdzamy ją za pomocą operatora '=='</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_równość_obiektów">53.2. Równość obiektów</h3>
<div class="ulist">
<ul>
<li>
<p>Są równe jeśli operacja equals daje wynik pozytywny</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tożsamość_bazodanowa">53.3. Tożsamość bazodanowa</h3>
<div class="ulist">
<ul>
<li>
<p>Są identyczne z poziomu DB , tzn jeśli dotyczą tego samego wiersza w tabeli i mają ten sam klucz główny</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_klucz_główny_musi_spełniać_następujące_warunki">53.3.1. Klucz główny musi spełniać następujące warunki</h4>
<div class="ulist">
<ul>
<li>
<p>jego wartość nigdy nie może być równa null</p>
</li>
<li>
<p>każdy wiersz posiada inną wartość</p>
</li>
<li>
<p>wartość dla konkretnego wiersza nigdy się nie zmienia</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_klucz_naturalny">53.3.2. Klucz naturalny</h4>
<div class="ulist">
<ul>
<li>
<p>ma znaczenie biznesowe</p>
</li>
<li>
<p>odpowiedni dobór kandydatów / stały w ciągu całego życia</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Interfejs IdentifierGeneretor do generowania własnych strategii kluczy identyfikujących
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_klucz_główny">54. Klucz główny</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>klasa klucza głównego spełnia wymagania :</p>
<div class="ulist">
<ul>
<li>
<p>public class</p>
</li>
<li>
<p>klasa musi posiadać domyślny publiczny konstruktor</p>
</li>
<li>
<p>musi implementować metody equals i hasCode</p>
</li>
<li>
<p>musi być serializowalna</p>
</li>
<li>
<p>klucz złożony musi być reprezentowany i mapowany do wielu pól właściwości klasy encji. Musi być też reprezentowany i mapowany jako klasa osadzona.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relacje_jedno_i_dwukierunkowe">55. Relacje jedno i dwukierunkowe</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>dwukierunkowa :</p>
<div class="ulist">
<ul>
<li>
<p>obie encje posiadają wzajemnie do siebie relacje</p>
</li>
<li>
<p>strona przynależna związku dwukierunkowego musi odnosić się do swojego właściciela za poprzez użycie elementu <strong>mappedBy</strong> , należącego do adnotacji @OneToMany, @ManyToOne , lub @ManyToMany</p>
</li>
<li>
<p>strona wielokrotna dwukierunkowego związku wiele do jednego nie może definiować <strong>mappedBy</strong> - jest zawsze 'posiadającą stroną relacji'</p>
</li>
<li>
<p>w relacji jeden do jeden strona posiadająca pokazuje stronie przynależnej odpowiedni klucz obcy.</p>
</li>
<li>
<p>w relacji wiele do wielu każda ze stron może być posiadająca.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_charakterystyka">55.1. Charakterystyka</h3>
<div class="ulist">
<ul>
<li>
<p>owning side - strona włacicielska</p>
</li>
<li>
<p>inverse side - strona przeciwna</p>
</li>
<li>
<p>możliwość nawigacji między powiązanymi encjami. Asocjacja dwukierunkowa jest definiowana jako para asocjacji jednokierunkowych, ze wskazaniem jednej z nich jako głównej.</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Wiążemy ze sobą obie strony relacji
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>przykład kodu :</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Stosować tylko gdy są uzasadnione biznesowo -Enkapsulacja. Są tworzone przez generatory JPA. Mogą ułatwiać pisanie zapytań ale nie muszą :)
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>jednokierunkowe
Tylko jedna strona posiada relację do innej encji</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__onetoone">56. @OneToOne</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>każda ze stron możę być właścicielem relacji. Musimy określić stronę bo doprowadzimy do powstania zależności cyklicznej</p>
<div class="literalblock">
<div class="content">
<pre>source : https://en.wikibooks.org/wiki/Java_Persistence/OneToOne</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ObjectRelational-OneToOne.jpg" alt="ObjectRelational OneToOne">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@OneToOne</span>(fetch=FetchType.LAZY)
  <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ADDRESS_ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> Address address;
  ...
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_dwukierunkowa">56.1. Dwukierunkowa</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">ADDRESS_ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@OneToOne</span>(fetch=FetchType.LAZY, mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> Employee owner;
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_z_dodatkową_tabelą_łączącą_relacje">56.2. Z dodatkową tabelą łączącą relacje</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@OneToOne</span>(fetch=FetchType.LAZY)
  <span class="annotation">@JoinTable</span>(
      name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ADD</span><span class="delimiter">&quot;</span></span>,
      joinColumns=
        <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>),
      inverseJoinColumns=
        <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ADDR_ID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ADDRESS_ID</span><span class="delimiter">&quot;</span></span>))
  <span class="directive">private</span> Address address;
  ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ze_wspólnym_kluczem_głównym">56.3. Ze wspólnym kluczem głównym</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
<span class="annotation">@Id</span>
<span class="annotation">@GeneratedValue</span>(generator = TableGenerator)
<span class="directive">protected</span> <span class="predefined-type">Long</span> id;
<span class="annotation">@NotNull</span>
<span class="directive">protected</span> <span class="predefined-type">String</span> street;
}
<span class="comment">//</span>
<span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">USERS</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Id</span>
<span class="directive">protected</span> <span class="predefined-type">Long</span> id;

<span class="annotation">@OneToOne</span>(fetch = FetchType.LAZY,optional = <span class="predefined-constant">false</span>)
<span class="annotation">@PrimaryKeyJoinColumn</span>
<span class="directive">protected</span> Address address;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__onetomany">57. @OneToMany</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>strona 'wiele' musi być właścicielem relacji</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source : <em><a href="https://en.wikibooks.org/wiki/Java_Persistence/OneToMany" class="bare">https://en.wikibooks.org/wiki/Java_Persistence/OneToMany</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ObjectRelational-OneToMany2.jpg" alt="ObjectRelational OneToMany2">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">owner</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Phone&gt; phones;
  ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__manytoone">58. @ManyToOne</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>strona 'wiele' musi być właścicielem relacji. Odwrotność relacji @OneToMany</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source : <em><a href="https://en.wikibooks.org/wiki/Java_Persistence/ManyToOne" class="bare">https://en.wikibooks.org/wiki/Java_Persistence/ManyToOne</a></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Phone</span> {
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@ManyToOne</span>(fetch=FetchType.LAZY)
  <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">OWNER_ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> Employee owner;
  ...
}</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ObjectRelational-ManyToOne2.jpg" alt="ObjectRelational ManyToOne2">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__manytomany">59. @ManyToMany</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>dowolna strona może być właścicelem relacji</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source: <em><a href="https://en.wikibooks.org/wiki/Java_Persistence/ManyToMany" class="bare">https://en.wikibooks.org/wiki/Java_Persistence/ManyToMany</a></em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@ManyToMany</span>
  <span class="annotation">@JoinTable</span>(
      name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_PROJ</span><span class="delimiter">&quot;</span></span>,
      joinColumns=<span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMP_ID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>),
      inverseJoinColumns=<span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PROJ_ID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>))
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Project&gt; projects;
  .....</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_dwukierunkowa_2">59.1. Dwukierunkowa</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Project</span> {
  <span class="annotation">@Id</span>
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@ManyToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">projects</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Employee&gt; employees;
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dodatkowa_kolumna_w_tabeli_złączenia">59.2. Dodatkowa kolumna w tabeli złączenia :</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;ProjectAssociation&gt; projects;
  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Project</span> {
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> id;
  ...
  <span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">project</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;ProjectAssociation&gt; employees;
  ...
  <span class="comment">// Add an employee to the project.</span>
  <span class="comment">// Create an association object for the relationship and set its data.</span>
  public <span class="type">void</span> addEmployee(Employee employee, <span class="type">boolean</span> teamLead) {
    ProjectAssociation association = <span class="keyword">new</span> ProjectAssociation();
    association.setEmployee(employee);
    association.setProject(<span class="local-variable">this</span>);
    association.setEmployeeId(employee.getId());
    association.setProjectId(<span class="local-variable">this</span>.getId());
    association.setIsTeamLead(teamLead);

    <span class="local-variable">this</span>.employees.add(association);
    <span class="comment">// Also add the association object to the employee.</span>
    employee.getProjects().add(association);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PROJ_EMP</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@IdClass</span>(ProjectAssociationId.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProjectAssociation</span> {
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> employeeId;
  <span class="annotation">@Id</span>
  <span class="directive">private</span> <span class="type">long</span> projectId;
  <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">IS_PROJECT_LEAD</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="type">boolean</span> isProjectLead;
  <span class="annotation">@ManyToOne</span>
  <span class="annotation">@PrimaryKeyJoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EMPLOYEEID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>)
  <span class="comment">/* if this JPA model doesn't create a table for the &quot;PROJ_EMP&quot; entity,
  *  please comment out the @PrimaryKeyJoinColumn, and use the ff:
  *  @JoinColumn(name = &quot;employeeId&quot;, updatable = false, insertable = false)
  * or @JoinColumn(name = &quot;employeeId&quot;, updatable = false, insertable = false, referencedColumnName = &quot;id&quot;)
  */</span>
  <span class="directive">private</span> Employee employee;
  <span class="annotation">@ManyToOne</span>
  <span class="annotation">@PrimaryKeyJoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PROJECTID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>)
  <span class="comment">/* the same goes here:
  *  if this JPA model doesn't create a table for the &quot;PROJ_EMP&quot; entity,
  *  please comment out the @PrimaryKeyJoinColumn, and use the ff:
  *  @JoinColumn(name = &quot;projectId&quot;, updatable = false, insertable = false)
  * or @JoinColumn(name = &quot;projectId&quot;, updatable = false, insertable = false, referencedColumnName = &quot;id&quot;)
  */</span>
  <span class="directive">private</span> Project project;
  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ProjectAssociationId</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

  <span class="directive">private</span> <span class="type">long</span> employeeId;

  <span class="directive">private</span> <span class="type">long</span> projectId;

  <span class="directive">public</span> <span class="type">int</span> hashCode() {
    <span class="keyword">return</span> (<span class="type">int</span>)(employeeId + projectId);
  }

  <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> object) {
    <span class="keyword">if</span> (object <span class="keyword">instanceof</span> ProjectAssociationId) {
      ProjectAssociationId otherId = (ProjectAssociationId) object;
      <span class="keyword">return</span> (otherId.employeeId == <span class="local-variable">this</span>.employeeId) &amp;&amp; (otherId.projectId == <span class="local-variable">this</span>.projectId);
    }
    <span class="keyword">return</span> <span class="predefined-constant">false</span>;
  }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kaskadowość">60. Kaskadowość</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>korzystamy z adnotacji <strong>@CascadeType</strong></p>
<div class="ulist">
<ul>
<li>
<p>ALL (agreguje wszystkie poniższe)</p>
</li>
<li>
<p>DETACH (jeśli encja macieżysta została odłączona od kontekstu wtedy również encja związna jest także odłączana)</p>
</li>
<li>
<p>MERGE (jeśli encja macieżysta została przyłączona do kontekstu również encje powiązane zostaną przyłączone)</p>
</li>
<li>
<p>PERSIST (jeśli encja macieżysta została utrwalona to samo stanie się z encjami przynależnymi)</p>
</li>
<li>
<p>REFRESH (jeśli encja macieżysta została odświeżona w kontekście trwałości również encje powiązane zostaną odświeżone)</p>
</li>
<li>
<p>REMOVE  (jeśli encja macieżysta została usunięta z kontekstu trwałości to również encje powiazane zostaną usunięte)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usuwanie_sierot_orphanremoval">61. Usuwanie sierot - orphanRemoval</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Kaskadowe usunięcie tych encji składowych, które usunięto z kolekcji encji głównej</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> orphanRemovalTest() {
<span class="predefined-type">Long</span> id = createLibrary();

Session session = SessionUtil.getSession();
Transaction tx = session.beginTransaction();

Library library = (Library) session.load(Library.class, id);
assertEquals(library.getBooks().size(), <span class="integer">3</span>);

library.getBooks().remove(<span class="integer">0</span>);
assertEquals(library.getBooks().size(), <span class="integer">2</span>);

tx.commit();
session.close();

session = SessionUtil.getSession();
tx = session.beginTransaction();

Library l2 = (Library) session.load(Library.class, id);
assertEquals(l2.getBooks().size(), <span class="integer">2</span>);
<span class="predefined-type">Query</span> query = session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book b</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span> books = query.list();
assertEquals(books.size(), <span class="integer">2</span>);

tx.commit();
session.close();
}

<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Library</span> {

<span class="annotation">@OneToMany</span>(orphanRemoval = <span class="predefined-constant">true</span>, mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">library</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; books = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
}

<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {

<span class="annotation">@ManyToOne</span>
Library library;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pobieranie_encji">62. Pobieranie encji</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>load()</p>
<div class="ulist">
<ul>
<li>
<p>Na podstawie danego Id metoda load próbuje pobrać obiekt z bazy danych. Jeśli obiekt nie istnieje wyrzucany jest wyjątek org.hibernate.ObjectNotFoundExceptionMetoda load() zwraca też proxy, oznacza to tyle, że nie nastąpi uderzenie do bazy danych do czasu kiedy faktycznie będziemy potrzebować danego obiektu. Proxy zwraca dummy object zamiast uderzyć do db. Jeśli obiekt jest w first-level cache zwróci obiekt. Jeśli obiektu nie ma w first-level-cache uderzy do bazy.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Object</span> load(<span class="predefined-type">Class</span> theClass, <span class="predefined-type">Serializable</span> id) <span class="directive">throws</span> HibernateException
<span class="directive">public</span> <span class="predefined-type">Object</span> load(<span class="predefined-type">String</span> entityName, <span class="predefined-type">Serializable</span> id) <span class="directive">throws</span> HibernateException
<span class="directive">public</span> <span class="type">void</span> load(<span class="predefined-type">Object</span> object, <span class="predefined-type">Serializable</span> id) <span class="directive">throws</span> HibernateException</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>get()</p>
<div class="ulist">
<ul>
<li>
<p>Na podstawie danego Id metoda get() próbuje pobrać obiekt z bazy danych. Jeśli obiekt nie istnieje zwraca null. Metoda get() w przeciwieństwie do metody load() uderza do bazy bezpośrednio.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Object</span> get(<span class="predefined-type">Class</span> clazz, <span class="predefined-type">Serializable</span> id) <span class="directive">throws</span> HibernateException
<span class="directive">public</span> <span class="predefined-type">Object</span> get(<span class="predefined-type">String</span> entityName, <span class="predefined-type">Serializable</span> id) <span class="directive">throws</span> HibernateException
<span class="directive">public</span> <span class="predefined-type">Object</span> get(<span class="predefined-type">Class</span> clazz, <span class="predefined-type">Serializable</span> id, LockMode lockMode) <span class="directive">throws</span> HibernateException
<span class="directive">public</span> <span class="predefined-type">Object</span> get(<span class="predefined-type">String</span> entityName, <span class="predefined-type">Serializable</span> id, LockMode lockMode) <span class="directive">throws</span> HibernateException</code></pre>
</div>
</div>
<div class="paragraph">
<p>przykład :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Book</span> book = (<span class="predefined-type">Book</span>) session.load(<span class="predefined-type">Book</span>.class, isbn);

<span class="predefined-type">Book</span> book = (<span class="predefined-type">Book</span>) session.get(<span class="predefined-type">Book</span>.class, isbn);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_save_persist">63. SAVE/PERSIST</h2>
<div class="sectionbody">
<div class="paragraph">
<p>public Serializable save(Object object) throws HibernateException</p>
</div>
<div class="paragraph">
<p>public Serializable save(String entityName,Object object) throws HibernateException</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_merge_vs_update">64. MERGE vs UPDATE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Merge Does Following</p>
</div>
<div class="paragraph">
<p>Merge has intelligence. It has lot of pre-checks before it go actual merge(if required)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>if Object is transient, It simply fires INSERT query makes object persistent(attached to session)
if Object is detached, fires select query to check whether data modified or not if modified, fires UPDATE query otherwise just ignore merge task.</pre>
</div>
</div>
<div class="paragraph">
<p>where as session.update</p>
</div>
<div class="literalblock">
<div class="content">
<pre>throws exception if object is transient.
if Object is detached, it simply fires UPDATE query irrespective of data changes to object.</pre>
</div>
</div>
<div class="paragraph">
<p>session.merge is expensive than update</p>
</div>
<div class="paragraph">
<p>saveOrUpdate() .
This particular method is used to save or update records. Hibernate updates the records for a
given object if the identifier field is given. If an identifier is not given, then hibernate will insert
a new record.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trwałość_przechodnia">65. Trwałość przechodnia</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Technika umożliwiająca automatyczną propagację trwałości na podgrafy ulotne i odłączone.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trwałość_przez_osiągalność">66. Trwałość przez osiągalność</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jeśli z obiektu trwałego dostajemy się do innego obiektu poprzez referencje. Działanie jest rekurencyjne.
Dowolny graf obiektów można odtworzyć w całości wczytując jego korzeń.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Pomaga uzyskać trwałość obiektom ulotnym i propagować je do bazy danych bez potrzeby wywołań zarządcy trwałości
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_trwałość_kaskadowa">67. Trwałość kaskadowa</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Koncepcja podobna do trwałości przez osiągalność
Powiązania są odtwarzane na podstawie asocjacji.
Sprawdza asocjacje by określić stan trwałości obiektów.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do sterowania trwałością kaskadową używamy adnotacji <strong>@CascadeType</strong> na kolekcji lub relacji
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zapytania">68. Zapytania</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_kwerandy">69. Kwerandy</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_możliwe_formy_zapytań">70. Możliwe formy zapytań :</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zapytania_hql_jpql">70.1. zapytania HQL, JPQL</h3>
<div class="ulist">
<ul>
<li>
<p>Odpowiednik SQL</p>
</li>
<li>
<p>zamiast tabel i pól operuje na obiektach i jego właściwościach.</p>
</li>
<li>
<p>przenośny zależny od dostawcy
**</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_możliwe_typy_wników_kwerend">70.2. Możliwe typy wników kwerend:</h3>
<div class="ulist">
<ul>
<li>
<p>Typy bazowe : String, int, boolean, JDBC types, etc</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; lastNames = session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT e.firstName FROM </span><span class="delimiter">&quot;</span></span>+Employee.class.getSimpleName().list();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Encje</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TypedQuery&lt;Person&gt; typedQuery = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name like :name</span><span class="delimiter">&quot;</span></span>, Person.class
);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Tablice objektów</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span> result = em.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT e.name, e.department.name FROM Project p JOIN p.employees e WHERE p.name = ?1 ORDER BY e.name</span><span class="delimiter">&quot;</span></span>)
  .setParameter(<span class="integer">1</span>, projectName)
   .getResultList();
<span class="type">int</span> count = <span class="integer">0</span>;
<span class="keyword">for</span> (<span class="predefined-type">Iterator</span> i = result.iterator(); i.hasNext();) {
<span class="predefined-type">Object</span><span class="type">[]</span> values = (<span class="predefined-type">Object</span><span class="type">[]</span>) i.next();
....

}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Tuple</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; tuples = entityManager.createNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">find_person_with_phones_by_name</span><span class="delimiter">&quot;</span></span> ).setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">J%</span><span class="delimiter">&quot;</span></span>).getResultList();

<span class="keyword">for</span>(<span class="predefined-type">Object</span><span class="type">[]</span> tuple : tuples) {
    Person person = (Person) tuple[<span class="integer">0</span>];
    Phone phone = (Phone) tuple[<span class="integer">1</span>];
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>DTO generowane przez konstruktor</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select pl.java.scalatech.BookDTO(b.name, b.id, b.isbn) from Book b</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> query = entityManager.createQuery(sql);
<span class="predefined-type">List</span>&lt;BookDTO&gt; books = query.getResultgetResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = session.createQuery(sql);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_criteria_api">70.3. Criteria API</h3>

</div>
<div class="sect2">
<h3 id="_native_sql">70.4. native SQL</h3>

</div>
<div class="sect2">
<h3 id="_hibernate_criteria">70.5. Hibernate Criteria</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Criteria criteria = session.createCriteria(Employee.class);
criteria.add(Restrictions.eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">department.name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">account</span><span class="delimiter">&quot;</span></span>));
<span class="predefined-type">List</span> list = criteria.list();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_select">71. SELECT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SELECT &lt;select_expression&gt;
FROM &lt;from_clause&gt;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_projekcja_projection">72. Projekcja / Projection</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>zwracanie tylko interesujących użytkownika zapytań</p>
</li>
<li>
<p>redukcja użycia pamięci</p>
</li>
<li>
<p>zwiększona szybkość wykonania</p>
</li>
<li>
<p>zwiększona szybkość przetwarzania</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select b.name from Book b</span><span class="delimiter">&quot;</span></span>;

sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select b.id, b.name , b.isbn from Book c</span><span class="delimiter">&quot;</span></span>;

<span class="predefined-type">Query</span> query = entityManager.createQuery(sql);
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; books = query.getResultList();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_sql_result_mapping">72.1. SQL result-mapping</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.hibernate.SQLQuery query = session.createSQLQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select {i.*} from ITEM {i}</span><span class="delimiter">&quot;</span></span>).addEntity(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>, Item.class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_projekcja_z_użyciem_konstruktora">72.2. Projekcja z użyciem konstruktora</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select pl.java.scalatech.BookDTO(b.name, b.id, b.isbn) from Book b</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> query = entityManager.createQuery(sql);
<span class="predefined-type">List</span>&lt;BookDTO&gt; books = query.getResultgetResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restriction_where_zawężamy">73. Restriction /  where –  zawężamy</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Book where name=</span><span class="delimiter">&quot;</span></span>Qua vadis<span class="string"><span class="delimiter">&quot;</span><span class="content">;
sql = </span><span class="delimiter">&quot;</span></span>from <span class="predefined-type">Book</span> where name like <span class="string"><span class="delimiter">'</span><span class="content">%Qu</span><span class="delimiter">'</span></span><span class="string"><span class="delimiter">&quot;</span><span class="content">;
sql = </span><span class="delimiter">&quot;</span></span>from <span class="predefined-type">Book</span> where price &gt; <span class="integer">40</span><span class="string"><span class="delimiter">&quot;</span><span class="content">;

Query query = session.createQuery(sql);
List&lt;Book&gt; books = query.getResultList();
</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_like">73.1. Like</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> {
<span class="predefined-type">Query</span> query = em.createQuery(
<span class="string"><span class="delimiter">&quot;</span><span class="content">select p from Person p where firstName like '%a%'</span><span class="delimiter">&quot;</span></span>
);
Person person = (Person) query.getSingleResult();
<span class="comment">// ...</span>
} <span class="keyword">catch</span> (NonUniqueResultException ex) {
<span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zwiększanie_wydajności_poprzez_agregacje_po_stronie_bazy">74. Zwiększanie wydajności poprzez agregacje po stronie bazy</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_natywna_kwerenda_sql">75. Natywna kwerenda SQL</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SQLQuery sqlQuery = session.createSQLQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM product</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; list = sqlQuery.list();
<span class="keyword">for</span>(<span class="predefined-type">Object</span><span class="type">[]</span> object : list){
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Id: </span><span class="delimiter">&quot;</span></span> + object[<span class="integer">0</span>]);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Name: </span><span class="delimiter">&quot;</span></span> + object[<span class="integer">1</span>]);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Price: </span><span class="delimiter">&quot;</span></span> + object[<span class="integer">2</span>]);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Category id: </span><span class="delimiter">&quot;</span></span> + object[<span class="integer">3</span>]);
}

SQLQuery sqlQuery = session.createSQLQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name, price,
category_id FROM product</span><span class="delimiter">&quot;</span></span>);
sqlQuery.addScalar(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> org.hibernate.type.LongType());
sqlQuery.addScalar(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> org.hibernate.type.StringType());
sqlQuery.addScalar(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> org.hibernate.type.DoubleType());
sqlQuery.addScalar(<span class="string"><span class="delimiter">&quot;</span><span class="content">category_id</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span>
org.hibernate.type.LongType());
sqlQuery.setResultTransformer(Transformers.ALIAS_TO_ENTITY_MAP);
<span class="predefined-type">List</span> list = sqlQuery.list();

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; persons = entityManager.createNativeQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM person</span><span class="delimiter">&quot;</span></span> )
.getResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SQLQuery sqlQuery = session.createSQLQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM category</span><span class="delimiter">&quot;</span></span>);
sqlQuery.addEntity(Category.class);
<span class="predefined-type">List</span>&lt;Category&gt; list = sqlQuery.list();
<span class="keyword">for</span>(Category category: list){
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Category id: </span><span class="delimiter">&quot;</span></span> + category.getId());
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Category name: </span><span class="delimiter">&quot;</span></span> + category.getName());
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 3</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; lastNames = session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT e.firstName FROM </span><span class="delimiter">&quot;</span></span>+Employee.class.getSimpleName()
  + <span class="string"><span class="delimiter">&quot;</span><span class="content"> e  e.company c join c.depts d WHERE d.name = :name</span><span class="delimiter">&quot;</span></span>)
  .setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JAVA</span><span class="delimiter">&quot;</span></span>).list();
  og.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastNames {}</span><span class="delimiter">&quot;</span></span>,lastNames);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_natywne_native">75.1. Natywne / NATIVE</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; persons = entityManager.createNativeQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM person</span><span class="delimiter">&quot;</span></span> )
.getResultList();

<span class="keyword">for</span>(<span class="predefined-type">Object</span><span class="type">[]</span> person : persons) {
    <span class="predefined-type">BigInteger</span> id = (<span class="predefined-type">BigInteger</span>) person[<span class="integer">0</span>];
    <span class="predefined-type">String</span> name = (<span class="predefined-type">String</span>) person[<span class="integer">1</span>];
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hql_kwerendy">76. HQL kwerendy</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM Category</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span>&lt;Category&gt; list = query.list();
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Category size: </span><span class="delimiter">&quot;</span></span> + list.size());

<span class="predefined-type">Query</span> query = session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">FroM Category, Product</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span> list = query.list();
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Result size: </span><span class="delimiter">&quot;</span></span> + list.size());

<span class="predefined-type">Query</span> query = session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name from Category</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span> list = query.list();
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Result size: </span><span class="delimiter">&quot;</span></span> + list.size());</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_jpa_natywne_kwerendy">76.1. JPA natywne kwerendy</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createNativeQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM person</span><span class="delimiter">&quot;</span></span>, Person.class ).getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_natywne_kwerendy_z_aliasami">76.2. Natywne kwerendy z aliasami</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; entities = session.createSQLQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT {pr.*}, {pt.*} </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">FROM person pr, partner pt </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE pr.name = pt.name</span><span class="delimiter">&quot;</span></span> )
.addEntity( <span class="string"><span class="delimiter">&quot;</span><span class="content">pr</span><span class="delimiter">&quot;</span></span>, Person.class)
.addEntity( <span class="string"><span class="delimiter">&quot;</span><span class="content">pt</span><span class="delimiter">&quot;</span></span>, Partner.class)
.list();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zapytania_nazywane_namedquery">77. Zapytania nazywane / NamedQuery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>W celu wygodniejszego używania oraz większej wydajności korzysta się tzw nazwanych zapytań.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prekompilacja</p>
</li>
<li>
<p>powiązanie z encją
(( model programowy</p>
<div class="literalblock">
<div class="content">
<pre>*@NamedQuery* : pojedyńcze natywne zapytanie
*@NamedQueries* : agregacja kilku natywnych zapytań</pre>
</div>
</div>
</li>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedQuery</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCategoryNameByName</span><span class="delimiter">&quot;</span></span>, query=<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM Category c WHERE c.name=:name</span><span class="delimiter">&quot;</span></span>)

session.getNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">getCategoryNameByName</span><span class="delimiter">&quot;</span></span>);

<span class="annotation">@NamedQueries</span>(
{
<span class="annotation">@NamedQuery</span>(
name=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCategoryNameByName</span><span class="delimiter">&quot;</span></span>,
query=<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM Category c WHERE c.name=:name</span><span class="delimiter">&quot;</span></span>
),
<span class="annotation">@NamedQuery</span>(
name=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCategoryNameById</span><span class="delimiter">&quot;</span></span>,
query=<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM Category c WHERE c.id=:id</span><span class="delimiter">&quot;</span></span>
),
}
)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Zapytania nazwane umieszcza się na klasie encyjnej
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedQueries</span>({
<span class="annotation">@NamedQuery</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Company.findAll</span><span class="delimiter">&quot;</span></span>,query=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Company c</span><span class="delimiter">&quot;</span></span>),
<span class="annotation">@NamedQuery</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">Company.findByPrimaryKey</span><span class="delimiter">&quot;</span></span>, query=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Company c WHERE c.id = :id</span><span class="delimiter">&quot;</span></span>)})
<span class="predefined-type">Query</span> q = entityManager.getNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">Company.findAll</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_natywne_w_konfiguracja_z_join">77.1. Natywne w konfiguracja z JOIN</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedNativeQuery</span>(
    name = <span class="string"><span class="delimiter">&quot;</span><span class="content">find_person_with_phones_by_name</span><span class="delimiter">&quot;</span></span>,
    query =
        <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   pr.id AS </span><span class="char">\&quot;</span><span class="content">pr.id</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   pr.name AS </span><span class="char">\&quot;</span><span class="content">pr.name</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   pr.nickName AS </span><span class="char">\&quot;</span><span class="content">pr.nickName</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   pr.address AS </span><span class="char">\&quot;</span><span class="content">pr.address</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   pr.createdOn AS </span><span class="char">\&quot;</span><span class="content">pr.createdOn</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   pr.version AS </span><span class="char">\&quot;</span><span class="content">pr.version</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   ph.id AS </span><span class="char">\&quot;</span><span class="content">ph.id</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   ph.person_id AS </span><span class="char">\&quot;</span><span class="content">ph.person_id</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   ph.number AS </span><span class="char">\&quot;</span><span class="content">ph.number</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">   ph.type AS </span><span class="char">\&quot;</span><span class="content">ph.type</span><span class="char">\&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">FROM person pr </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">JOIN phone ph ON pr.id = ph.person_id </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE pr.name LIKE :name</span><span class="delimiter">&quot;</span></span>,
    resultSetMapping = <span class="string"><span class="delimiter">&quot;</span><span class="content">person_with_phones</span><span class="delimiter">&quot;</span></span>
)
 <span class="annotation">@SqlResultSetMapping</span>(
     name = <span class="string"><span class="delimiter">&quot;</span><span class="content">person_with_phones</span><span class="delimiter">&quot;</span></span>,
     entities = {
         <span class="annotation">@EntityResult</span>(
             entityClass = Person.class,
             fields = {
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">pr.id</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">pr.name</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">nickName</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">pr.nickName</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">pr.address</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">createdOn</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">pr.createdOn</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">pr.version</span><span class="delimiter">&quot;</span></span> ),
             }
         ),
         <span class="annotation">@EntityResult</span>(
             entityClass = Phone.class,
             fields = {
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">ph.id</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">ph.person_id</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">ph.number</span><span class="delimiter">&quot;</span></span> ),
                 <span class="annotation">@FieldResult</span>( name = <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, column = <span class="string"><span class="delimiter">&quot;</span><span class="content">ph.type</span><span class="delimiter">&quot;</span></span> ),
             }
         )
     }
 ),</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zapytania_nazywane_podejście_programistyczne">77.2. Zapytania nazywane podejście programistyczne</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> findPersonQuery = em.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select p from Person p</span><span class="delimiter">&quot;</span></span>);
em.getEntityManagerFactory().addNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">personQuery</span><span class="delimiter">&quot;</span></span>, findPersonQuery);
<span class="predefined-type">Query</span> query =
em.createNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">personQuery</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tuple">77.3. Tuple</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; tuples = entityManager.createNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">find_person_with_phones_by_name</span><span class="delimiter">&quot;</span></span> ).setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">J%</span><span class="delimiter">&quot;</span></span>).getResultList();

<span class="keyword">for</span>(<span class="predefined-type">Object</span><span class="type">[]</span> tuple : tuples) {
    Person person = (Person) tuple[<span class="integer">0</span>];
    Phone phone = (Phone) tuple[<span class="integer">1</span>];
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_from">78. FROM</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Book</span><span class="delimiter">&quot;</span></span>;
sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Book b</span><span class="delimiter">&quot;</span></span>;
sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as book</span><span class="delimiter">&quot;</span></span>;
sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">pl.java.scalatech.Book</span><span class="delimiter">&quot;</span></span>;

<span class="predefined-type">Query</span> query = session.createQuery(sql);
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; books = query.getResultgetResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name like :name</span><span class="delimiter">&quot;</span></span>
);

TypedQuery&lt;Person&gt; typedQuery = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name like :name</span><span class="delimiter">&quot;</span></span>, Person.class
);</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_native">78.1. Native</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedQueries</span>(
    <span class="annotation">@NamedQuery</span>(
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">get_person_by_name</span><span class="delimiter">&quot;</span></span>,
        query = <span class="string"><span class="delimiter">&quot;</span><span class="content">select p from Person p where name = :name</span><span class="delimiter">&quot;</span></span>
    )
)

<span class="predefined-type">Query</span> query = entityManager.createNamedQuery( <span class="string"><span class="delimiter">&quot;</span><span class="content">get_person_by_name</span><span class="delimiter">&quot;</span></span> );

TypedQuery&lt;Person&gt; typedQuery = entityManager.createNamedQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">get_person_by_name</span><span class="delimiter">&quot;</span></span>, Person.class
);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hint">78.2. Hint</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name like :name</span><span class="delimiter">&quot;</span></span> )
<span class="comment">// timeout - in milliseconds</span>
.setHint( <span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.query.timeout</span><span class="delimiter">&quot;</span></span>, <span class="integer">2000</span> )
<span class="comment">// flush only at commit time</span>
.setFlushMode( FlushModeType.COMMIT );</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_javax_persistence_query_timeout">78.2.1. javax.persistence.query.timeout</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy timeout dla kwerendy</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_javax_persistence_fetchgraph">78.2.2. javax.persistence.fetchgraph</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy EntityGraph</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_org_hibernate_cachemode">78.2.3. org.hibernate.cacheMode</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy rodzaj buforowania</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_org_hibernate_cacheable">78.2.4. org.hibernate.cacheable</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy czy kewrenda ma być buforowana</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_org_hibernate_cacheregion">78.2.5. org.hibernate.cacheRegion</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy nazwę regionu bufora</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_org_hibernate_comment">78.2.6. org.hibernate.comment</h4>
<div class="ulist">
<ul>
<li>
<p>oznaczamy opisowo daną kwerende</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_org_hibernate_fetchsize">78.2.7. org.hibernate.fetchSize</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy fetchSize</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_org_hibernate_flushmode">78.2.8. org.hibernate.flushMode</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy flushMode dla kwerendy</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_org_hibernate_readonly">78.2.9. org.hibernate.readOnly</h4>
<div class="ulist">
<ul>
<li>
<p>definujemy czy interesujący nas obiekt  ma być tylko do odczytu</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_timestamp_3">78.3. Timestamp</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">   <span class="predefined-type">Query</span> query = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.createdOn &gt; :timestamp</span><span class="delimiter">&quot;</span></span> )
    .setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span>, timestamp, TemporalType.DATE );</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_konkadenacja">78.4. Konkadenacja</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> name = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select 'Customer ' || p.name </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.id = 1</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getSingleResult();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_porównania">78.5. Porównania</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// numeric comparison</span>
<span class="predefined-type">List</span>&lt;Call&gt; calls = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where c.duration &lt; 30 </span><span class="delimiter">&quot;</span></span>, Call.class )
.getResultList();

<span class="comment">// string comparison</span>
<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name like 'John%' </span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();

<span class="comment">// datetime comparison</span>
<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.createdOn &gt; '1950-01-01' </span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();

<span class="comment">// enum comparison</span>
<span class="predefined-type">List</span>&lt;Phone&gt; phones = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Phone p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.type = 'MOBILE' </span><span class="delimiter">&quot;</span></span>, Phone.class )
.getResultList();

<span class="comment">// boolean comparison</span>
<span class="predefined-type">List</span>&lt;Payment&gt; payments = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Payment p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.completed = true </span><span class="delimiter">&quot;</span></span>, Payment.class )
.getResultList();

<span class="comment">// boolean comparison</span>
<span class="predefined-type">List</span>&lt;Payment&gt; payments = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Payment p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where type(p) = WireTransferPayment </span><span class="delimiter">&quot;</span></span>, Payment.class )
.getResultList();

<span class="comment">// entity value comparison</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; phonePayments = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Payment p, Phone ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.person = ph.person </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_like_2">78.6. Like</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name like ?1</span><span class="delimiter">&quot;</span></span> )
.setParameter( <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">J%</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kwerenda_z_wielu_podmiotów">79. Kwerenda z wielu podmiotów</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select distinct pr, ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr, Phone ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where ph.person = pr and ph is not null</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class)
.getResultList();

<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select distinct pr1 </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr1, Person pr2 </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where pr1.id &lt;&gt; pr2.id </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">  and pr1.address = pr2.address </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">  and pr1.createdOn &lt; pr2.createdOn</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CallStatistics</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="type">long</span> count;
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">long</span> total;
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> min;
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> max;
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">double</span> abg;

    <span class="directive">public</span> CallStatistics(<span class="type">long</span> count, <span class="type">long</span> total, <span class="type">int</span> min, <span class="type">int</span> max, <span class="type">double</span> abg) {
        <span class="local-variable">this</span>.count = count;
        <span class="local-variable">this</span>.total = total;
        <span class="local-variable">this</span>.min = min;
        <span class="local-variable">this</span>.max = max;
        <span class="local-variable">this</span>.abg = abg;
    }

    <span class="comment">//Getters and setters omitted for brevity</span>
}

CallStatistics callStatistics = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select new org.hibernate.userguide.hql.CallStatistics(</span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    count(c), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    sum(c.duration), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    min(c.duration), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    max(c.duration), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    avg(c.duration)</span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">)  </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, CallStatistics.class )
.getSingleResult();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamiczna_instancja_przykład">80. Dynamiczna instancja - przykład</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">List</span>&gt; phoneCallDurations = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select new list(</span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    p.number, </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    c.duration </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">)  </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone p </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">List</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dynamiczna_mapa_przykład">81. Dynamiczna mapa - przykład</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&gt; phoneCallTotalDurations = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select new map(</span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    p.number as phoneNumber , </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    sum(c.duration) as totalDuration, </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    avg(c.duration) as averageDuration </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">)  </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone p </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Map</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where">82. Where</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT DISTINCT d FROM Department d, Employee e WHERE d = e.department</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_parametryzacja">83. Parametryzacja</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = em.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select i from Item i where i.auctionEnd &gt; :endDate</span><span class="delimiter">&quot;</span></span>).setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">endDate</span><span class="delimiter">&quot;</span></span>, tomorrowDate, TemporalType.TIMESTAMP);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zabezpiecza przed  SQL injection
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wstawienie_przez_kwerende">84. Wstawienie przez kwerende</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> insertedEntities = session.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">insert into Partner (id, name) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p.id, p.name </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span>)
.executeUpdate();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_dopasowane_operacje_insert_update_delete">84.1. Dopasowane operacje : Insert, Update , Delete</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">CHAOS</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SQLInsert</span>( sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO CHAOS(size, name, nickname, id) VALUES(?,upper(?),?,?)</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SQLUpdate</span>( sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE CHAOS SET size = ?, name = upper(?), nickname = ? WHERE id = ?</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SQLDelete</span>( sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE CHAOS WHERE id = ?</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SQLDeleteAll</span>( sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE CHAOS</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Loader</span>(namedQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">chaos</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@NamedNativeQuery</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">chaos</span><span class="delimiter">&quot;</span></span>, query=<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, size, name, lower( nickname ) as nickname from CHAOS where id= ?</span><span class="delimiter">&quot;</span></span>, resultClass = Chaos.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Chaos</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="directive">private</span> <span class="predefined-type">Long</span> size;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">String</span> nickname;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_przykrywanie_operacji_na_kolecjach_przez_adnotacje">84.2. Przykrywanie operacji na kolecjach przez adnotacje</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">chaos_fk</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SQLInsert</span>( sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE CASIMIR_PARTICULE SET chaos_fk = ? where id = ?</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SQLDelete</span>( sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE CASIMIR_PARTICULE SET chaos_fk = null where id = ?</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Set</span>&lt;CasimirParticle&gt; particles = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;CasimirParticle&gt;();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_update">85. UPDATE</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> updatedEntities = entityManager.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">update Person p set p.name = :newName where p.name = :oldName</span><span class="delimiter">&quot;</span></span> )
 .setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">oldName</span><span class="delimiter">&quot;</span></span>, oldName )
 .setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">newName</span><span class="delimiter">&quot;</span></span>, newName )
 .executeUpdate();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_bulk_update">85.1. Bulk update</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TransactionAttribute</span>(TransactionAttributeType.REQUIRES_NEW)
<span class="directive">public</span> <span class="type">void</span> setManager(Department dept, Employee manager) {
em.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE Employee e </span><span class="delimiter">&quot;</span></span> +<span class="string"><span class="delimiter">&quot;</span><span class="content">SET e.manager = :name </span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE e.department = :dept</span><span class="delimiter">&quot;</span></span>)
.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span>)
.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">dept</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JAVA</span><span class="delimiter">&quot;</span></span>)
.executeUpdate();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delete">86. Delete</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> deletedEntities = entityManager.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete Person p where p.name = :name</span><span class="delimiter">&quot;</span></span> ).setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, name ).executeUpdate();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query=session.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from Employee where status=:status</span><span class="delimiter">&quot;</span></span>);
query.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fired</span><span class="delimiter">&quot;</span></span>);
<span class="type">int</span> rowsDeleted=query.executeUpdate();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_distinct">87. Distinct</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT DISTINCT mag FROM Magazine AS mag JOIN mag.articles AS art WHERE art.published = FALSE</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_between">88. Between</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join p.phones ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.id = 1L and index(ph) between 0 and 3</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();

<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.createdOn between '1999-01-01' and '2001-01-02'</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();

<span class="predefined-type">List</span>&lt;Call&gt; calls = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where c.duration between 5 and 20</span><span class="delimiter">&quot;</span></span>, Call.class )
.getResultList();

<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name between 'H' and 'M'</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_is_not_empty">89. IS [NOT] EMPTY</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ist&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.phones is empty</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();

<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.phones is not empty</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__not_member_of">90. [NOT] MEMBER [OF]</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where 'Home address' member of p.addresses</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();

<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where 'Home address' not member of p.addresses</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_podzapytania">91. Podzapytania</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT b FROM <span class="predefined-type">Book</span> b WHERE b.price = (SELECT MAX(emp.salary) FROM Employee emp)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_in">92. IN</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT  FROM Person p WHERE p.sex IN (<span class="string"><span class="delimiter">'</span><span class="content">MALE</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">FEMALE</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operacje_na_kolekcjach">93. Operacje na kolekcjach</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT e FROM Company c  WHERE c.products IS NOT EMPTY
SELECT e FROM Company c WHERE :project MEMBER OF c.products</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sortowanie">94. Sortowanie</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Book b order by b.name asc</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> query = entityManager.createQuery(sql);
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; books = query.getResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">order by p.name</span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; personTotalCallDurations = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p.name, sum( c.duration ) as total </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join ph.person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">group by p.name </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">order by total</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_agregacje">95. Agregacje</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_avg">95.1. AVG</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span><span class="type">[]</span> callStatistics = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    count(c), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    sum(c.duration), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    min(c.duration), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    max(c.duration), </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    avg(c.duration)  </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class )
.getSingleResult();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_count">95.2. COUNT</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Long</span> phoneCount = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select count( distinct c.phone ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class )
.getSingleResult();


<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; callCount = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p.number, count(c) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">group by p.number</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_max">95.3. MAX</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT d, COUNT(e), MAX(e.salary), AVG(e.salary) FROM Department d JOIN d.employees e GROUP BY d HAVING COUNT(e) &gt;= <span class="integer">5</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_min">95.4. MIN</h3>

</div>
<div class="sect2">
<h3 id="_sum">95.5. SUM</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_group_by">96. GROUP BY</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT d.name, COUNT(e)
FROM Department d JOIN d.employees e
GROUP BY d.name</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przyklad 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Long</span> totalDuration = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select sum( c.duration ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class )
.getSingleResult();

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; personTotalCallDurations = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p.name, sum( c.duration ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join ph.person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">group by p.name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class )
.getResultList();

<span class="comment">//It's even possible to group by entities!</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; personTotalCallDurations = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p, sum( c.duration ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join ph.person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">group by p</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_having">97. HAVING</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; personTotalCallDurations = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p.name, sum( c.duration ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join ph.person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">group by p.name </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">having sum( c.duration ) &gt; 1000</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span><span class="type">[]</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stronicowanie">98. Stronicowanie</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Book</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> query = entityManager.createQuery(sql);
query.setFirstResult(<span class="integer">10</span>);
query.setMaxResults(<span class="integer">25</span>);
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; books = query.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pobieranie_pojedyńczego_wyniku">99. Pobieranie pojedyńczego wyniku</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Book b where b.id=:id</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> query = entityManager.createQuery(sql);
query.setLong(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>);
<span class="predefined-type">Book</span> book = (<span class="predefined-type">Book</span>)query.getSingleResult();</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>org.hibernate.NonUniqueResultException</strong> gdy metoda zwróci więcej niż jedne obiekt
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zwraca pojedyńczy obiekt lub <strong>null</strong> jeśli takiego obiektu nie ma w bazie
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> hql = <span class="string"><span class="delimiter">&quot;</span><span class="content">from Product where price &gt; 21.0</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> query = session.createQuery(hql);
query.setMaxResults(<span class="integer">1</span>);
Product product = (Product) query.uniqueResult();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_join">100. JOIN</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT d  FROM Employee e JOIN e.department d</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select distinct pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join pr.phones ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where ph.type = :phoneType</span><span class="delimiter">&quot;</span></span>, Person.class )
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">phoneType</span><span class="delimiter">&quot;</span></span>, PhoneType.MOBILE )
.getResultList();

<span class="comment">// same query but specifying join type as 'inner' explicitly</span>
<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select distinct pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">inner join pr.phones ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where ph.type = :phoneType</span><span class="delimiter">&quot;</span></span>, Person.class )
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">phoneType</span><span class="delimiter">&quot;</span></span>, PhoneType.MOBILE )
.getResultList();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_join_niejawny">100.1. Join niejawny</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT p.number FROM Employee e, Phone p WHERE e = p.employee AND e.department.name = <span class="string"><span class="delimiter">'</span><span class="content">JAVA</span><span class="delimiter">'</span></span> AND p.type = <span class="string"><span class="delimiter">'</span><span class="content">MOBILE</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wielokrotny_join">100.2. Wielokrotny Join</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT DISTINCT p FROM Department d JOIN d.employees e JOIN e.projects p</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_join_left">101. JOIN LEFT</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select distinct pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">left join pr.phones ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where ph is null </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">   or ph.type = :phoneType</span><span class="delimiter">&quot;</span></span>, Person.class )
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">phoneType</span><span class="delimiter">&quot;</span></span>, PhoneType.LAND_LINE )
.getResultList();

<span class="comment">// functionally the same query but using the 'left outer' phrase</span>
<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select distinct pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">left outer join pr.phones ph </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where ph is null </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">   or ph.type = :phoneType</span><span class="delimiter">&quot;</span></span>, Person.class )
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">phoneType</span><span class="delimiter">&quot;</span></span>, PhoneType.LAND_LINE )
.getResultList();


<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; personsAndPhones = session.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select pr.name, ph.number </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">left join pr.phones ph with ph.type = :phoneType </span><span class="delimiter">&quot;</span></span> )
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">phoneType</span><span class="delimiter">&quot;</span></span>, PhoneType.LAND_LINE )
.list();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_join_fetch">102. JOIN FETCH</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select distinct pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person pr </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">left join fetch pr.phones </span><span class="delimiter">&quot;</span></span>, Person.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wyrażenie_in">103. Wyrażenie IN</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT e FROM Employee e WHERE e.phones.type IN (<span class="string"><span class="delimiter">'</span><span class="content">MOBILE</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">HOME</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT e FROM Employee e WHERE e.department IN (SELECT DISTINCT d
 FROM Department d JOIN d.employees de JOIN de.projects p
 WHERE p.name LIKE <span class="string"><span class="delimiter">'</span><span class="content">VA%</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jpql_wspieranie_standardów">104. JPQL wspieranie standardów</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_concat_łącznie_dwóch_lub_większej_ilości_stringów">104.1. CONCAT - łącznie dwóch lub większej ilości stringów</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; callHistory = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select concat( p.number, ' : ' ,c.duration ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone p</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_substring_wycinanie_cześci_stringa_z_danego_ciągu_znaków">104.2. SUBSTRING - wycinanie cześci stringa z danego ciągu znaków</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; prefixes = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select substring( p.number, 0, 2 ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">join c.phone p</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_upper_zamiana_na_duże_litery">104.3. UPPER - zamiana na duże litery</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; names = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select upper( p.name ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lower_zamiana_na_małe_litery">104.4. LOWER - zamiana na małe litery</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; names = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select lower( p.name ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trim_usuwanie_białych_znaków">104.5. TRIM - usuwanie białych znaków</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; names = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select trim( p.name ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_length_obliczanie_długości_ciągu_znaków">104.6. LENGTH - obliczanie długości ciągu znaków</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; lengths = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select length( p.name ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_abs_obliczanie_wartości_absolutnej">104.7. ABS - obliczanie wartości absolutnej</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; abs = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select abs( c.duration ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mod_obliczanie_reszty_z_dzielenia">104.8. MOD - obliczanie reszty z dzielenia</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; mods = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select mod( c.duration, 10 ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sqrt_pierwiastek">104.9. SQRT - pierwiastek</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Double</span>&gt; sqrts = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select sqrt( c.duration ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Double</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_current_date_bieżaca_data">104.10. CURRENT_DATE - bieżaca data</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Call&gt; calls = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where c.timestamp = current_date</span><span class="delimiter">&quot;</span></span>, Call.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_current_time_bieżacy_czas">104.11. CURRENT_TIME - bieżacy czas</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Call&gt; calls = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where c.timestamp = current_time</span><span class="delimiter">&quot;</span></span>, Call.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_current_timestamp_bieżaca_data_i_czas_z_milisek">104.12. CURRENT_TIMESTAMP - bieżaca data i czas z milisek</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Call&gt; calls = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where c.timestamp = current_timestamp</span><span class="delimiter">&quot;</span></span>, Call.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hql_functions">105. HQL functions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cast_rzutowanie">105.1. CAST - rzutowanie</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; durations = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select cast( c.duration as string ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract">105.2. EXTRACT</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; years = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select extract( YEAR from c.timestamp ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_year">105.3. YEAR</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; years = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select year( c.timestamp ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Call c </span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_month">105.4. MONTH</h3>
<div class="ulist">
<ul>
<li>
<p>użycie analogiczne jak w przykładzie wyżej
=== DAY</p>
</li>
<li>
<p>użycie analogiczne jak w przykładzie wyżej
=== HOUR</p>
</li>
<li>
<p>użycie analogiczne jak w przykładzie wyżej
=== MINUTE</p>
</li>
<li>
<p>użycie analogiczne jak w przykładzie wyżej
===  SECOND</p>
</li>
<li>
<p>użycie analogiczne jak w przykładzie wyżej</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_typ_encji">106. Typ encji</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Payment&gt; payments = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Payment p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where type(p) = CreditCardPayment</span><span class="delimiter">&quot;</span></span>, Payment.class )
.getResultList();
<span class="predefined-type">List</span>&lt;Payment&gt; payments = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Payment p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where type(p) = :type</span><span class="delimiter">&quot;</span></span>, Payment.class )
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, WireTransferPayment.class)
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_case">107. Case</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; nickNames = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    case p.nickName </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    when 'NA' </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    then '&lt;no nick name&gt;' </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    else p.nickName </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">    end </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();

<span class="comment">// same as above</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; nickNames = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select coalesce(p.nickName, '&lt;no nick name&gt;') </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class )
.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_użycie_konstruktora">108. Użycie konstruktora</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT NEW pl.java.scalatech.EmployeeReport(e.firstName, e.lastName, e.salary) FROM Employee e</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usuwanie_obiektów_z_bazy">109. Usuwanie obiektów z bazy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Poprzez wywołanie metody remove lub kaskadowej operacji remove
Jeśli metoda remove jest wywołana na encji odłączonej zostanie wygenerowany wyjątek IllegalArgumentException lub zatwierdzenie transakcji się nie powiedzie.
Dane fizycznie zostaną usunięte w momencie zakończenia transakcji lub wykonania metody flush()</p>
</div>
<div class="paragraph">
<p>DELETE FROM employee WHERE id=1;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Book</span> book = (<span class="predefined-type">Book</span>) session.get(<span class="predefined-type">Book</span>.class,<span class="keyword">new</span> <span class="predefined-type">Long</span>(<span class="integer">1</span>));
session.delete(book);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Metoda ta wyrzuci wyjątek jeśli obiekt o podanym identyfikatorze nie istnieje w bazie (java.lang.IllegalArgumentException)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aktualizacja">110. Aktualizacja</h2>
<div class="sectionbody">
<div class="paragraph">
<p>UPDATE book SET title='jpa book' WHERE id=2;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_merge">111. Merge</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Merge jest odwrotną operacją do operacji refresh()</p>
</li>
<li>
<p>Nadpisuje encje w bazie danych wartościami encji odłączonych.</p>
<div class="ulist">
<ul>
<li>
<p>Object merge(Object object)</p>
</li>
<li>
<p>Object merge(String entityName, Object object)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Session session = factory.openSession();
tx = session.beginTransaction();
Company company = (Company)session.get(Company.class, <span class="integer">1</span>);
company.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scalatech S.p z.o.o</span><span class="delimiter">&quot;</span></span>);
tx.commit();
session.flush();
session.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_odświeżanie_encji_refreshing_entities">112. Odświeżanie encji (Refreshing Entities)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metoda <strong>reload</strong> odświeża wartości dla encji wartościami z bazy danych. (odwrotność do merge)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> refresh(<span class="predefined-type">Object</span> object)  <span class="directive">throws</span> HibernateException

<span class="directive">public</span> <span class="type">void</span> refresh(<span class="predefined-type">Object</span> object, LockMode lockMode)  <span class="directive">throws</span> HibernateException</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Hibernate</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Object merge(Object object)

Object merge(String entityName, Object object)</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_geneza_jpa">113. Geneza JPA</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="img/jpa.png" alt="jpa"></span></p>
</div>
<div class="paragraph">
<p><strong>Java Persistence API (JPA)</strong> jest specyfikacją wydaną dla ujednolicenia różnych dostawców trwałości.
- start odbył się w 2006 roku (wersja <strong>1.0</strong>)
- w 2013 roku podstała wersja aktualna t.j <strong>2.1</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dostawcy_trwałości">114. Dostawcy trwałości</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Hibernate</strong> <a href="http://hibernate.org/orm/" class="bare">http://hibernate.org/orm/</a></p>
</li>
<li>
<p><strong>EclipseLink</strong> <a href="http://www.eclipse.org/eclipselink/" class="bare">http://www.eclipse.org/eclipselink/</a></p>
</li>
<li>
<p><strong>Open JPA</strong> <a href="http://openjpa.apache.org/" class="bare">http://openjpa.apache.org/</a></p>
</li>
<li>
<p><strong>TopLink</strong> <a href="http://www.oracle.com/technetwork/middleware/toplink/overview/index.html" class="bare">http://www.oracle.com/technetwork/middleware/toplink/overview/index.html</a></p>
</li>
<li>
<p><strong>Kodo</strong> <a href="http://docs.oracle.com/html/E13946_01/toc.htm" class="bare">http://docs.oracle.com/html/E13946_01/toc.htm</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/jpaProviders.png" alt="jpaProviders">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_utrwalanie">115. Utrwalanie</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>@Encje</strong></p>
</li>
<li>
<p><strong>@MappedSuperClass</strong></p>
</li>
<li>
<p><strong>@Embeddable</strong></p>
</li>
<li>
<p><strong>@CollectionElement (dla typów prostych lub klas osadzonych)</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_użycie_entitymanager_a_jpa">116. Użycie EntityManager&#8217;a [JPA]</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zależności">116.1. Zależności</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>hibernate-entitymanager<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>4.3.5.Final<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_schemat_zależności">116.2. Schemat zależności</h3>
<div class="imageblock">
<div class="content">
<img src="img/entityManager.jpg" alt="entityManager">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entitymanagerfactory_jpa_sessionfactory_hibernate">116.3. EntityManagerFactory(JPA) = SessionFactory(Hibernate)</h3>
<div class="paragraph">
<p>source : <em><a href="http://www.java-forums.org/ocpjbcd/53005-tutorial-review-entitymanager-context-component-developer-exam.html" class="bare">http://www.java-forums.org/ocpjbcd/53005-tutorial-review-entitymanager-context-component-developer-exam.html</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/A7-EntityManagerFactory.jpg" alt="A7 EntityManagerFactory">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Może być programowalny manualnie lub przy pomocy pliku persistence.xml, który to musi znajdować się w classpath projektu.
Każdemu EntityManagerFactory odpowiada jedna jednostka trwałości (Persistence Unit)</pre>
</div>
</div>
<div class="sect3">
<h4 id="_bootstraping">116.3.1. Bootstraping</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManagerFactory emf = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">manager1</span><span class="delimiter">&quot;</span></span>);
<span class="comment">//or</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; configOverrides = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;();
configOverrides.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>);
EntityManagerFactory programmaticEmf = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">manager1</span><span class="delimiter">&quot;</span></span>, configOverrides);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entitymanager">116.4. EntityManager</h3>
<div class="paragraph">
<p>source: <em><a href="http://www.java-forums.org/ocpjbcd/53005-tutorial-review-entitymanager-context-component-developer-exam.html" class="bare">http://www.java-forums.org/ocpjbcd/53005-tutorial-review-entitymanager-context-component-developer-exam.html</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/A7-EntityManagerFactory.jpg" alt="A7 EntityManagerFactory">
</div>
</div>
<div class="sect3">
<h4 id="_cechy">116.4.1. Cechy</h4>
<div class="ulist">
<ul>
<li>
<p>pozwala wykonywać operacje CRUD na encjach.</p>
</li>
<li>
<p>pozwala też na wykonanie zapytań.</p>
</li>
<li>
<p>odpowiada mu jeden kontekst trwałości - czyli zbiór obiektów zarządzanych przez EntityManagera w danej chwili</p>
</li>
<li>
<p>unikaly obiekt w ramach kontekstu trwałości to taki który posiada unikalny identyfikator</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> EntityManager getEntityManager() {
 EntityManagerFactory managerFactory = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">myPu</span><span class="delimiter">&quot;</span></span>);
 EntityManager manager = managerFactory.createEntityManager();
<span class="keyword">return</span> manager;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cykl_życia_2">116.4.2. Cykl życia</h4>
<div class="imageblock">
<div class="content">
<img src="img/A7-EntityLifecycle.jpg" alt="A7 EntityLifecycle">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_metody_2">116.4.3. Metody</h4>
<div class="imageblock">
<div class="content">
<img src="img/A7-EntityManagerInterfaceMethods.jpg" alt="A7 EntityManagerInterfaceMethods">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uzyskiwanie_enititymanagera_wersja_numer_1">116.4.4. Uzyskiwanie EnitityManagera wersja numer 1</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>
EntityManager em;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uzyskiwanie_entitymanagera_wersja_numer_2">116.4.5. Uzyskiwanie EntityManagera wersja numer 2</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceUnit</span>
EntityManagerFactory emf;
EntityManager em = emf.createEntityManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>WARNING:Menadżery encji zarządzane przez aplikację nie propagują automatycznie kontekstu transakcji JTA. Musimy to robić manualnie</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        EntityManagerFactory entityManagerFactory = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">pu</span><span class="delimiter">&quot;</span></span>);
        EntityManager em = entityManagerFactory.createEntityManager();
        EntityTransaction userTransaction = em.getTransaction();
        userTransaction.begin();

        User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">slawek</span><span class="delimiter">&quot;</span></span>);
        em.persist(user);
        userTransaction.commit();
        em.close();
        entityManagerFactory.close();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@PersistenceUnit</span>(unitName = <span class="string"><span class="delimiter">&quot;</span><span class="content">pu</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> EntityManagerFactory entityManagerFactory;
    <span class="annotation">@Resource</span>
    <span class="directive">private</span> UserTransaction userTransaction;
    <span class="directive">private</span> <span class="predefined-type">Book</span> book;

    <span class="directive">public</span> <span class="predefined-type">String</span> saveBook() {
        <span class="predefined-type">String</span> returnValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">BookAdded</span><span class="delimiter">&quot;</span></span>;
        <span class="keyword">try</span> {
            userTransaction.begin();
            EntityManager em = entityManagerFactory.createEntityManager();
            em.persist(book);
            userTransaction.commit();
            em.close();
            returnValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">BookAddedConfirmation</span><span class="delimiter">&quot;</span></span>;
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            e.printStackTrace();
        }
        <span class="keyword">return</span> returnValue;
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enititymanager_lokalnie">116.4.6. EnitityManager Lokalnie</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManagerFactory entityManagerFactory = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">pu</span><span class="delimiter">&quot;</span></span>);
EntityManager entityManager = entityManagerFactory.createEntityManager();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enititymanager_zdalnie">116.5. EnitityManager Zdalnie</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>(unitName = <span class="string"><span class="delimiter">&quot;</span><span class="content">pu</span><span class="delimiter">&quot;</span></span>)
EntityManager manager;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metody_3">116.6. Metody</h3>
<div class="sect3">
<h4 id="_utrwalenie">116.6.1. utrwalenie</h4>
<div class="ulist">
<ul>
<li>
<p>em.persist(object);</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_wyszukanie">116.6.2. wyszukanie</h4>
<div class="ulist">
<ul>
<li>
<p>Employee e = em.find(Employee.class, new Long(10));</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_usuwanie">116.6.3. usuwanie</h4>
<div class="ulist">
<ul>
<li>
<p>em.remove(object);</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_persistence_xml">116.7. persistence.xml</h3>
<div class="paragraph">
<p>Powinnien znajdować się w classpath w katalogu <strong>META-INF</strong>
Plik <strong>persistence.xml</strong> jest unikalny dla danego kontekstu <strong>persistence unit</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myPu</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RESOURCE_LOCAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;mapping-file&gt;</span>Author.hbm.xml<span class="tag">&lt;/mapping-file&gt;</span>
<span class="tag">&lt;mapping-file&gt;</span>Book.hbm.xml<span class="tag">&lt;/mapping-file&gt;</span>

<span class="tag">&lt;class&gt;</span>domain.Author<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;class&gt;</span>domain.Book<span class="tag">&lt;/class&gt;</span>

<span class="tag">&lt;properties&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.driver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:file:~/testjpa</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.dialect.HSQLDialect</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/properties&gt;</span>
<span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>RESOURCE_LOCAL transaction</strong> - sama aplikacja zarządza transakcjami .</p>
</li>
<li>
<p><strong>JTA transaction</strong> - transakcjami zarządza kontener na serwerze aplikacyjnym</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_persistence_unit">117. Persistence Unit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jednostka trwałości - sposób na komunikowanie się z bazą
Jest skonfigurowany w pliku persistence.xml</p>
</div>
<div class="paragraph">
<p>source : eclipse.org</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/otlcg_jd_001.gif" alt="otlcg jd 001">
</div>
</div>
<div class="sect2">
<h3 id="_praca_w_wieloma_jednostkami_trwałości">117.1. Praca w wieloma jednostkami trwałości</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/xml/ns/persistence</span>
<span class="content">http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pu1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RESOURCE_LOCAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="comment">&lt;!-- details --&gt;</span>
<span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pu2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RESOURCE_LOCAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="comment">&lt;!-- details --&gt;</span>
<span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span>
// code...
EntityManagerFactory emf = Persistence.createEntityManagerFactory(&quot;pu1&quot;);
EntityManager em = emf.createEntityManager();
em.persist(entity);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_programowy_persistence_xml">117.1.1. Programowy persistence.xml</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; prop = Maps.newHashMap();

prop.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.transactionType</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">RESOURCE_LOCAL</span><span class="delimiter">&quot;</span></span>);
prop.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jtaDataSource</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
prop.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.driver</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>);
prop.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.jdbc.url</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:</span><span class="delimiter">&quot;</span></span>);

EntityManagerFactory emf = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">pu</span><span class="delimiter">&quot;</span></span>,prop);
EntityManager em = emf.createEntityManager();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mapowanie_klas">117.1.2. Mapowanie klas</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unit1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RESOURCE_LOCAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;provider&gt;</span>org.hibernate.ejb.HibernatePersistence<span class="tag">&lt;/provider&gt;</span>
<span class="tag">&lt;class&gt;</span>pl.java.scalatech.domain.Employee<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;class&gt;</span>pl.java.scalatech.domain.Department<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;class&gt;</span>pl.java.scalatech.domain.Poject<span class="tag">&lt;/class&gt;</span>
....</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_persistence_context">118. Persistence Context</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>służy do tworzenia obiektów klasy EntityManagerFactory</p>
</li>
<li>
<p>zbiór obiektów zarządzanych przez entityManagera w danej chwili</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">//include::{resourcedir}META-INF/persistence.xml[]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManagerFactory emf = Persistence.createEntityManagerFactory(<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloWorldPU</span><span class="delimiter">&quot;</span></span>);

UserTransaction tx = TM.getUserTransaction();
tx.begin();
EntityManager em = emf.createEntityManager();
Message message = <span class="keyword">new</span> Message()
message.setText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>);
em.persist(message);
tx.commit();
<span class="comment">// INSERT into MESSAGE (ID, TEXT) values (1, 'Hello World!')</span>
em.close();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dostęp_do_hibernate_api_z_poziomu_jpa">119. Dostęp do Hibernate API z poziomu JPA</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Session session = entityManager.unwrap( Session.class );
SessionImplementor sessionImplementor = entityManager.unwrap( SessionImplementor.class );

SessionFactory sessionFactory = entityManager.getEntityManagerFactory().unwrap( SessionFactory.class );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_metamodel">120. MetaModel</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_generacja">120.1. Generacja</h3>
<div class="paragraph">
<p>Konfiguracja w Gradle :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sourceSets {
    intTest
    generated.java.srcDirs=[<span class="string"><span class="delimiter">'</span><span class="content">src/main/generated</span><span class="delimiter">'</span></span>]
    main {
        java { srcDir <span class="string"><span class="delimiter">'</span><span class="content">src/main/java</span><span class="delimiter">'</span></span> }
        resources { srcDir <span class="string"><span class="delimiter">'</span><span class="content">src/main/resources</span><span class="delimiter">'</span></span> }
    }
    test {
        java { srcDir <span class="string"><span class="delimiter">'</span><span class="content">src/test/java</span><span class="delimiter">'</span></span> }
        resources { srcDir <span class="string"><span class="delimiter">'</span><span class="content">src/test/resources</span><span class="delimiter">'</span></span> }
    }
}

repositories {
    mavenCentral()
}

configurations {
    providedRuntime
    jpametamodel
}

dependencies {
    jpametamodel (<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate:hibernate-jpamodelgen:4.3.1.Final</span><span class="delimiter">&quot;</span></span>)
 }

task generateMetaModel(<span class="key">type</span>: JavaCompile, <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>, <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">metamodel generate</span><span class="delimiter">'</span></span>) {

    source = sourceSets.main.java
    classpath = configurations.compile + configurations.jpametamodel
    options.compilerArgs = [<span class="string"><span class="delimiter">&quot;</span><span class="content">-proc:only</span><span class="delimiter">&quot;</span></span>]
    destinationDir = sourceSets.generated.java.srcDirs.iterator().next()

    doFirst {
        logger.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">Prepare dictionary structures  </span><span class="delimiter">&quot;</span></span> +sourceSets.generated.java.srcDirs)
        <span class="comment">//delete(sourceSets.generated.java.srcDirs)</span>
        <span class="comment">//sourceSets.generated.java.srcDirs.mkdirs()</span>
    }
}
compileJava.dependsOn generateMetaModel
compileJava.source sourceSets.generated.java, sourceSets.main.java</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Pet</span> {
  <span class="annotation">@Id</span>
  <span class="directive">protected</span> <span class="predefined-type">Long</span> id;
  <span class="directive">protected</span> <span class="predefined-type">String</span> name;
  <span class="directive">protected</span> <span class="predefined-type">String</span> color;
  <span class="annotation">@ManyToOne</span>
  <span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Owner</span>&gt; owners;
  ...
}

<span class="annotation">@Static</span> Metamodel(Pet.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Pet_</span> {

  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Pet, <span class="predefined-type">Long</span>&gt; id;
  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Pet, <span class="predefined-type">String</span>&gt; name;
  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Pet, <span class="predefined-type">String</span>&gt; color;
  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SetAttribute&lt;Pet, <span class="predefined-type">Owner</span>&gt; owners;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
EntityType&lt;Pet&gt; Pet_ = pet.getModel();


EntityManager em = ...;
Metamodel m = em.getMetamodel();
EntityType&lt;Pet&gt; Pet_ = m.entity(Pet.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_autoreferencja">121. Autoreferencja</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>relacja jaka zachodzi pomiędzy polami relacji tej samej encji</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="type">class</span> <span class="class">Category</span>{

<span class="annotation">@ManyToOne</span>
<span class="directive">private</span> Category parent;

<span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">parent</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;Category&gt; child;

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dziedziczenie_polimorfizm">122. Dziedziczenie / Polimorfizm</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_mappedsuperclass_table_per_concrete_class_with_implicit_polymorphism">123. MappedSuperclass Table per concrete class with implicit polymorphism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Właściwości klasy oznaczonej tą adnotacją będą propagowane na klasy pochodne. W relacji bazodanowej oznacza to, że kolumny będą propagowane do tabel pośredniczących tej strategii. Taka klasa nie będzie miała odwzorowania w bazie danych.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Abstract class
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Klasy z adnotacją <strong>@MappedSuperclass</strong> nie mogą być używane do wyszukiwania oraz w zapytaniach JPQL.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MappedSuperclass</span>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">BillingDetails</span> {
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">OWNER</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>)
<span class="directive">private</span> <span class="predefined-type">String</span> owner;
...
}

<span class="annotation">@Entity</span>
<span class="annotation">@AttributeOverride</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">owner</span><span class="delimiter">&quot;</span></span>, column =<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">CC_OWNER</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCard</span> <span class="directive">extends</span> BillingDetails {
    <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">CREDIT_CARD_ID</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">Long</span> id = <span class="predefined-constant">null</span>;

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">NUMBER</span><span class="delimiter">&quot;</span></span>, nullable = <span class="predefined-constant">false</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> number;
        ...
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>source <a href="https://detailfocused.wordpress.com" class="bare">https://detailfocused.wordpress.com</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/tablePerConcreteClass.jpg" alt="tablePerConcreteClass"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tabela_na_każdą_hierarchię_klas_table_per_class_hierarchy_single_table_strategy">124. Tabela na każdą hierarchię klas (Table per class hierarchy /   Single-Table Strategy)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Martin Fowler Pattern</strong> : <a href="http://martinfowler.com/eaaCatalog/singleTableInheritance.html" class="bare">http://martinfowler.com/eaaCatalog/singleTableInheritance.html</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Symulacja dziedziczenia oparta jest na jednej tabeli.</p>
</li>
<li>
<p>Tabela zawiera kolumny dotyczące wszystkich właściwości klas</p>
</li>
<li>
<p>Kolumny zadeklarowe w podklasach muszą dopuszczą wartości <strong>NULL</strong></p>
</li>
<li>
<p>do odróżnienia podklas stosuje się dodatkową kolumnę - dyskryminator (wyłącznie wartość logiczna )
-</p>
</li>
<li>
<p>source <a href="https://detailfocused.wordpress.com" class="bare">https://detailfocused.wordpress.com</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/singleTable.jpg" alt="singleTable">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Najbardziej wydajna oraz najprostsza ze wszystkich strategii
Jeśli potrzebujemy korzystać z zapytań polimorficznych do klasy bazowej i podklasy zawierają niewiele własnych właściowości - wybierz tą strategię
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Dopuszczanie wartości <strong>NULL</strong> może stanowić zagrożenie integralności danych. Straty miejsca w bazie. Brak normalizacji danych.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Zbyt wiele kolumn w tabeli może mieć impakt na wydajność.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Inheritance</span>(strategy=InheritanceType.SINGLE_TABLE)
<span class="annotation">@DiscriminatorColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">billing_type</span><span class="delimiter">&quot;</span></span>, discriminatorType=DiscriminatorType.STRING, length=<span class="integer">2</span>)
<span class="annotation">@DiscriminatorValue</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">BD</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BillingDetails</span> {

}
<span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@DiscriminatorValue</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">CC</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCard</span> <span class="directive">extends</span> BillingDetails {
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Możliwe wartości dyskriminatora to :</strong>  String, char, int, byte, short, boolean(including yes_no, true_false).</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Dla każdej z podklas dyskryminator musi być unikalny. Jeśli go nie określimy będzie się nazywał jak podklasa
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_discriminator_formula">124.1. Discriminator formula</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Account</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Inheritance</span>(strategy = InheritanceType.SINGLE_TABLE)
<span class="annotation">@DiscriminatorFormula</span>(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">case when debitKey is not null </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">then 'Debit' </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">else ( </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">   case when creditKey is not null </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">   then 'Credit' </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">   else 'Unknown' </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">   end ) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">end </span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Account</span> {

    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> owner;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> balance;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> interestRate;

<span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">DebitAccount</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@DiscriminatorValue</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">Debit</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">DebitAccount</span> <span class="directive">extends</span> Account {

    <span class="directive">private</span> <span class="predefined-type">String</span> debitKey;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> overdraftFee;

}

<span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">CreditAccount</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@DiscriminatorValue</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">Credit</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">CreditAccount</span> <span class="directive">extends</span> Account {

    <span class="directive">private</span> <span class="predefined-type">String</span> creditKey;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> creditLimit;
 }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> Account (
    id int8 <span class="keyword">NOT</span> <span class="predefined-constant">NULL</span> ,
    balance NUMERIC(<span class="integer">19</span>, <span class="integer">2</span>) ,
    interestRate NUMERIC(<span class="integer">19</span>, <span class="integer">2</span>) ,
    owner <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>) ,
    debitKey <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>) ,
    overdraftFee NUMERIC(<span class="integer">19</span>, <span class="integer">2</span>) ,
    creditKey <span class="predefined-type">VARCHAR</span>(<span class="integer">255</span>) ,
    creditLimit NUMERIC(<span class="integer">19</span>, <span class="integer">2</span>) ,
    <span class="directive">PRIMARY</span> <span class="type">KEY</span> ( id )
)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tabla_na_każdą_podklasę_table_per_subclass_joined_strategy">125. Tabla na każdą podklasę (Table per subclass/joined strategy.)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Martin Fowler Pattern</strong> : <a href="http://martinfowler.com/eaaCatalog/classTableInheritance.html" class="bare">http://martinfowler.com/eaaCatalog/classTableInheritance.html</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>wykorzystanie relacji do emulacji dziedziczenia.</p>
</li>
<li>
<p>realizacja za pomocą kluczy obcych</p>
</li>
<li>
<p>osobną tabela dla każdej klasy</p>
</li>
<li>
<p>wspólny klucz główny (klucz główny głównej tabeli jest kluczem obcym dla tabeli pochodnych)</p>
</li>
<li>
<p>najłatwiejsze zarządzanie bazą</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
główna zaleta tej strategii to pełna normalizacja modelu relacyjnego. Jeśli potrzebujemy korzystać z zapytań polimorficznych do klasy bazowej i podklasy zawierają wiele własnych właściowości - wybierz tą strategię
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
W przypadku złożonych hierarchii wydajność nie jest do zaakceptowania (joins). Zapytania wymagaja złączenia wielu tabel, albo wielu sekwencyjnych odczytów
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Inheritance</span>(strategy=InheritanceType.JOINED)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BillingDetails</span> {
}
<span class="annotation">@Entity</span>
<span class="annotation">@Table</span>
<span class="annotation">@PrimaryKeyJoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">billing_id</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCard</span> <span class="directive">extends</span> BillingDetails {
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="__primarykeyjoincolumns">125.1. @PrimaryKeyJoinColumns</h3>
<div class="ulist">
<ul>
<li>
<p>source :https://detailfocused.wordpress.com</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/joinedStrategy.jpg" alt="joinedStrategy">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tabela_na_klasę_konkretną_table_per_concrete_class">126. Tabela na klasę konkretną  (Table per concrete class)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Martin Fowler Pattern</strong>  <a href="http://martinfowler.com/eaaCatalog/concreteTableInheritance.html" class="bare">http://martinfowler.com/eaaCatalog/concreteTableInheritance.html</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hibernate tworzy osobną tabelę na każdą podklasę.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CAUTION:
* Słaba obsługa asocjacji polimorficznych.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jeśli asocjacje i zapytania polimorficzne nie są potrzebne - wybierz tę strategię
Bardzo dobra wydajność jeśli będziemy pobierali dane jedynie z danego węzła relacji.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Zapytania polimorficzne zwracające obiekty wszystkich klas pasujący stwarzają duże problemy.
  Zapytanie dotyczące klasy bazowej musi zostać robite na n-operacji <strong>SELECT</strong> po czym dane grupowane są za pomocą operacji bazodanowej <strong>UNION</strong>
  Unie są z kolei słabo przenośne.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
zmiana typu jednej właściwości klasy propaguje się na zmiany kolumny w tabelach pochodnych. Każda operacja <strong>CRUD</strong> na tabeli 'root' pociąga zmianę w sub-tabelach
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Inheritance</span>(strategy=InheritanceType.TABLE_PER_CLASS)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BillingDetails</span> {
<span class="annotation">@Id</span>
<span class="annotation">@GeneratedValue</span>(strategy = GenerationType.TABLE)
<span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">long</span> id;
}
<span class="annotation">@Entity</span>
<span class="annotation">@AttributeOverrides</span>({
<span class="annotation">@AttributeOverride</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, column = <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)),
<span class="annotation">@AttributeOverride</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, column = <span class="annotation">@Column</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCard</span> <span class="directive">extends</span> BillingDetails {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/tablePerConcreteClass.jpg" alt="tablePerConcreteClass"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_criteria">127. Criteria</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_criteria_api_2">128. CRITERIA API</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Criteria API ma działanie analogiczne do JPQL z tą różnicą że działamy na obiektach i bytach mocno typowalnych.</p>
</li>
<li>
<p>Model w pełni obiektowy</p>
</li>
<li>
<p>Silnie generyczny</p>
</li>
<li>
<p>Wsparcie MetaModelu</p>
</li>
<li>
<p>dynamicznie budowanie zapytań</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_criteriabuilder">128.1. CriteriaBuilder</h3>
<div class="paragraph">
<p>Tworzony z EntityManagera. Punkt wyjściowy do funkcjonowania interfejsu Criteria API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_criteriaquery_t">128.2. CriteriaQuery&lt;T&gt;</h3>
<div class="paragraph">
<p>Reprezentuje wszystkie warunki użyte w zapytaniu</p>
</div>
</div>
<div class="sect2">
<h3 id="_root_t">128.3. Root&lt;T&gt;</h3>
<div class="paragraph">
<p>Zmienna wskazująca na korzeń zapytania</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;X&gt; Root&lt;X&gt; from( <span class="predefined-type">Class</span>&lt;X&gt; );

&lt;X&gt; Root&lt;X&gt; from( EntityType&lt;X&gt; );

<span class="comment">//example</span>

CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;Person&gt; criteria = builder.createQuery( Person.class );
Root&lt;Person&gt; root = criteria.from( Person.class );</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_typedquery_t">128.4. TypedQuery&lt;T&gt;</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_wyrażenia_expression">129. Wyrażenia / Expression</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/UML-expressions.gif" alt="UML expressions">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_typy_types">130. Typy / Types</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/UML-types.gif" alt="UML types">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kwerendy_guery">131. Kwerendy / guery</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/UML-query.gif" alt="UML query">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_atrybuty_attributes">132. Atrybuty / Attributes</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/UML-attrs.gif" alt="UML attrs">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_metamodel_2">133. MetaModel</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>klasa metamodelu jest tworzona przez generator metamodelu dla każdej klasy encyjnej.</p>
</li>
<li>
<p>nazwa takiej klasy jest zakończona '_'</p>
</li>
<li>
<p>wszystkie atrybuty odpowiadające polom i właściwościom trwałości klasy encji</p>
</li>
<li>
<p>pozwala uzyskać bezpieczeństwo typologiczne i refaktoryzacyjne modelu Criteria API</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_select_2">134. SELECT</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;Person&gt; criteria = builder.createQuery( Person.class );
Root&lt;Person&gt; root = criteria.from( Person.class );
criteria.select( root );
criteria.where( builder.equal( root.get( Person_.name ), <span class="string"><span class="delimiter">&quot;</span><span class="content">Przodownik</span><span class="delimiter">&quot;</span></span> ) );

<span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery( criteria ).getResultList();</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_bez_potrzeby_rzutowania">134.1. Bez potrzeby rzutowania</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery&lt;Person&gt; criteria = cb.createQuery(Person.class);
Root&lt;Person&gt; i = criteria.from(Person.class);
criteria.select(i).where(cb.equal(i.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), PERSON_ID));
TypedQuery&lt;Person&gt; query = em.createQuery(criteria);
Person result = query.getSingleResult();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parametryzacja_2">134.2. Parametryzacja</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery criteria = cb.createQuery();
Root&lt;Person&gt; i = criteria.from(Person.class);
<span class="predefined-type">Query</span> query = em.createQuery(
criteria.select(i).where(cb.equal(i.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>),cb.parameter(<span class="predefined-type">String</span>.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">personName</span><span class="delimiter">&quot;</span></span>)))).setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">personName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">slawek</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_parametryzacja_z_mocną_kontrolą_typów">134.2.1. Parametryzacja z mocną kontrolą typów</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery criteria = cb.createQuery(Person.class);
Root&lt;Person&gt; i = criteria.from(Item.class);
ParameterExpression&lt;<span class="predefined-type">String</span>&gt; personNameParameter = cb.parameter(<span class="predefined-type">String</span>.class);
<span class="predefined-type">Query</span> query = em.createQuery(criteria.select(i).where(cb.equal(i.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>),personNameParameter))).setParameter(personNameParameter, <span class="string"><span class="delimiter">&quot;</span><span class="content">slawek</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wyrażenie_expression">134.3. Wyrażenie / Expression</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;<span class="predefined-type">String</span>&gt; criteria = builder.createQuery( <span class="predefined-type">String</span>.class );
Root&lt;Person&gt; root = criteria.from( Person.class );
criteria.select( root.get( Person_.nickName ) );
criteria.where( builder.equal( root.get( Person_.name ), <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span> ) );

<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; nickNames = entityManager.createQuery( criteria ).getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pojedyńcze_wartości">134.4. Pojedyńcze wartości</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;<span class="predefined-type">String</span>&gt; c = cb.createQuery(<span class="predefined-type">String</span>.class);
Root&lt;Employee&gt; emp = c.from(Employee.class);
c.select(emp.&lt;<span class="predefined-type">String</span>&gt;get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wielokrotne_wartości">134.5. Wielokrotne wartości</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; criteria = builder.createQuery( <span class="predefined-type">Object</span><span class="type">[]</span>.class );
Root&lt;Person&gt; root = criteria.from( Person.class );

Path&lt;<span class="predefined-type">Long</span>&gt; idPath = root.get( Person_.id );
Path&lt;<span class="predefined-type">String</span>&gt; nickNamePath = root.get( Person_.nickName);

criteria.select( builder.array( idPath, nickNamePath ) );
criteria.where( builder.equal( root.get( Person_.name ), <span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span> ) );

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; idAndNickNames = entityManager.createQuery( criteria ).getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multiselect">134.6. Multiselect</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; criteria = builder.createQuery( <span class="predefined-type">Object</span><span class="type">[]</span>.class );
Root&lt;Person&gt; root = criteria.from( Person.class );

Path&lt;<span class="predefined-type">Long</span>&gt; idPath = root.get( Person_.id );
Path&lt;<span class="predefined-type">String</span>&gt; nickNamePath = root.get( Person_.nickName);

criteria.multiselect( idPath, nickNamePath );
criteria.where( builder.equal( root.get( Person_.name ), <span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span> ) );

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; idAndNickNames = entityManager.createQuery( criteria ).getResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Tuple&gt; c= cb.createTupleQuery();
Root&lt;Employee&gt; emp = c.from(Employee.class);
c.select(cb.tuple(emp.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), emp.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)));
CriteriaQuery&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; c = cb.createQuery(<span class="predefined-type">Object</span><span class="type">[]</span>.class);
Root&lt;Employee&gt; emp = c.from(Employee.class);
c.multiselect(emp.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), emp.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aliasy">134.7. Aliasy</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Tuple&gt; c= cb.createTupleQuery();
Root&lt;Employee&gt; emp = c.from(Employee.class);
c.multiselect(
  emp.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>).alias(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>),
  emp.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).alias(<span class="string"><span class="delimiter">&quot;</span><span class="content">fullName</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zapytania_dynamiczne">134.8. Zapytania dynamiczne</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;Employee&gt; findEmployees(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> deptName, <span class="predefined-type">String</span> projectName) {
<span class="predefined-type">StringBuffer</span> query = <span class="keyword">new</span> <span class="predefined-type">StringBuffer</span>();
query.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT DISTINCT e </span><span class="delimiter">&quot;</span></span>);
query.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">FROM Employee e LEFT JOIN e.projects p </span><span class="delimiter">&quot;</span></span>);
query.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE </span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; criteria = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;();
<span class="keyword">if</span> (name != <span class="predefined-constant">null</span>) { criteria.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">e.name = :name</span><span class="delimiter">&quot;</span></span>); }
<span class="keyword">if</span> (deptName != <span class="predefined-constant">null</span>) { criteria.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">e.dept.name = :dept</span><span class="delimiter">&quot;</span></span>); }
<span class="keyword">if</span> (projectName != <span class="predefined-constant">null</span>) { criteria.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">p.name = :project</span><span class="delimiter">&quot;</span></span>); }

<span class="keyword">if</span> (criteria.size() == <span class="integer">0</span>) {
<span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">no criteria</span><span class="delimiter">&quot;</span></span>);
}
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; criteria.size(); i++) {
<span class="keyword">if</span> (i &gt; <span class="integer">0</span>) { query.append(<span class="string"><span class="delimiter">&quot;</span><span class="content"> AND </span><span class="delimiter">&quot;</span></span>); }
query.append(criteria.get(i));
}


<span class="predefined-type">Query</span> q = em.createQuery(query.toString());
<span class="keyword">if</span> (name != <span class="predefined-constant">null</span>) { q.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, name); }
<span class="keyword">if</span> (deptName != <span class="predefined-constant">null</span>) { q.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">dept</span><span class="delimiter">&quot;</span></span>, deptName); }
<span class="keyword">if</span> (projectName != <span class="predefined-constant">null</span>) { q.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">project</span><span class="delimiter">&quot;</span></span>, projectName); }
<span class="keyword">return</span> (<span class="predefined-type">List</span>&lt;Employee&gt;)q.getResultList();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wrapper">134.9. Wrapper</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PersonWrapper</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Long</span> id;

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> nickName;

    <span class="directive">public</span> PersonWrapper(<span class="predefined-type">Long</span> id, <span class="predefined-type">String</span> nickName) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.nickName = nickName;
    }
}


CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;PersonWrapper&gt; criteria = builder.createQuery( PersonWrapper.class );
Root&lt;Person&gt; root = criteria.from( Person.class );

Path&lt;<span class="predefined-type">Long</span>&gt; idPath = root.get( Person_.id );
Path&lt;<span class="predefined-type">String</span>&gt; nickNamePath = root.get( Person_.nickName);

criteria.select( builder.construct( PersonWrapper.class, idPath, nickNamePath ) );
criteria.where( builder.equal( root.get( Person_.name ), <span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span> ) );

<span class="predefined-type">List</span>&lt;PersonWrapper&gt; wrappers = entityManager.createQuery( criteria ).getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tuple_2">134.10. Tuple</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;Tuple&gt; criteria = builder.createQuery( Tuple.class );
Root&lt;Person&gt; root = criteria.from( Person.class );

Path&lt;<span class="predefined-type">Long</span>&gt; idPath = root.get( Person_.id );
Path&lt;<span class="predefined-type">String</span>&gt; nickNamePath = root.get( Person_.nickName);

criteria.multiselect( idPath, nickNamePath );
criteria.where( builder.equal( root.get( Person_.name ), <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span> ) );

<span class="predefined-type">List</span>&lt;Tuple&gt; tuples = entityManager.createQuery( criteria ).getResultList();

<span class="keyword">for</span> ( Tuple tuple : tuples ) {
    <span class="predefined-type">Long</span> id = tuple.get( idPath );
    <span class="predefined-type">String</span> nickName = tuple.get( nickNamePath );
}

<span class="comment">//or using indices</span>
<span class="keyword">for</span> ( Tuple tuple : tuples ) {
    <span class="predefined-type">Long</span> id = (<span class="predefined-type">Long</span>) tuple.get( <span class="integer">0</span> );
    <span class="predefined-type">String</span> nickName = (<span class="predefined-type">String</span>) tuple.get( <span class="integer">1</span> );
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_join_2">135. JOIN</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;Phone&gt; criteria = builder.createQuery( Phone.class );
Root&lt;Phone&gt; root = criteria.from( Phone.class );

<span class="comment">// Phone.person is a @ManyToOne</span>
Join&lt;Phone, Person&gt; personJoin = root.join( Phone_.person );
<span class="comment">// Person.addresses is an @ElementCollection</span>
Join&lt;Person, <span class="predefined-type">String</span>&gt; addressesJoin = personJoin.join( Person_.addresses );

criteria.where( builder.isNotEmpty( root.get( Phone_.calls ) ) );

<span class="predefined-type">List</span>&lt;Phone&gt; phones = entityManager.createQuery( criteria ).getResultList();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
Join&lt;Pet, <span class="predefined-type">Owner</span>&gt; owner = pet.join(Pet_.owners);

CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
Join&lt;<span class="predefined-type">Owner</span>, Address&gt; address = cq.join(Pet_.owners).join(Owner_.addresses);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Join&lt;Employee,Employee&gt; directs = emp.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">directs</span><span class="delimiter">&quot;</span></span>);
Join&lt;Employee,Project&gt; projects = directs.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">projects</span><span class="delimiter">&quot;</span></span>);
Join&lt;Employee,Department&gt; dept = directs.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">dept</span><span class="delimiter">&quot;</span></span>);

Join&lt;Employee,Project&gt; project = dept.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">employees</span><span class="delimiter">&quot;</span></span>).join(<span class="string"><span class="delimiter">&quot;</span><span class="content">projects</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fetch">136. FETCH</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;Phone&gt; criteria = builder.createQuery( Phone.class );
Root&lt;Phone&gt; root = criteria.from( Phone.class );

<span class="comment">// Phone.person is a @ManyToOne</span>
Fetch&lt;Phone, Person&gt; personFetch = root.fetch( Phone_.person );
<span class="comment">// Person.addresses is an @ElementCollection</span>
Fetch&lt;Person, <span class="predefined-type">String</span>&gt; addressesJoin = personFetch.fetch( Person_.addresses );

criteria.where( builder.isNotEmpty( root.get( Phone_.calls ) ) );

<span class="predefined-type">List</span>&lt;Phone&gt; phones = entityManager.createQuery( criteria ).getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_użycie_parametrów">137. Użycie parametrów</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;Person&gt; criteria = builder.createQuery( Person.class );
Root&lt;Person&gt; root = criteria.from( Person.class );

ParameterExpression&lt;<span class="predefined-type">String</span>&gt; nickNameParameter = builder.parameter( <span class="predefined-type">String</span>.class );
criteria.where( builder.equal( root.get( Person_.nickName ), nickNameParameter ) );

TypedQuery&lt;Person&gt; query = entityManager.createQuery( criteria );
query.setParameter( nickNameParameter, <span class="string"><span class="delimiter">&quot;</span><span class="content">JD</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">List</span>&lt;Person&gt; persons = query.getResultList();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groupby_i_tuple">138. GroupBy i Tuple</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład 1</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder builder = entityManager.getCriteriaBuilder();

CriteriaQuery&lt;Tuple&gt; criteria = builder.createQuery( Tuple.class );
Root&lt;Person&gt; root = criteria.from( Person.class );

criteria.groupBy(root.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>));
criteria.multiselect(root.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>), builder.count(root));

<span class="predefined-type">List</span>&lt;Tuple&gt; tuples = entityManager.createQuery( criteria ).getResultList();

<span class="keyword">for</span> ( Tuple tuple : tuples ) {
    <span class="predefined-type">String</span> name = (<span class="predefined-type">String</span>) tuple.get( <span class="integer">0</span> );
    <span class="predefined-type">Long</span> count = (<span class="predefined-type">Long</span>) tuple.get( <span class="integer">1</span> );
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> e, <span class="predefined">COUNT</span>(p) <span class="keyword">FROM</span> Employee e <span class="keyword">JOIN</span> e.projects p <span class="keyword">GROUP</span> <span class="keyword">BY</span> e <span class="keyword">HAVING</span> <span class="predefined">COUNT</span>(p) &gt;= <span class="integer">2</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 3</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; c = cb.createQuery(<span class="predefined-type">Object</span><span class="type">[]</span>.class);
Root&lt;Employee&gt; emp = c.from(Employee.class);
Join&lt;Employee,Project&gt; project = emp.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">projects</span><span class="delimiter">&quot;</span></span>);
c.multiselect(emp, cb.count(project)).groupBy(emp).having(cb.ge(cb.count(project),<span class="integer">2</span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_predykaty">139. Predykaty</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>IS EMPTY  -  <strong>isEmpty()</strong></p>
</li>
<li>
<p>IS NOT EMPTY  -  <strong>isNotEmpty()</strong></p>
</li>
<li>
<p>MEMBER OF -  <strong>isMember()</strong></p>
</li>
<li>
<p>NOT MEMBER OF -  <strong>isNotMember()</strong></p>
</li>
<li>
<p>LIKE -  <strong>like()</strong></p>
</li>
<li>
<p>NOT LIKE -  <strong>notLike()</strong></p>
</li>
<li>
<p>IN -  <strong>in()</strong></p>
</li>
<li>
<p>NOT IN -  <strong>not(in())</strong></p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Predicate</span> criteria = cb.conjunction();
<span class="keyword">if</span> (name != <span class="predefined-constant">null</span>) {
  ParameterExpression&lt;<span class="predefined-type">String</span>&gt; p = cb.parameter(<span class="predefined-type">String</span>.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
  criteria = cb.and(criteria, cb.equal(employee.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), p));
}
<span class="keyword">if</span> (deptName != <span class="predefined-constant">null</span>) {
  ParameterExpression&lt;<span class="predefined-type">String</span>&gt; p = cb.parameter(<span class="predefined-type">String</span>.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">dept</span><span class="delimiter">&quot;</span></span>);
  criteria = cb.and(criteria, cb.equal(employee.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">dept</span><span class="delimiter">&quot;</span></span>).get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), p));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_skalary">140. Skalary</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>ALL -  <strong> all()</strong></p>
</li>
<li>
<p>ANY -  <strong> any()</strong></p>
</li>
<li>
<p>SOME -  <strong> some()</strong></p>
</li>
<li>
<p>- -  <strong>neg(), diff()</strong></p>
</li>
<li>
<p>+ -  <strong>sum()</strong></p>
</li>
<li>
<p>* -  <strong>prod()</strong></p>
</li>
<li>
<p>/ -  <strong>quot()</strong></p>
</li>
<li>
<p>COALESCE -  <strong>coalesce()</strong></p>
</li>
<li>
<p>NULLIF -  <strong>nullif()</strong></p>
</li>
<li>
<p>CASE -  <strong>selectCase()</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_funkcje">141. Funkcje</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>ABS -  <strong>abs()</strong></p>
</li>
<li>
<p>CONCAT -  <strong>concat()</strong></p>
</li>
<li>
<p>CURRENT_DATE -  <strong>currentDate()</strong></p>
</li>
<li>
<p>CURRENT_TIME -  <strong>currentTime()</strong></p>
</li>
<li>
<p>CURRENT_TIMESTAMP -  <strong>currentTimestamp()</strong></p>
</li>
<li>
<p>LENGTH -  <strong>length()</strong></p>
</li>
<li>
<p>LOCATE -  <strong>locate()</strong></p>
</li>
<li>
<p>LOWER -  <strong>lower()</strong></p>
</li>
<li>
<p>MOD -  <strong>mod()</strong></p>
</li>
<li>
<p>SIZE -  <strong>size()</strong></p>
</li>
<li>
<p>SQRT -  <strong>sqrt()</strong></p>
</li>
<li>
<p>SUBSTRING -  <strong>substring()</strong></p>
</li>
<li>
<p>UPPER -  <strong>upper()</strong></p>
</li>
<li>
<p>TRIM -  <strong>trim()</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_agregacje_2">142. Agregacje</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>AVG -  <strong>avg()</strong></p>
</li>
<li>
<p>SUM -  <strong>sum()</strong></p>
</li>
<li>
<p>MIN -  <strong>min(), least()</strong></p>
</li>
<li>
<p>MAX -  <strong>max(), greatest()</strong></p>
</li>
<li>
<p>COUNT -  <strong>count()</strong></p>
</li>
<li>
<p>COUNT DISTINCT -  <strong>countDistinct()</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_podzapytania_2">143. Podzapytania</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;Employee&gt; findEmployees(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> deptName, <span class="predefined-type">String</span> projectName) {
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery&lt;Employee&gt; c = cb.createQuery(Employee.class);
Root&lt;Employee&gt; emp = c.from(Employee.class);
c.select(emp);

<span class="comment">// ...</span>

<span class="keyword">if</span> (projectName != <span class="predefined-constant">null</span>) {
Subquery&lt;Employee&gt; sq = c.subquery(Employee.class);
Root&lt;Project&gt; project = sq.from(Project.class);
Join&lt;Project,Employee&gt; sqEmp = project.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">employees</span><span class="delimiter">&quot;</span></span>);
sq.select(sqEmp)
.where(cb.equal(project.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>),
cb.parameter(<span class="predefined-type">String</span>.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">project</span><span class="delimiter">&quot;</span></span>)));
criteria.add(cb.in(emp).value(sq));
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Analogia do :</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> e
<span class="keyword">FROM</span> Employee e
<span class="keyword">WHERE</span> e <span class="keyword">IN</span> (<span class="class">SELECT</span> emp
<span class="keyword">FROM</span> Project p <span class="keyword">JOIN</span> p.employees emp
<span class="keyword">WHERE</span> p.name = :project)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logowanie_zdarzeń">144. Logowanie zdarzeń</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">show_sql</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Włączenie  Live Statistics</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;property name="hibernate.generate_statistics"&gt;true&lt;/property&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Cache</strong> - zwiększenie wydajności zapytań poprzez eliminacje ponownego zapytania w bazie</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/cache1.png" alt="cache1">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architektura_2">145. Architektura</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="img/cache.jpg" alt="cache">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>source : <a href="https://powerdream5.wordpress.com" class="bare">https://powerdream5.wordpress.com</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_level_cache">146. First level cache</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Pierwsza czynność wykonywana przez Hibernate to sprawdzenie tego obszaru pod kątem optymalizacji</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>właczone domyślnie. Nie można go wyłączyć</p>
</li>
<li>
<p>dane są umieszczane w konteksie sesji</p>
</li>
<li>
<p>ograniczony w ramach <strong>Session</strong></p>
</li>
<li>
<p>niszczony wraz z <strong>Session</strong></p>
</li>
<li>
<p>jeśli hibernate szuka obiektu to najpierw w cache first level jeśli go tam nie ma uderza do bazy</p>
</li>
<li>
<p><strong><em>Session.evict(Object object)</em></strong> -usuwa pojedyńczy obiekt z cache</p>
</li>
<li>
<p><strong><em>Session.clear()</em></strong> - czyści wszystkie obiekty znajdujace się aktualnie w cache</p>
</li>
<li>
<p>operacja jak <strong>Save</strong> <strong>Update</strong> <strong>Get</strong>  <strong>Load</strong>  List wstawiają obiekt do first-cache</p>
</li>
<li>
<p>optymalizuje operacje <strong>EntityManager</strong> - w obrębie <strong>unit of work</strong></p>
</li>
<li>
<p>wielokrotna operacja <strong>find()</strong> → jedna operacja <strong>SELECT</strong></p>
</li>
<li>
<p>wielokrotne operacja <strong>merge()</strong> → jedna operacja  <strong>UPDATE</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_second_level_cache">147. Second level cache</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>skojarzony z <strong>EntityManagerFactory</strong> lub <strong>SessionFactory</strong></p>
</li>
<li>
<p>optymalizuje dostęp do encji lub kolekcji na poziomie całego kontekstu entityManagerFactory. Co sprawia, że operacja find() uderza do bazy tylko jeden raz</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Dla bardzo dużych woluminów danych: Wyjątkowo nieefektywne &#8594;  <strong>Out of memory exception</strong>
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Wyjątkowo słabe skalowanie dla równoległych lub częstych uaktualnień danych
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_włączenie">147.1. Włączenie</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Cacheable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_javax_persistence_sharedcache_mode">147.2. javax.persistence.sharedCache.mode</h3>
<div class="ulist">
<ul>
<li>
<p><strong>ALL:</strong> wszystkie encje są cachowane</p>
</li>
<li>
<p><strong>NONE:</strong> odwrotność do <strong>ALL</strong></p>
</li>
<li>
<p><strong>ENABLE_SELECTIVE:</strong> Buforowaniem objęte są tylko encje oznaczone <strong>@Cacheable(true)</strong></p>
</li>
<li>
<p><strong>DISABLE_SELECTIVE:</strong> Buforowaniem objęte są wszystkie encje z wyjątkiem tych oznaczonych <strong>@Cacheable(false)</strong></p>
</li>
<li>
<p><strong>UNSPECIFIED:</strong> zależna od dostawcy JPA.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ACME</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;shared-cache-mode&gt;</span>NONE<span class="tag">&lt;/shared-cache-mode&gt;</span>
<span class="tag">&lt;/persistence-unit&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retrieval_mode_określa_jak_dane_mają_być_czytane_z_bufora_odwołania_do_entitymanagera">147.3. Retrieval Mode -określa jak dane mają być czytane z bufora (odwołania do EntityManagera)</h3>
<div class="ulist">
<ul>
<li>
<p>BYPASS: ignoruje cache. Buduje obiekt bezpośrednio z bazy danych</p>
</li>
<li>
<p>USE: Jeśli dane są w cache pobiera je z bufora w przeciwnym wypadku uderza do bazy</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_store_mode_określa_jak_dane_mają_być_składowane_w_cache">147.4. Store Mode - określa jak dane mają być składowane w cache</h3>
<div class="ulist">
<ul>
<li>
<p>BYPASS: nie wstawia nic do bufora</p>
</li>
<li>
<p>REFRESH: jeśli dane są w buforze wtedy odświeża , zamienia z danymi z bazy</p>
</li>
<li>
<p>USE: dane pochodzą z cache</p>
</li>
<li>
<p>Opcjonalny</p>
</li>
<li>
<p>Cache na poziomie sessionFactory</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_dostawcy">147.5. Dostawcy</h3>
<div class="ulist">
<ul>
<li>
<p>Ehcache</p>
</li>
<li>
<p>OSCache</p>
</li>
<li>
<p>SwarmCache</p>
</li>
<li>
<p>JBoss Cache</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>net.sf.ehcache<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>ehcache-core<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>hibernate-ehcache<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Włączenie cache</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_second_level_cache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
 net.sf.ehcache.hibernate.EhCacheRegionFactory<span class="tag">&lt;/property&gt;</span>

<span class="tag">&lt;session-factory&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.driver_class</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>org.h2.Driver<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>jdbc:h2:file:./chapter12<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>org.hibernate.dialect.HSQLDialect<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>create<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.discriminator.ignore_explicit_for_joined</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.generate_statistics</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection.password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
org.hibernate.cache.ehcache.EhCacheRegionFactory
<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;mapping</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.apress.hibernaterecipes.chapter12.recipe2.Book2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/session-factory&gt;</span>
<span class="tag">&lt;/hibernate-configuration&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Cacheable</span>
<span class="annotation">@org</span>.hibernate.annotations.Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Person</span> {
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_strategie">147.6. Strategie</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Read-only</strong> - Najbardziej wydajna -  Encje są często czytane ale nigdy modyfikowane (<strong>CacheConcurrencyStrategy.READ_ONLY</strong>)</p>
</li>
<li>
<p><strong>Nonstrict</strong> read-write - Encje są rzadko modyfikowane (<strong>CacheConcurrencyStrategy.NONSTRICT_READ_WRITE</strong>)</p>
</li>
<li>
<p><strong>Read-write</strong> - Większy narzut Encje są modyfikowane (<strong>CacheConcurrencyStrategy.READ_WRITE</strong>)</p>
</li>
<li>
<p><strong>Transactional</strong>  : Dostępna jedynie w środowisku zarządzanym. Gwarantuje pełną izolację transakcyjną aż do trybu powtarzalnego odczytu. Cache wspierany przez transakcyjne cache&#8217;e jak JBOSS TreeCache (<strong>CacheConcurrencyStrategy.TRNSACTIONAL</strong>)</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Cache</span>(usage=CacheConcurrencyStrategy.READ_ONLY)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cache_dla_kwerend">148. Cache dla  kwerend</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_konfiguracja">148.1. Konfiguracja</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_query_cache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Należy zawsze stosować z L2 cache : Query cache nie przechowuje wartości a przechowuje jedynie <strong>id</strong>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Włączenie <strong>Query cache</strong> ma sens dla zapytań często wykonywalnych, tak samo sparametryzowanych
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock java">
<div class="content">
<pre class="CodeRay highlight"><code>Session session1 = SessionManager.openSession();
try {
Query query = session1.createQuery("from Book5 b where b.name like ?");
query.setString(0, "%Hibernate%");
List books = query.list();
} finally {
session1.close();
}
Session session2 = SessionManager.openSession();
try {
Query query = session2.createQuery("from Book5 b where b.name like ?");
query.setString(0, "%Hibernate%");
List books = query.list();
} finally {
session2.close();
}


 &lt;hibernate-configuration&gt;
&lt;session-factory&gt;
...
&lt;property name="hibernate.cache.use_query_cache"&gt;true&lt;/property&gt;
...
&lt;/session-factory&gt;
&lt;/hibernate-configuration&gt;


@Entity
@Data
@Cacheable
@org.hibernate.annotations.Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
public class Book5 {
@Id
@GeneratedValue(strategy = GenerationType.AUTO)
int id;
String title;
}

The test that shows the cache in action uses a method to execute the queries to reduce code
duplication:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enabling a query cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_query_cache</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Session session = sessionFactory.openSession();
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">5</span>; i++) {
<span class="comment">/* Line 3 */</span> Criteria criteria = session.createCriteria(Employee.class).setCacheable(<span class="predefined-constant">true</span>);
<span class="predefined-type">List</span>&lt;Employee&gt; employees = criteria.list();
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Employees found: </span><span class="delimiter">&quot;</span></span> + employees.size());
}
session.close();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_collection_cache">149. Collection cache</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, cascade = CascadeType.ALL)
<span class="annotation">@org</span>.hibernate.annotations.Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;Phone&gt; phones = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(  );

...
Person person = entityManager.find( Person.class, <span class="integer">1L</span> );
person.getPhones().size();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_query_level_cache">150. Query level cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>aktywowany poprzez dyrektywę : hibernate.cache.use_query_cache = true
przetrzymuje całkowite wyniki zapytania w pamieci cache.</p>
</div>
<div class="sect2">
<h3 id="_aktywacja">150.1. aktywacja</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.use_query_cache</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jpa">150.2. JPA</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.name = :name</span><span class="delimiter">&quot;</span></span>, Person.class)
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Przodownik pracy</span><span class="delimiter">&quot;</span></span>)
.setHint( <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.cacheable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hibernate_native_api">150.3. Hibernate native API</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = session.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p from Person p where p.name = :name</span><span class="delimiter">&quot;</span></span>).setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Przodownik pracy</span><span class="delimiter">&quot;</span></span>).setCacheable(<span class="predefined-constant">true</span>).list();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_używając_jpa">150.4. Używając JPA</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = entityManager.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.id &gt; :id</span><span class="delimiter">&quot;</span></span>, Person.class)
        .setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">0L</span>)
        .setHint( QueryHints.HINT_CACHEABLE, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
        .setHint( QueryHints.HINT_CACHE_REGION, <span class="string"><span class="delimiter">&quot;</span><span class="content">query.cache.person</span><span class="delimiter">&quot;</span></span> )
        .getResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_natywny_hibernate_api">151. Natywny Hibernate API</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; persons = session.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">select p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">from Person p </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">where p.id &gt; :id</span><span class="delimiter">&quot;</span></span>)
.setParameter( <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">0L</span>)
.setCacheable(<span class="predefined-constant">true</span>)
.setCacheRegion( <span class="string"><span class="delimiter">&quot;</span><span class="content">query.cache.person</span><span class="delimiter">&quot;</span></span> )
.list();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_statystyki">152. Statystyki</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Statistics statistics = session.getSessionFactory().getStatistics();
SecondLevelCacheStatistics secondLevelCacheStatistics = statistics.getSecondLevelCacheStatistics( <span class="string"><span class="delimiter">&quot;</span><span class="content">query.cache.person</span><span class="delimiter">&quot;</span></span> );
<span class="type">long</span> hitCount = secondLevelCacheStatistics.getHitCount();
<span class="type">long</span> missCount = secondLevelCacheStatistics.getMissCount();
<span class="type">double</span> hitRatio = (<span class="type">double</span>) hitCount / ( hitCount + missCount );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ehcache">153. Ehcache</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_regionfactory">153.1. RegionFactory</h3>
<div class="paragraph">
<p>Regiony to pojemniki na dane.</p>
</div>
<div class="sect3">
<h4 id="_ehcacheregionfactory">153.1.1. EhCacheRegionFactory</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Konfigurujemy CacheManager dla każdego SessionFactory, CacheManager nie jest współdzielony dla wszystkich instancji SessionFactory w obrębie tego samego JVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.cache.ehcache.EhCacheRegionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_singletonehcacheregionfactory">SingletonEhCacheRegionFactory</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Konfigurujemy CacheManager współdzielony na wielu instancji SessionFactory na tej samej maszynie wirtualnej JVM
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span>
    <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.cache.ehcache.SingletonEhCacheRegionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Stores query results for a query and its parameters</p>
</div>
<div class="paragraph">
<p>[„FROM Author WHERE id=?“, 1]     [1]</p>
</div>
<div class="paragraph">
<p>Stores only entity references or scalars</p>
</div>
<div class="paragraph">
<p>Always use together with 2nd Level Cache</p>
</div>
<div class="paragraph">
<p>Hibernate specific</p>
</div>
<div class="paragraph">
<p>Stores query result session independent</p>
</div>
<div class="paragraph">
<p>Needs to be activated
persistence.xml: hibernate.cache.use_query_cache = true</p>
</div>
<div class="paragraph">
<p>Activate caching for a specific query
org.hibernate.Query.setCacheable(true)
@NamedQuery(… hints = @QueryHint(name="org.hibernate.cacheable", value="true"))</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zapytania_natywne">154. Zapytania natywne</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SqlResultSetMapping</p>
</div>
<div class="paragraph">
<p>@SqlResultSetMapping(
	name		= "myResultMapping ",
	entities		= {@EntityResult(&#8230;&#8203;), …},
	classes	= {@ConstructorResult (…), …},
	columns	= {@ColumnResult(…), …}
)</p>
</div>
<div class="paragraph">
<p>this.em.createNativeQuery(“Select …", "myResultMapping")</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_walidacja">155. Walidacja</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_data_validation">156. Data Validation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zależności_2">156.1. Zależności</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
<span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
<span class="tag">&lt;artifactId&gt;</span>hibernate-validator<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;version&gt;</span>5.1.0.Alpha1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="comment">&lt;!-- these are only necessary if not in a Java EE environment --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
<span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
<span class="tag">&lt;artifactId&gt;</span>hibernate-validator-cdi<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;version&gt;</span>5.1.0.Alpha1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
<span class="tag">&lt;groupId&gt;</span>javax.el<span class="tag">&lt;/groupId&gt;</span>
<span class="tag">&lt;artifactId&gt;</span>javax.el-api<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;version&gt;</span>2.2.4<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>

<span class="tag">&lt;dependency&gt;</span>
<span class="tag">&lt;groupId&gt;</span>org.glassfish.web<span class="tag">&lt;/groupId&gt;</span>
<span class="tag">&lt;artifactId&gt;</span>javax.el<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;version&gt;</span>2.2.4<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validation_mode">156.2. Validation-mode</h3>
<div class="ulist">
<ul>
<li>
<p>domyślnie włączony</p>
<div class="literalblock">
<div class="content">
<pre>AUTO: if Bean Validation is present in the classpath, CALLBACK and DDL are activated.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>CALLBACK: entities are validated on creation, update and deletion. If no Bean Validation provider is present, an exception is raised at initialization time.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>DDL: (not standard, see below) database schemas are entities are validated on creation, update and deletion. If no Bean Validation provider is present, an exception is raised at initialization time.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>NONE: Bean Validation is not used at all</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Unfortunately, DDL is not standard mode (though extremely useful) and you will not be able to put it in &lt;validation-mode&gt;. To use it, add a regular property</pre>
</div>
</div>
</li>
<li>
<p>Przykład konfiguracji w persistence.xml</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.validation.mode</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      ddl
    <span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_własny_walidator">157. Własny walidator</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_adnotacje_2">157.1. Adnotacje</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="__decimalmax">158. @DecimalMax</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Numeric</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__decimalmin">159. @DecimalMin</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Numeric</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__min">160. @Min</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Numeric</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__max">161. @Max</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Numeric</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__null">162. @Null</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>obiekt musi być null</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__notnull">163. @NotNull</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>obiekt nie może być null&#8217;em</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__digits">164. @Digits</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Numeric</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__past">165. @Past</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>data musi być w przeszłości</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__future">166. @Future</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>data musi być w przyszłości</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__assertfalse">167. @AssertFalse</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>boolean musi być false</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__size">168. @Size</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>String||Collection||Map||Arrray  długość/rozmiar</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__asserttrue">169. @AssertTrue</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>boolean musi być true</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__pattern">170. @Pattern</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>tworzymy własny pattern</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problemy_wydajnościowe">171. Problemy wydajnościowe</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_wydajność_performance">172. Wydajność (Performance)</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_lazy">173. Lazy</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>leniwe ładowanie to jeden z features Hibernate. Pozwala ładować grafy obiektów w momencie faktycznej potrzeby skorzystania z tych danych.</p>
</li>
<li>
<p>w wielu wypadkach zapewnia znaczny wzrost wydajności poprzez ograniczenie niepotrzebnych strzałów do bazy</p>
</li>
<li>
<p>zmniejsza czas odpowiedzi</p>
</li>
<li>
<p>zapobiega zbyt dużemu zużyciu pamięci</p>
</li>
<li>
<p>problem LazyLoadingException</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_sposoby_inicjalizacji">173.1. Sposoby inicjalizacji :</h3>
<div class="sect3">
<h4 id="_fizyczne_dotknięcie_kolekcji">173.1.1. Fizyczne 'dotknięcie' kolekcji</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Person person = <span class="local-variable">this</span>.em.find(Person.class, id);
person.getPhones().size();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_join">173.1.2. Fetch Join</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> q = <span class="local-variable">this</span>.em.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT p FROM Person p JOIN FETCH p.phones ph WHERE p.id = :id</span><span class="delimiter">&quot;</span></span>);
q.setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, id);
person = (Person) q.getSingleResult();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_join_z_criteria">173.1.3. Fetch Join z Criteria</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery q = cb.createQuery(Person.class);
Root p = q.from(Person.class);
p.fetch(<span class="string"><span class="delimiter">&quot;</span><span class="content">phones</span><span class="delimiter">&quot;</span></span>, JoinType.INNER);
q.select(p);
q.where(cb.equal(p.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), personId));

Person person = (Person)<span class="local-variable">this</span>.em.createQuery(q).getSingleResult();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_named_entity_graph">173.1.4. Named Entity Graph</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@NamedEntityGraph</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">graph.Person.phones</span><span class="delimiter">&quot;</span></span>,
      attributeNodes = <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">phones</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityGraph graph = <span class="local-variable">this</span>.em.getEntityGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">graph.Person.phones</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Map</span> hints = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>();
hints.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.fetchgraph</span><span class="delimiter">&quot;</span></span>, graph);

Person person = <span class="local-variable">this</span>.em.find(Person.class, personId, hints);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dynamiczny_graf">173.1.5. Dynamiczny graf</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityGraph graph = <span class="local-variable">this</span>.em.createEntityGraph(Person.class);
Subgraph phonesGraph = graph.addSubgraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">phones</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Map</span> hints = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>();
hints.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.persistence.loadgraph</span><span class="delimiter">&quot;</span></span>, graph);

Person person = <span class="local-variable">this</span>.em.find(Person.class, personId, hints);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_less_lazy_loading">173.2. less lazy loading</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToMany</span>
<span class="annotation">@Fetch</span>(FetchMode.JOIN)
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;ArtEntity&gt; getArtEntities() {
<span class="keyword">return</span> artEntities;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_batching_for_performance">173.3. Batching for Performance</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToMany</span>
<span class="annotation">@BatchSize</span>(size = <span class="integer">10</span>)
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;ArtEntity&gt; getArtEntities() {
<span class="keyword">return</span> artEntities;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openinview">173.4. OpenInView</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">openEntityManagerInViewInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.support.OpenEntityManagerInViewInterceptor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
<span class="tag">&lt;filter-name&gt;</span>OpenEntityManagerInViewFilter<span class="tag">&lt;/filter-name&gt;</span>
<span class="tag">&lt;filter-class&gt;</span>org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter<span class="tag">&lt;/filter-</span>
class<span class="error">&gt;</span>
<span class="tag">&lt;/filter&gt;</span>
<span class="error">&lt;</span>!—Map the EntityManager Filter to all requests --<span class="error">&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
<span class="tag">&lt;filter-name&gt;</span>OpenEntityManagerInViewFilter<span class="tag">&lt;/filter-name&gt;</span>
<span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Analiza logów Hibernate - poprawa wolnych zapytań</p>
<div class="ulist">
<ul>
<li>
<p>Analiza statystyk</p>
<div class="ulist">
<ul>
<li>
<p>wolne zapytania</p>
</li>
<li>
<p>zbyt wiele zapytań n+1 problem</p>
</li>
<li>
<p>trafienia w cache</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Wybór strategii pobierania danych : fetchType</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_fetch_join_2">173.5. FETCH JOIN</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">  <span class="class">SELECT</span> <span class="keyword">DISTINCT</span> a <span class="keyword">FROM</span> Author a <span class="keyword">JOIN</span> FETCH a.books b</code></pre>
</div>
</div>
<div class="paragraph">
<p>@NamedEntityGraph</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="variable">@NamedEntityGraph</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">graph.AuthorBooksReviews</span><span class="delimiter">&quot;</span></span>,  attributeNodes = <span class="variable">@NamedAttributeNode</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Ciężkie zapytania np raporty powinny być wykonywane po stronie bazy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>@NamedStoredProcedureQuery</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Użyj cache</p>
<div class="ulist">
<ul>
<li>
<p>pierwszy poziom cache aktywowany jest domyślnie</p>
</li>
<li>
<p>drugi poziom cache jest włączany świadomie przez programistę. Konfigurowany dla klasy i kolekcji</p>
</li>
<li>
<p>buforowanie zapytań. Jest użyteczny podczas częstego wykonywania zapytań z takimi samymi parametrami.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Masowe operacje UPDATE i DELETE
CriteriaUpdate and CriteriaDelete</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder cb = <span class="local-variable">this</span>.em.getCriteriaBuilder();

<span class="comment">// create update</span>
CriteriaUpdate&lt;Order&gt; update = cb.createCriteriaUpdate(Order.class);

<span class="comment">// set the root class</span>
Root e = update.from(Order.class);

<span class="comment">// set update and where clause</span>
update.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span>, newAmount);
update.where(cb.greaterThanOrEqualTo(e.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span>), oldAmount));

<span class="comment">// perform update</span>
<span class="local-variable">this</span>.em.createQuery(update).executeUpdate();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Strategie pobierania (Fetching Strategies)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fetch_2">174. FETCH</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_eager">174.1. Eager</h3>
<div class="ulist">
<ul>
<li>
<p>natychmiatowe</p>
</li>
<li>
<p>czasem wygodne do użycia</p>
</li>
<li>
<p>znaczący przyrost danych pobieranych z bazy</p>
</li>
<li>
<p>sekwencyjne odczyty z bazy lub bufora danych</p>
</li>
<li>
<p><strong>FetchType.EAGER</strong> -  domyślne dla @OneToOne i @ManyToOne</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_lazy_2">174.2. Lazy</h3>
<div class="ulist">
<ul>
<li>
<p>opóźniony/odroczony dostęp do danych</p>
</li>
<li>
<p>proxy</p>
</li>
<li>
<p>tworzy nowe zapytanie do bazy danych jeśli obiekt nie istnieje w buforze</p>
</li>
<li>
<p><strong>FetchType.LAZY</strong> -  domyślne dla @OneToMany i @ManyToMany</p>
</li>
<li>
<p>jest możliwe jedynie, gdy podstawowa encja jest w stanie managed</p>
</li>
<li>
<p>pobranie encji w stanie  <strong>Detached</strong> spowoduje wyrzucenie wyjątku - LazyInitializationException</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_zapobieganie_lazyinitializationexception">174.2.1. Zapobieganie LazyInitializationException</h4>
<div class="ulist">
<ul>
<li>
<p>ponowne utrwalenie encji</p>
</li>
<li>
<p>pobieranie przy pomocy Fetch JOIN</p>
</li>
<li>
<p>wybór Eager zamiast Lazy</p>
</li>
<li>
<p>openSessionInView pattern</p>
</li>
<li>
<p>EntityGraph</p>
</li>
<li>
<p>isInitialized() - sprawdzamy czy pośrednik jest zaincjalizowany</p>
</li>
<li>
<p>initialize() - programowe wymuszenie inicjalizacji</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fetch_join_3">174.3. Fetch Join</h3>
<div class="ulist">
<ul>
<li>
<p>obiekt czy kolekcja zostaje pobrana razem z obiektem głównym przez zastosowanie złączenia <strong>JOIN FETCH</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_inner_join_fetch_dla_pobrania_pojedynczych_obiektów">174.3.1. INNER JOIN FETCH** - dla pobrania pojedynczych obiektów</h4>

</div>
<div class="sect3">
<h4 id="_left_join_fetch_dla_pobrania_kolekcji">174.3.2. LEFT JOIN FETCH** – dla pobrania kolekcji</h4>

</div>
</div>
<div class="sect2">
<h3 id="_batch">174.4. Batch</h3>
<div class="ulist">
<ul>
<li>
<p>poprawa wydajności dla strategii lazy poprzez pobranie grupy obiektów. To samo dotyczy się poprawy strategii eager.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To tak naprawdę nie strategia a wskazówka mająca na celu zwiększenia wydajności innych strategii jak : lazy czy eager. To dobra strategia dla mniej doświadczonych developerów
     , którzy chcą osiągnąć zadowalającą wydajność bez potrzeby wnikliwej analizy kodu SQL.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_extra_lazy">174.5. Extra lazy</h3>
<div class="ulist">
<ul>
<li>
<p>tylko dla kolekcji</p>
</li>
<li>
<p>nie dociąga całej kolekcji</p>
</li>
<li>
<p>@LazyCollection(LazyCollectionOption.EXTRA)</p>
</li>
<li>
<p>niektóre operacje jak : size(), contains(), get(), etc. nie odpalają pełnej inicjalizacji kolekcji</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_extra">174.5.1. EXTRA</h4>
<div class="ulist">
<ul>
<li>
<p>.size() , .contains() etc nie inicjalizują pełnej kolekcji</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_true">174.5.2. TRUE</h4>
<div class="ulist">
<ul>
<li>
<p>inicjalizacja pełnej kolekcji przy pierwszym odwołaniem do niej</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_false">174.5.3. FALSE</h4>
<div class="ulist">
<ul>
<li>
<p>Eager loading</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_określanie_głębi_wczytywanch_obiektów">174.6. Określanie głębi wczytywanch obiektów</h3>
<div class="literalblock">
<div class="content">
<pre>Sterowanie max liczbą złączonach tabel w jednym zapytania SQL.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
parametr odpowiedzialny za to ustawienie to : <strong>hibernate.max_fetch_depth</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Author&gt; authors = <span class="local-variable">this</span>.em.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT DISTINCT a FROM Author a JOIN FETCH a.books b</span><span class="delimiter">&quot;</span></span>,
        Author.class).getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>+ Relationships gets loaded in same query
- Requires a special query for each use case
- Creates cartesian product</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@NamedEntityGraph
Declaratively defines a graph of entities which will be loaded</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@NamedEntityGraph(
    name = "graph.AuthorBooksReviews",

    attributeNodes =
@NamedAttributeNode(value = "books")
)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kroki_optymalizacji">175. Kroki optymalizacji</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dziennik_zdarzeń">175.1. Dziennik zdarzeń</h3>
<div class="ulist">
<ul>
<li>
<p>trafienia w bufor</p>
</li>
<li>
<p>koszty złączenia czy może dwa osobne selecty</p>
</li>
<li>
<p>czas wykonywania zapytań</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_analiza_przypadków_użycia">175.2. Analiza przypadków użycia</h3>
<div class="ulist">
<ul>
<li>
<p>próby wykrycia  problemu n+1</p>
</li>
<li>
<p>analiza wywołań zapytań w celu zmniejszenia liczby i złożoności dla danej akcji biznesowej</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_dostrajanie_parametrów">175.3. Dostrajanie parametrów</h3>
<div class="ulist">
<ul>
<li>
<p>hibernate.max_fetch_depth</p>
</li>
<li>
<p>hibernate batch fetch</p>
</li>
<li>
<p>dobór najlepszego stylu kaskadowego dla każdej relacji w celu zmniejszenia wywołania liczby transakcji i zapytań do bazy poprzez zarządce transakcji</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_gradle">175.4. Gradle</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext {
    hibernateVersion = <span class="string"><span class="delimiter">'</span><span class="content">hibernate-version-you-want</span><span class="delimiter">'</span></span>
}

buildscript {
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate:hibernate-gradle-plugin:</span><span class="inline"><span class="inline-delimiter">$</span>hibernateVersion</span><span class="delimiter">&quot;</span></span>
    }
}

hibernate {
    enhance {
        enableLazyInitialization= <span class="predefined-constant">false</span>
        enableDirtyTracking = <span class="predefined-constant">false</span>
        enableAssociationManagement = <span class="predefined-constant">false</span>
    }
}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven">175.5. Maven</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
        [...]
        <span class="tag">&lt;plugin&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.hibernate.orm.tooling<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>hibernate-enhance-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>$currentHibernateVersion<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;executions&gt;</span>
                <span class="tag">&lt;execution&gt;</span>
                    <span class="tag">&lt;configuration&gt;</span>
                        <span class="tag">&lt;failOnError&gt;</span>true<span class="tag">&lt;/failOnError&gt;</span>
                        <span class="tag">&lt;enableLazyInitialization&gt;</span>true<span class="tag">&lt;/enableLazyInitialization&gt;</span>
                        <span class="tag">&lt;enableDirtyTracking&gt;</span>true<span class="tag">&lt;/enableDirtyTracking&gt;</span>
                        <span class="tag">&lt;enableAssociationManagement&gt;</span>true<span class="tag">&lt;/enableAssociationManagement&gt;</span>
                    <span class="tag">&lt;/configuration&gt;</span>
                    <span class="tag">&lt;goals&gt;</span>
                        <span class="tag">&lt;goal&gt;</span>enhance<span class="tag">&lt;/goal&gt;</span>
                    <span class="tag">&lt;/goals&gt;</span>
                <span class="tag">&lt;/execution&gt;</span>
            <span class="tag">&lt;/executions&gt;</span>
        <span class="tag">&lt;/plugin&gt;</span>
        [...]
    <span class="tag">&lt;/plugins&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_readonly">176. readOnly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>source : <em>java persistence with hibernate</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">em.unwrap(Session.class).setDefaultReadOnly(<span class="predefined-constant">true</span>);
Item item = em.find(Item.class, ITEM_ID);
item.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">New Name</span><span class="delimiter">&quot;</span></span>);
em.flush(); <span class="comment">// no update</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Item item = em.find(Item.class, ITEM_ID);
em.unwrap(Session.class).setReadOnly(item, <span class="predefined-constant">true</span>);
item.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">New Name</span><span class="delimiter">&quot;</span></span>);
em.flush() <span class="comment">//no update</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.hibernate.Query query = em.unwrap(Session.class).createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select i from Item i</span><span class="delimiter">&quot;</span></span>);
query.setReadOnly(<span class="predefined-constant">true</span>).list();
<span class="predefined-type">List</span>&lt;Item&gt; result = query.list();
<span class="keyword">for</span> (Item item : result)
  item.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">New Name</span><span class="delimiter">&quot;</span></span>);
em.flush(); <span class="comment">// no update</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = em.createQuery(queryString).setHint(org.hibernate.annotations.QueryHints.READ_ONLY,<span class="predefined-constant">true</span> );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inne_możliwe_problemy_i_wskazówki">177. Inne możliwe problemy i wskazówki:</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>aktualizowanie encji jedna-po-drugiej zamiast zrobienie tego w pojedyńczym kwerendzie</p>
</li>
<li>
<p>ciężkie procesowanie po stronie Javy zamiast bardziej wydajnego procesowania po stronie bazy</p>
</li>
<li>
<p>dla małych woluminów danych Eager loading zawsze sens.</p>
<div class="ulist">
<ul>
<li>
<p>N+1
== Paginacja
*[source,java]</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>public List&lt;Employee&gt; findEmployees(int offset, int limit) {
    TypedQuery&lt;Employee&gt; query = entityManager.createQuery("SELECT e FROM Employee e ORDER BY e.name", Employee.class);
    query.setFirstResult(offset);
    query.setMaxResults(limit);
    return query.getResultList();
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_obsługa_wyjątków">178. Obsługa wyjątków</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>HibernateException - generyczny wyjątek Hibernate</p>
</li>
<li>
<p>JDBCException - wyrzucany przez wewnętrzny sterownik JDBC</p>
</li>
<li>
<p>ConstraintViolationException - naruszenie węzłów referencyjnych</p>
</li>
<li>
<p>NoResultException - wyrzucany przez metodę <strong>getSingleResult</strong> (w kontekscie : TypedQuery,Query) jeśli nie zwróci żadnych wyników</p>
</li>
<li>
<p>NonUniqueResultException -  wyrzucany przez metodę <strong>getSingleResult</strong> (w kontekscie : TypedQuery,Query) jeśli zwróci więcej niż jeden resultat</p>
</li>
<li>
<p>QueryTimeoutException - wyrzycany przez zapytania w kontekscie TypedQuery i Query jeśli kwerenda trwa za długo</p>
</li>
<li>
<p>LockTimeoutException - wyrzucany w przypadku blokowania pesymistycznego</p>
</li>
<li>
<p>EntityNotFoundException - wyrzucany przez metodę refresh lub lock jeśli encja po odświeżeniu kontekstu nie istnieje w bazie</p>
<div class="dlist">
<dl>
<dt class="hdlist1">source </dt>
<dd>
<p><em>www.bhaveshthaker.com</em></p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/JPAEclipseLinkDemo_Project_Img002.JPG" alt="JPAEclipseLinkDemo Project Img002">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rozwiązywanie_problemów">179. Rozwiązywanie problemów</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_problemy_z_asocjacjami_dwukierunkowymi">179.1. Problemy z asocjacjami dwukierunkowymi</h3>

</div>
<div class="sect2">
<h3 id="_kłopoty_z_pamięcią">179.2. kłopoty z pamięcią</h3>

</div>
<div class="sect2">
<h3 id="_problemy_z_wydajnością_mechnika">179.3. Problemy z wydajnością mechnika :</h3>
<div class="ulist">
<ul>
<li>
<p>sprawdź wygenerowane SQL</p>
</li>
<li>
<p>sprawdź execution plan</p>
</li>
<li>
<p>sprawdź poprawność indeksów bazodanowych</p>
</li>
<li>
<p>próba optymalizacji zapytania</p>
</li>
<li>
<p>próba rozważenia zapytania natywnego</p>
</li>
<li>
<p>jpql wspiera tylko niektóre podzbiory features z bazy danych</p>
</li>
<li>
<p>SQL dla danej bazy może być wysoce wyspecjalizowany</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="__basic_lazy">179.4. @Basic(lazy)</h3>
<div class="ulist">
<ul>
<li>
<p>Wymagane narzędzie do instrumentalizacji bytecodu</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_outofmemoryexception">179.5. OutOfMemoryException</h3>
<div class="ulist">
<ul>
<li>
<p>czyszczenie cache</p>
</li>
<li>
<p>flush dla kontekstu</p>
</li>
<li>
<p>dla przetwarzania wsadowego : hibernate.jdbc.batch.size = 50</p>
</li>
<li>
<p>wyłączenie cache drugiego poziomu hibernate.cache.use_second_level_cache = false</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_Ładowanie_klas_do_kontekstu_z_poziomu_sessionfactory">179.6. Ładowanie klas do kontekstu z poziomu SessionFactory</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sessionFactory = <span class="keyword">new</span> AnnotationConfiguration()
                    .addPackage(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.animals</span><span class="delimiter">&quot;</span></span>)
                    .addAnnotatedClass(Flight.class)
                    .addAnnotatedClass(Sky.class)
                    .addAnnotatedClass(Person.class)
                    .addAnnotatedClass(Dog.class);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
JPA to nie zadziała
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jak_pokazać_parametryzacje_zapytań_sql">179.7. Jak pokazać parametryzacje zapytań SQL ?</h3>
<div class="sect3">
<h4 id="_log4jdbc">179.7.1. Log4jdbc</h4>
<div class="paragraph">
<p>Zależność :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"> compile <span class="string"><span class="delimiter">'</span><span class="content">org.lazyluke:log4jdbc-remix:????</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Konfiguracja :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="annotation">@Bean</span>
    <span class="directive">public</span> Log4JdbcCustomFormatter logFormater() {
        Log4JdbcCustomFormatter formatter = <span class="keyword">new</span> Log4JdbcCustomFormatter();
        formatter.setLoggingType(LoggingType.SINGLE_LINE);
        formatter.setSqlPrefix(<span class="string"><span class="delimiter">&quot;</span><span class="content">SQL:</span><span class="char">\r</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> formatter;
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">log4jdbc.sqltiming.warn.threshold=1000
log4jdbc.dump.sql.maxlinelength=0
log4jdbc.dump.sql.addsemicolon=true
log4jdbc.trim.sql=true
log4jdbc.trim.sql.extrablanklines=false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_p6spy">179.7.2. P6Spy</h4>
<div class="paragraph">
<p>Link do biblioteki : <a href="https://sourceforge.net/projects/p6spy/" class="bare">https://sourceforge.net/projects/p6spy/</a></p>
</div>
<div class="paragraph">
<p>Dodajemy zależność :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;dependency&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>p6spy<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>p6spy<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>???<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;session-factory&gt;
  &lt;property name="hibernate.connection.driver_class"&gt;com.p6spy.engine.spy.P6SpyDriver
  &lt;/property&gt;
  &lt;property name="hibernate.connection.password"&gt;password&lt;/property&gt;
  &lt;property name="hibernate.connection.url"&gt;jdbc:mysql://localhost:3306/test&lt;/property&gt;
  &lt;property name="hibernate.connection.username"&gt;test&lt;/property&gt;
  &lt;property name="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
&lt;/session-factory&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Konfigurujemy właściwości : spy.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">realdriver=com.mysql.jdbc.Driver

#specifies another driver to use
realdriver2=</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_log4j_sl4j">179.7.3. Log4J, Sl4j</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">log4j.logger.org.hibernate.type=trace</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dobre_praktyki">180. Dobre praktyki</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Ochrona przed SQL Injection</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WARNING:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> searchString = getValueEnteredByUser();

<span class="predefined-type">Query</span> query = em.createQuery(
<span class="string"><span class="delimiter">&quot;</span><span class="content">select i from Item i where i.name = '</span><span class="delimiter">&quot;</span></span> + searchString + <span class="string"><span class="delimiter">&quot;</span><span class="content">'</span><span class="delimiter">&quot;</span></span>
);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>zachowanie właściwych poziomów abstrakcji podczas modelowania relacji</p>
</li>
<li>
<p>unikanie jawnych opercji save() - wzorzec 'unit of work'</p>
</li>
<li>
<p>load vs get
Lepiej na początku jest sprawdzić czy obiekt jest null czy nie jeśli chcemy użyć metody get(). (NullPointerException problem)</p>
<div class="literalblock">
<div class="content">
<pre>-unikaj relacji dwukierunkowych
- tight coupling
- cykliczność
- utrzymanie spójności (musimy pamiętać aby obsłużyć dwie strony relacji)
- paginacja
- DDD agregacja
- unikaj merge
- unikaj obiektów odłączonych
- pobieranie zbyt dużych ilości danych powoduje marnowanie pamięci w warstwie aplikacji
- identyczność obiektów a ich tożsamość w bazie</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_top_down_dobre_dla_już_istniejącego_kodu">180.1. Top down (dobre dla już istniejącego kodu)</h3>
<div class="ulist">
<ul>
<li>
<p>implementujemy model obiektowy</p>
</li>
<li>
<p>tworzymy encję i generujemy schemat danych</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bottom_up_gdy_istnieje_baza">180.2. Bottom up (gdy istnieje baza)</h3>
<div class="ulist">
<ul>
<li>
<p>zaczynamy pracę z istniejącym modelem danych w bazie</p>
</li>
<li>
<p>generujemy encje i relację dzięki <strong>reverse engineering</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_middle_out_dobre_przy_nowym_wytwarzaniu">180.3. Middle out (dobre przy nowym wytwarzaniu)</h3>
<div class="ulist">
<ul>
<li>
<p>startujemy od strony modelu encyjnego. Tworzymy encje i relacje między nimi od podstaw</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_meet_in_the_middle_z_jdbc_na_hibernate_a">180.4. Meet in the middle (z JDBC na Hibernate’a)</h3>
<div class="ulist">
<ul>
<li>
<p>startujemy z istniejącym modelem danych i gotowymi w pewnym stopniu plikami POJO po czym przekształcamy je na pełnoprawne encje.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lock_blokowanie">181. Lock/Blokowanie</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_enabling_optimistic_concurrency_control_blokowanie_optymistyczne_blokowanie_optymistyczne_z_wersjonowaniem">181.1. Enabling Optimistic Concurrency Control (Blokowanie optymistyczne)/Blokowanie  optymistyczne z  wersjonowaniem</h3>
<div class="ulist">
<ul>
<li>
<p>zakładamy, żę obecnie wykonywana transakcja na jakimś zasobie jest jedyną, która dokonuje zmian.</p>
</li>
<li>
<p>hibernate tworzy dodatkową kolumnę <strong>@Version</strong> możliwe typy :</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;int</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;Integer</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;short</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;Short</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;long</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;Long</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;java.sql.Timestamp</p>
</div>
<div class="ulist">
<ul>
<li>
<p>podczas zatwierdzania zmian porównywalny jest orginalny numer wersji z bieżącą wartością. W razie różnicy, zatwierdzenie transakcji jest wycofane i wyrzucany jest wyjątek
<strong>OptimisticLockException</strong></p>
</li>
<li>
<p>nie chroni przed  <strong>phantom read</strong></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Wydajność
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_lockmode">181.1.1. LockMode</h4>
<div class="sect4">
<h5 id="_optimistic_w_czasie_zatwierdzania_wykonywane_jest_zapytanie_select_for_update">OPTIMISTIC – w czasie zatwierdzania wykonywane jest zapytanie SELECT ….. FOR UPDATE.</h5>
<div class="literalblock">
<div class="content">
<pre>Tylko jedna transakcja ma chwilowy dostęp do zasobu. Jeśli druga transakcja chciałby zmodyfikować obiekt zostanie wyrzucony wyjątek</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optimistic_force_increment_to_samo_co_wyżej_działa_nawet_dla_nie_zmienionej_wersji">OPTIMISTIC_FORCE_INCREMENT – to samo co wyżej. Działa nawet dla nie zmienionej wersji.</h5>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {

<span class="annotation">@Id</span>
<span class="annotation">@GeneratedValue</span> (strategy=GenerationType.TABLE)
<span class="annotation">@Column</span> (name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ISBN</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">long</span> isbn;

<span class="annotation">@Version</span>
<span class="annotation">@Column</span> (name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Integer</span> version;

<span class="annotation">@Column</span> (name=<span class="string"><span class="delimiter">&quot;</span><span class="content">book_Name</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">String</span> bookName;

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_pessimistic_concurrency_control_blokowanie_pesymistyczne">181.2. Using Pessimistic Concurrency Control / Blokowanie pesymistyczne</h3>
<div class="ulist">
<ul>
<li>
<p>mechanizm umiemożliwiający współbieżny dostęp do konkretnego zasobu.</p>
</li>
<li>
<p>zakładana w momencie odczytu danych aż do zakończenia transakcji</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Nie jest to najlepszy wybór dla wysoce współbieżnej aplikacji. Powoduje istotny spadek wydajności. Możemy liczyć się z zakleszczeniami (deadlock).
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>**READ** - blokowanie na odczyt (ochrona przed dirty reads i  unrepeatable reads)
 Zakładany automatycznie gdy Hibernate odczytuje dane przy poziomie izolacji Repeatable Read or Serializable isolation level.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>**WRITE** - blokowanie na zapis (ochrona przed dirty reads i  unrepeatable reads)
 Zakładany automatycznie, gdy Hibernate wstawia lub aktualizuje wiersz</pre>
</div>
</div>
<div class="sect3">
<h4 id="_lockmode_blokada_dla_konkretnego_elementu">181.2.1. LockMode - blokada dla konkretnego elementu</h4>
<div class="sect4">
<h5 id="_lockmode_none">LockMode.NONE</h5>
<div class="ulist">
<ul>
<li>
<p>nie wykonuj zapytania chyba, że obiektu nie ma w buforze. Pominięcie poziomów buforowania i przejście do bazy danych.</p>
</li>
<li>
<p>Czytaj z bazy danych tylko wtedy gdy obiekt nie istnieje w buforze</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_lockmode_read">LockMode.READ</h5>
<div class="ulist">
<ul>
<li>
<p>pomiń oba poziomy buforowania i dokonaj sprawdzenia wersji , aby sprawdzić czy dane w pamięci są takie same jak bazie</p>
</li>
<li>
<p>Czytaj z bazy niezależnie od zawartości bufora</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_lockmode_write">LockMode.WRITE</h5>
<div class="ulist">
<ul>
<li>
<p>uzyskiwany automatycznie , gdy zarządca trwałości zapisał dane do wiersza aktualnej transakcji</p>
</li>
<li>
<p><strong>LockMode.WRITE</strong> jest zakładany automatycznie, gdy Hibernate wstawia lub aktualizuje wiersz</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_lockmode_upgrade">LockMode.UPGRADE</h5>
<div class="ulist">
<ul>
<li>
<p>pomija poziomy buforowania, dokonuje sprawdzenia wersji i uzyskuje blokadę pesymistyczną na poziomie bazy</p>
</li>
<li>
<p><strong>LockMode.UPGRADE</strong> może być założony, gdy użytkownik użyje SELECT &#8230;&#8203; FOR UPDATE w bazie wspierającej tą składnie.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_lockmode_upgrade_nowait">LockMode.UPGRADE_NOWAIT</h5>
<div class="ulist">
<ul>
<li>
<p>do samo co przy <strong>UPGRADE</strong> ale stosuje zapytanie SELECT &#8230;&#8203; FOR UPDATE NOWAIT . Wyłącza to czekanie na zwolnienie blokad dotyczących wpółbieżności i natychmiastowe
zgłoszenie wyjątku , jeśli blokady nie udało się uzyskać.</p>
</li>
<li>
<p>LockMode.UPGRADE_NOWAIT może być założony, gdy użytkownik użyje SELECT &#8230;&#8203; FOR UPDATE NOWAIT w bazie Oracle.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Object</span> load(<span class="predefined-type">Class</span> theClass, <span class="predefined-type">Serializable</span> id, LockMode lockMode) <span class="directive">throws</span> HibernateException
<span class="directive">public</span> <span class="predefined-type">Object</span> load(<span class="predefined-type">String</span> entityName, <span class="predefined-type">Serializable</span> id, LockMode lockMode) <span class="directive">throws</span> HibernateException</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blokowanie_pojedyńczych_encji">181.2.2. Blokowanie pojedyńczych encji</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">User user = em.find(User.class, <span class="integer">4L</span>);
em.lock(user, LockModeType.PESSIMISTIC_WRITE);
<span class="comment">//lub</span>
User user = em.find(User.class, <span class="integer">4L</span>, LockModeType.PESSIMISTIC_WRITE);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blokowanie_wszystkich_encji_zwracanych_przez_kwerende">181.2.3. Blokowanie wszystkich encji zwracanych przez kwerende</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> statement = ....
TypedQuery&lt;User&gt; query = em.createQuery(statement, User.class);
query.setLockMode(LockModeType.PESSIMISTIC_READ);
<span class="predefined-type">List</span>&lt;User&gt; users = query.getResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transakcje_integracja_jpa_hibernate_z_frameworkiem_spring">182. Transakcje + Integracja JPA/Hibernate z frameworkiem Spring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_historia">182.1. Historia</h3>
<div class="ulist">
<ul>
<li>
<p>Spring 1.0 - Marzec 2004</p>
</li>
<li>
<p>Spring 2.0 - Październik 2006</p>
</li>
<li>
<p>Spring 2.5 - Grudzień 2007</p>
</li>
<li>
<p>Spring 3.0 - Grudzień 2009</p>
</li>
<li>
<p>i dalsze wersje</p>
</li>
<li>
<p>aktualna 4.2.5.Release</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Stworzony przez Rod Johnson jako alternatywa dla ciężkiego EJB
Bazuje na IoC</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/springarchitecture.png" alt="springarchitecture"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>zarys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/overview-full.png" alt="overview-full"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_cechy_2">182.2. Cechy</h3>
<div class="ulist">
<ul>
<li>
<p>testowalność</p>
</li>
<li>
<p>loose coupling</p>
</li>
<li>
<p>IoC / dependency injection</p>
</li>
<li>
<p>programowanie deklaratywne</p>
</li>
<li>
<p>wspracie dla AOP, Web, JMS, Batch, Security itd</p>
</li>
<li>
<p>eliminacje boilerplace code</p>
</li>
<li>
<p>szybkość wytwarzania</p>
</li>
<li>
<p>łatwość utrzymania</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source: <em><a href="https://aishwaryavaishno.wordpress.com/category/technical-posts/java/" class="bare">https://aishwaryavaishno.wordpress.com/category/technical-posts/java/</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/tx-annotation2.png" alt="tx annotation2">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_architektura_3">182.3. Architektura</h3>
<div class="paragraph">
<p>source : <em><a href="https://sites.google.com/site/telosystutorial/springmvc-jpa-springdatajpa" class="bare">https://sites.google.com/site/telosystutorial/springmvc-jpa-springdatajpa</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/bundles_schema_springmvc-springdatajpa.png" alt="bundles schema springmvc springdatajpa">
</div>
</div>
<div class="paragraph">
<p>source : <em><a href="https://fndong.wordpress.com/category/spring-framework/" class="bare">https://fndong.wordpress.com/category/spring-framework/</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/architecture_springmvc_hibernate_jpa_mysql.jpg" alt="architecture springmvc hibernate jpa mysql">
</div>
</div>
<div class="paragraph">
<p>source : <em>www.genuitec.com</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/AppLayers-SpringMVC.jpg" alt="AppLayers SpringMVC">
</div>
</div>
<div class="sect3">
<h4 id="_przykładowy_podglądowy_diagram_klas_w_projekcie">182.3.1. Przykładowy podglądowy diagram klas w projekcie</h4>
<div class="imageblock">
<div class="content">
<img src="img/diagram-springmvc-springdatajpa.png" alt="diagram springmvc springdatajpa">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entitymanager_2">182.4. EntityManager</h3>
<div class="ulist">
<ul>
<li>
<p>wstrzyknięcie jest zawsze wątkowo bezpieczne</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transakcja">183. Transakcja</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>grupa operacji jest postrzegana jako jedna niezależna operacja</p>
</li>
<li>
<p>grupuje operacje w całość, albo są akceptowane wszystkie albo żadna</p>
</li>
<li>
<p>operacje w ramach transakcjo mogą pochodzić z różnych źródeł i brać udział w wielu składnicach danych (2PC)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_wyjątki">183.1. Wyjątki</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Domyślnie tylko niesprawdzane wyjątki : RuntimeException + Error prowadzą do wycofania transakcji
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_acid">183.2. ACID</h3>
<div class="ulist">
<ul>
<li>
<p><strong>atomowość/Atomicity</strong> - akceptowane są wszystkie w ramach procesu transakcji. W przeciwnym wypadku są wycofywane.</p>
</li>
<li>
<p><strong>spójność/Consistency</strong> - koniec transakcji pozostawia system w stanie spójnym i stabilnym</p>
</li>
<li>
<p><strong>izolacja/Isolation</strong> - inne transakcje są nie widoczne dla danej w tej chwili wykonywanej</p>
</li>
<li>
<p><strong>trwałość/Durablility</strong> - zakończone transakcje pozostają w stanie trwałym, to znaczy żę awaria systemu nie będzie stanowiła problemu dla danych</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_transakcje_w_kodzie">183.3. Transakcje w kodzie</h3>
<div class="ulist">
<ul>
<li>
<p><strong>uciążliwe kodowanie</strong></p>
</li>
<li>
<p><strong>drogie utrzymanie</strong></p>
</li>
<li>
<p><strong>boilerplace code</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_transakcje_deklaratywne">183.4. Transakcje deklaratywne</h3>
<div class="ulist">
<ul>
<li>
<p><strong>większa elastyczność</strong></p>
</li>
<li>
<p><strong>sterowane adnotacją</strong></p>
</li>
<li>
<p><strong>sterowane plikami konfiguracyjnymi</strong></p>
</li>
<li>
<p><strong>sterowane AOP</strong></p>
</li>
<li>
<p><strong>spójny model</strong> JTA , JPA, JDBC , Hibernate</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookServiceImpl</span> <span class="directive">implements</span> BookService {
<span class="annotation">@Transactional</span>
<span class="directive">public</span> <span class="predefined-type">Book</span> getBook(<span class="predefined-type">Long</span> id) {
<span class="keyword">return</span> repository.getBook(id);
}
<span class="annotation">@Transactional</span>
<span class="directive">public</span> <span class="predefined-type">Book</span> createBook(<span class="predefined-type">Book</span> book) {
<span class="keyword">return</span> repository.createBook(book);
}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_atrybuty_transakcji">183.5. Atrybuty transakcji</h3>
<div class="sect3">
<h4 id="__strong_propagacja_strong">183.5.1. <strong>Propagacja</strong></h4>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_MANDATORY</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>source</em> : <a href="http://docstore.mik.ua/orelly/java-ent/ebeans/ch08_02.htm" class="bare">http://docstore.mik.ua/orelly/java-ent/ebeans/ch08_02.htm</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/mandatory.gif" alt="mandatory">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>metoda musi działać w ramach transakcji. Jeśli nie istnieje uruchomiona transakcja zgłaszany jest wyjątek</p>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_NESTED</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>pojedyńcza fizyczna transakcja z wielona savepointami</p>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_NEVER</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>jeśli istnieje transakcja wyrzuć wyjątek.</p>
</li>
<li>
<p>System typowo beztransakcyjny</p>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_NOT_SUPPORTED</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>source</em> : <a href="http://docstore.mik.ua/orelly/java-ent/ebeans/ch08_02.htm" class="bare">http://docstore.mik.ua/orelly/java-ent/ebeans/ch08_02.htm</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/not_supported.gif" alt="not supported">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_REQUIRED</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>source</em> : <a href="http://docs.spring.io/spring/docs/3.1.x/spring-framework-reference/html/transaction.html" class="bare">http://docs.spring.io/spring/docs/3.1.x/spring-framework-reference/html/transaction.html</a></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/propagation_req.png" alt="propagation_req"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_REQUIRES_NEW</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>source</em> : <a href="http://docs.spring.io/spring/docs/3.1.x/spring-framework-reference/html/transaction.html" class="bare">http://docs.spring.io/spring/docs/3.1.x/spring-framework-reference/html/transaction.html</a></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="img/propagation_req_new.png" alt="propagation_req_new"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_SUPPORTS</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>source</em> : <a href="http://docstore.mik.ua/orelly/java-ent/ebeans/ch08_02.htm" class="bare">http://docstore.mik.ua/orelly/java-ent/ebeans/ch08_02.htm</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/supported.gif" alt="supported">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>jeśli istnieje transakcja metoda działa w jej ramach , w przeciwnym razie metoda jest wykonywana poza kontekstem transakcyjnym</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="__strong_izolacja_strong">183.5.2. <strong>izolacja</strong></h4>
<div class="literalblock">
<div class="content">
<pre>Stopień uniezależnienia od siebie poszczególnych transackcji
Wyższy poziom zapewnia lepszą separację - kosztem wydajności
Poprzez separacje rozumiemy, że jedna niezależna transakcja nie będzie wpływała na inną równoległą w systemie.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_problemy_związane_z_izolacją">183.5.3. Problemy związane z izolacją</h4>
<div class="sect4">
<h5 id="__strong_utrata_aktualizacji_strong"><strong>Utrata aktualizacji</strong></h5>

</div>
<div class="sect4">
<h5 id="__strong_brudny_odczyt_strong"><strong>Brudny odczyt</strong></h5>

</div>
<div class="sect4">
<h5 id="__strong_niepowtarzalny_odczyt_strong"><strong>Niepowtarzalny odczyt</strong></h5>

</div>
<div class="sect4">
<h5 id="__strong_problem_utraty_wcześniejszego_zapisu_strong"><strong>Problem utraty wcześniejszego zapisu</strong></h5>

</div>
<div class="sect4">
<h5 id="__strong_otrzymanie_fantomu_strong"><strong>Otrzymanie fantomu</strong></h5>

</div>
<div class="sect4">
<h5 id="__strong_odczyt_niezatwierdzych_read_uncommited_strong"><strong>Odczyt niezatwierdzych (Read uncommited)</strong></h5>
<div class="ulist">
<ul>
<li>
<p>brak izolacji</p>
</li>
<li>
<p>Jedna transakcja ma dostęp do danych modyfikowanych przez inne transakcji</p>
</li>
<li>
<p>Dopuszcza brudne odczyty, ale uniemożliwia utratę aktualizacji</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(isolation = Isolation.READ_UNCOMMITTED)
<span class="directive">public</span> Order getOrder(<span class="predefined-type">Long</span> orderId) {
<span class="keyword">return</span> repository.getOrder(orderId);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__strong_odczyt_zatwierdzonych_read_commited_strong"><strong>Odczyt zatwierdzonych (Read commited)</strong></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Domyśla dla większości baz DBMSs
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>bieżąca transakcja widzi tylko dane zatwierdzone.</p>
</li>
<li>
<p>problem z długi transakcjami, gdyż bieżąca transakcja będzie odczytywała dane zatwierdzone chwilowo przez inne.</p>
</li>
<li>
<p>transakcja odczytują dwa razy te same dane może zwrócić inne wyniki</p>
</li>
<li>
<p>nie zapewnia powtarzalnego odczytu ale zapobiega  brudnym odczytom</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(isolation = Isolation.READ_COMMITTED)
<span class="directive">public</span> Order getOrder(<span class="predefined-type">Long</span> orderId) {
<span class="keyword">return</span> repository.getOrder(orderId);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__strong_odczyt_powtarzalny_repeatable_read_strong"><strong>Odczyt powtarzalny (Repeatable read)</strong></h5>
<div class="ulist">
<ul>
<li>
<p>bieżąca transakcja widzi zmiany zatwierdzone już po jej rozpoczęciu przez inne równoległe transakcje.</p>
</li>
<li>
<p>ma zapewnioną powtarzalność odczytów</p>
</li>
<li>
<p>rozwiązuje problemy brudnego i niepowtarzalnego odczytu</p>
</li>
<li>
<p>mogą wystąpić fantomy</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="__strong_szeregowalność_serializable_strong"><strong>Szeregowalność (Serializable)</strong></h5>
<div class="ulist">
<ul>
<li>
<p>transakcja szeregowana. Możemy te sposób izolacji traktować synchroniczne wykonywane krok po kroku zamiast opcji zrównoleglenia.</p>
</li>
<li>
<p>bardzo możliwe są konflikty.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wybór_poziomu">183.5.4. Wybór poziomu</h4>
<div class="ulist">
<ul>
<li>
<p>odrzucamy poziom odczytu niezatwierdzonego.(niezatwierdzone zmiany z innych transakcji są bardzo groźne)</p>
</li>
<li>
<p>odrzucamy również górny poziom serializable. Najtrudniej poddaje sie współbieżności.</p>
</li>
<li>
<p>powtarzalny - eliminacja nadpisywania przez inną transakcję. Zwiększa powtarzalność wyników zapytań.</p>
</li>
<li>
<p>zatwierdzony + wersjonowanie wydajne się być w większości przypadków najlepszą praktyką.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__strong_read_only_strong">183.6. <strong>read only</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="directive">public</span> Account getAccount(<span class="predefined-type">Long</span> accountId) {
<span class="keyword">return</span> repository.getAccount(accountId);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__strong_timeout_strong">183.7. <strong>timeout</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(timeout = <span class="integer">60</span>)
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;Order&gt; getActiveOrders(<span class="predefined-type">String</span> from, <span class="predefined-type">String</span> to) {
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__strong_norollbackfor_strong">183.8. <strong>noRollbackFor</strong></h3>
<div class="ulist">
<ul>
<li>
<p>wyjątki dla których wyrzucenie przez metodę nie spowoduje wycofanie transakcji</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@Transactional</span>(noRollbackFor = MailException.class)
    <span class="directive">public</span> <span class="type">void</span> sendJobSuccessMessage(<span class="predefined-type">String</span> jobName, <span class="predefined-type">String</span> message);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="__strong_rollbackfor_strong">183.9. <strong>rollbackFor</strong></h3>
<div class="ulist">
<ul>
<li>
<p>wyjątki dla których wyrzucenie przez metodę może spowodować wycofanie transakcji</p>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Transactional</span>(rollbackFor = <span class="exception">Exception</span>.class)
    <span class="type">void</span> createUser(<span class="directive">final</span> RegisterForm registerForm) <span class="directive">throws</span> <span class="exception">Exception</span>;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguracja_2">184. Konfiguracja :</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableJpaRepositories</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">pl.java.scalatech.repository</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:spring-data.properties</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Slf4j</span>
<span class="annotation">@Import</span>(Metrics2Config.class)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">JpaConfig</span> {


    <span class="annotation">@Autowired</span>
    Optional&lt;MetricRegistry&gt; metricRegistry;

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> Environment env;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dataSource.driverClassName}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> driver;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dataSource.url}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> url;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dataSource.username}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> username;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dataSource.password}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> password;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${hibernate.dialect}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> dialect;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${hibernate.hbm2ddl.auto}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">Boolean</span> hbm2ddlAuto;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${hibernate.show.sql}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">Boolean</span> showSql;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jpa.package}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> jpaPackage;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jpa.hikariMaxPoolSize}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="type">int</span> maxPoolSize;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jpa.hikariConnectionTimeoutMs}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="type">long</span> connectionTimeoutMs;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jpa.hikariIdleTimeoutMs}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="type">long</span> idleTimeoutMs;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jpa.hikariMaxLifetimeMs}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="type">long</span> maxLifetimeMs;

    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${jpa.hikariRegisterMbeans}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="type">boolean</span> registerMbeans;



    <span class="directive">public</span> <span class="directive">abstract</span> <span class="type">void</span> dataSourceConfigure(HikariConfig hikariConfig) <span class="directive">throws</span> <span class="exception">SQLException</span>;
    <span class="directive">public</span> <span class="directive">abstract</span> Database dataBase();



    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">DataSource</span> datasource() <span class="directive">throws</span> <span class="exception">SQLException</span>{
        HikariConfig config = <span class="keyword">new</span> HikariConfig();
        dataSourceConfigure(config);
        config.setMaximumPoolSize(maxPoolSize);
       <span class="comment">// config.setConnectionTimeout(connectionTimeoutMs);</span>
        config.setIdleTimeout(idleTimeoutMs);
        config.setMaxLifetime(maxLifetimeMs);
        config.setRegisterMbeans(registerMbeans);
        config.setPoolName(<span class="string"><span class="delimiter">&quot;</span><span class="content">pool</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span>(metricRegistry.isPresent()){
         config.setMetricRegistry(metricRegistry.get());
        }
        HikariDataSource dataSource = <span class="keyword">new</span> HikariDataSource(config);
        <span class="keyword">return</span> dataSource;
}

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> PlatformTransactionManager transactionManager() {
        <span class="keyword">return</span> <span class="keyword">new</span> JpaTransactionManager();
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> PersistenceExceptionTranslationPostProcessor exceptionTranslation() {
        <span class="keyword">return</span> <span class="keyword">new</span> PersistenceExceptionTranslationPostProcessor();
    }

    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; jpaProperties() {
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; props = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        <span class="comment">/*
         * props.put(&quot;hibernate.cache.use_query_cache&quot;, &quot;true&quot;);
         * props.put(&quot;hibernate.cache.region.factory_class&quot;, &quot;org.hibernate.cache.ehcache.EhCacheRegionFactory&quot;);
         * props.put(&quot;hibernate.cache.provider_class&quot;, &quot;org.hibernate.cache.ehcache.EhCacheRegionFactory&quot;);
         * props.put(&quot;hibernate.cache.use_second_level_cache&quot;, &quot;true&quot;);
         */</span>
        <span class="keyword">return</span> props;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> LocalContainerEntityManagerFactoryBean entityManagerFactory() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">+++ entityManagerFactory started ...</span><span class="delimiter">&quot;</span></span>);
        LocalContainerEntityManagerFactoryBean lef = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();
        lef.setJpaDialect(customJpaDialect());
        lef.setDataSource(datasource());
        lef.setJpaVendorAdapter(jpaVendorAdapter());
        lef.setJpaPropertyMap(jpaProperties());
        lef.setPackagesToScan(jpaPackage); <span class="comment">// eliminate persistence.xml</span>
        <span class="keyword">return</span> lef;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> JpaVendorAdapter jpaVendorAdapter() {
        HibernateJpaVendorAdapter hibernateJpaVendorAdapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();
        hibernateJpaVendorAdapter.setShowSql(showSql);
        hibernateJpaVendorAdapter.setGenerateDdl(hbm2ddlAuto);
        hibernateJpaVendorAdapter.setDatabase(dataBase());
        hibernateJpaVendorAdapter.setDatabasePlatform(dialect);
        <span class="keyword">return</span> hibernateJpaVendorAdapter;
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> Log4JdbcCustomFormatter logFormater() {
        Log4JdbcCustomFormatter formatter = <span class="keyword">new</span> Log4JdbcCustomFormatter();
        formatter.setLoggingType(LoggingType.SINGLE_LINE);
        formatter.setSqlPrefix(<span class="string"><span class="delimiter">&quot;</span><span class="content">SQL:</span><span class="char">\r</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> formatter;
    }

    <span class="directive">public</span> JpaDialect customJpaDialect() {
        <span class="keyword">return</span> <span class="keyword">new</span> CustomHibernateJpaDialect();
    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_strategia_dla_bazy_wbudowanej">184.1. Strategia dla bazy wbudowanej :</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@Slf4j</span>
<span class="annotation">@Profile</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Order</span>(<span class="integer">10001</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JpaEmbeddedConfig</span> <span class="directive">extends</span> JpaConfig {


    <span class="annotation">@Override</span>
    <span class="directive">public</span> Database dataBase() {
        <span class="keyword">return</span> Database.H2;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> dataSourceConfigure(HikariConfig config) <span class="directive">throws</span> <span class="exception">SQLException</span> {
        config.setDataSourceClassName(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.jdbcx.JdbcDataSource</span><span class="delimiter">&quot;</span></span>);
        config.setConnectionTestQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">VALUES 1</span><span class="delimiter">&quot;</span></span>);
        config.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">URL</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:~/test</span><span class="delimiter">&quot;</span></span>);
        config.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>);
        config.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);


    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_baza_wbudowana_konfiguracja_xml">184.2. Baza wbudowana / konfiguracja xml</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jdbc:embedded-database id=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> type=<span class="string"><span class="delimiter">&quot;</span><span class="content">HSQL|H2|Derby</span><span class="delimiter">&quot;</span></span>&gt;
&lt;jdbc:script location=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:db-schema.sql</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;jdbc:script location=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:test-data.sql</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/jdbc:embedded-database&gt;

&lt;bean <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pl.java.scalatech.repository.jdbc.BookJdbcRepository</span><span class="delimiter">&quot;</span></span>&gt;
&lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_h2_w_konsoli_web">185. H2 w konsoli WEB</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@Profile</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">h2</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Order</span>(<span class="integer">10001</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">H2Database</span> <span class="directive">extends</span> JpaConfig{

    <span class="annotation">@Bean</span>(destroyMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">close</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@DependsOn</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">h2Server</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">DataSource</span> dataSource(Server h2Server) <span class="directive">throws</span> <span class="exception">SQLException</span> {
        HikariConfig hikariConfig = <span class="keyword">new</span> HikariConfig();
        dataSourceConfigure(hikariConfig);
        hikariConfig.setMaximumPoolSize(maxPoolSize);
        hikariConfig.setConnectionTimeout(connectionTimeoutMs);
        hikariConfig.setIdleTimeout(idleTimeoutMs);
        hikariConfig.setMaxLifetime(maxLifetimeMs);
        hikariConfig.setRegisterMbeans(registerMbeans);
        hikariConfig.setConnectionTestQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">VALUES 1</span><span class="delimiter">&quot;</span></span>);
        hikariConfig.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">useServerPrepStmts</span><span class="delimiter">&quot;</span></span>, username);
        HikariDataSource dataSource = <span class="keyword">new</span> HikariDataSource(hikariConfig);

        createTcpServer();
       <span class="comment">// CodaHaleMetricsTracker cmt = new CodaHaleMetricsTracker(pool, dataSource.getMetricRegistry());</span>
        <span class="keyword">return</span> dataSource;

    }

    <span class="annotation">@Bean</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">h2Server</span><span class="delimiter">&quot;</span></span>, initMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>, destroyMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">stop</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@DependsOn</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">h2WebServer</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> org.h2.tools.Server createTcpServer() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="keyword">return</span> org.h2.tools.Server.createTcpServer(<span class="string"><span class="delimiter">&quot;</span><span class="content">-tcp,-tcpAllowOthers,-tcpPort,9092</span><span class="delimiter">&quot;</span></span>.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="annotation">@Bean</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">h2WebServer</span><span class="delimiter">&quot;</span></span>, initMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>, destroyMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">stop</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> org.h2.tools.Server createWebServer() <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="keyword">return</span> org.h2.tools.Server.createWebServer(<span class="string"><span class="delimiter">&quot;</span><span class="content">-web,-webAllowOthers,-webPort,8082</span><span class="delimiter">&quot;</span></span>.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span>));
    }


    <span class="annotation">@Override</span>
    <span class="directive">public</span> Database dataBase() {
        <span class="keyword">return</span> Database.H2;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> dataSourceConfigure(HikariConfig hikariConfig) <span class="directive">throws</span> <span class="exception">SQLException</span> {
        hikariConfig.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>, url);
        hikariConfig.setUsername(username);
        hikariConfig.setPassword(password);
        hikariConfig.setDataSourceClassName(driver);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_jpa_rozwiązanie_problemów_z_izolacją_transakcji">186. Custom JPA = rozwiązanie problemów z izolacją transakcji</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomHibernateJpaDialect</span> <span class="directive">extends</span> HibernateJpaDialect {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;

    <span class="comment">/*
     * This method is overridden to set custom isolation levels on the connection
     * (non-Javadoc)
     * @see org.springframework.orm.jpa.vendor.HibernateJpaDialect#beginTransaction(javax.persistence.EntityManager, org.springframework.transaction.TransactionDefinition)
     */</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> beginTransaction(<span class="directive">final</span> EntityManager entityManager,
            <span class="directive">final</span> TransactionDefinition definition)
            <span class="directive">throws</span> PersistenceException, <span class="exception">SQLException</span>, TransactionException {

        Session session = (Session) entityManager.getDelegate();
        <span class="keyword">if</span> (definition.getTimeout() != TransactionDefinition.TIMEOUT_DEFAULT) {
            getSession(entityManager).getTransaction().setTimeout(
                    definition.getTimeout());
        }

        <span class="directive">final</span> TransactionData data = <span class="keyword">new</span> TransactionData();

        session.doWork(<span class="keyword">new</span> Work() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> execute(<span class="predefined-type">Connection</span> connection) <span class="directive">throws</span> <span class="exception">SQLException</span> {
                <span class="predefined-type">Integer</span> previousIsolationLevel = DataSourceUtils
                        .prepareConnectionForTransaction(connection, definition);
                data.setPreviousIsolationLevel(previousIsolationLevel);
                data.setConnection(connection);
            }
        });

        entityManager.getTransaction().begin();

        <span class="predefined-type">Object</span> springTransactionData = prepareTransaction(entityManager,
                definition.isReadOnly(), definition.getName());

        data.setSpringTransactionData(springTransactionData);

        <span class="keyword">return</span> data;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> cleanupTransaction(<span class="predefined-type">Object</span> transactionData) {
        <span class="local-variable">super</span>.cleanupTransaction(((TransactionData) transactionData)
                .getSpringTransactionData());
        ((TransactionData) transactionData).resetIsolationLevel();
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">TransactionData</span> {

        <span class="directive">private</span> <span class="predefined-type">Object</span> springTransactionData;
        <span class="directive">private</span> <span class="predefined-type">Integer</span> previousIsolationLevel;
        <span class="directive">private</span> <span class="predefined-type">Connection</span> connection;

        <span class="directive">public</span> TransactionData() {
        }

        <span class="directive">public</span> <span class="type">void</span> resetIsolationLevel() {
            <span class="keyword">if</span> (<span class="local-variable">this</span>.previousIsolationLevel != <span class="predefined-constant">null</span>) {
                DataSourceUtils.resetConnectionAfterTransaction(connection,
                        previousIsolationLevel);
            }
        }

        <span class="directive">public</span> <span class="predefined-type">Object</span> getSpringTransactionData() {
            <span class="keyword">return</span> <span class="local-variable">this</span>.springTransactionData;
        }

        <span class="directive">public</span> <span class="type">void</span> setSpringTransactionData(<span class="predefined-type">Object</span> springTransactionData) {
            <span class="local-variable">this</span>.springTransactionData = springTransactionData;
        }

        <span class="directive">public</span> <span class="type">void</span> setPreviousIsolationLevel(<span class="predefined-type">Integer</span> previousIsolationLevel) {
            <span class="local-variable">this</span>.previousIsolationLevel = previousIsolationLevel;
        }

        <span class="directive">public</span> <span class="type">void</span> setConnection(<span class="predefined-type">Connection</span> connection) {
            <span class="local-variable">this</span>.connection = connection;
        }

    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transaciontemplate">187. TransacionTemplate</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.JpaTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.transaction.support.TransactionTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pl.java.scalatech.BookServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionTemplate</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_użycie">187.1. Użycie</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> deleteBooks(<span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; books) {
transactionTemplate.execute(<span class="keyword">new</span> TransactionCallback() {
<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> doInTransaction(TransactionStatus status) {
...
...
}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tworzenie_repozytorium_jpa_hibernate">188. Tworzenie repozytorium jpa/Hibernate</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Repository</span>
<span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookHibernateRepository</span> <span class="directive">implements</span> BookRepository {
<span class="annotation">@Autowired</span>
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;
<span class="directive">private</span> HibernateTemplate hibernate;
<span class="annotation">@Autowired</span>
<span class="directive">public</span> BookHibernateRepository(<span class="predefined-type">DataSource</span> dataSource) {
<span class="local-variable">super</span>
<span class="local-variable">this</span>.hibernateTemplate = <span class="keyword">new</span> HibernateTemplate(dataSource);
}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tworzenie_repozytorium_jpa">189. Tworzenie repozytorium jpa</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Repository</span>
<span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookJpaRepository</span> <span class="directive">implements</span> BookRepository {

<span class="annotation">@Autowired</span>
<span class="directive">private</span> EntityManager em;

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_praca_z_wieloma_manadzerami_transakcji">190. Praca z wieloma  manadzerami transakcji</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">txManager1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getAndSavePrice (<span class="predefined-type">Book</span> book) {}


<span class="annotation">@Transactional</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">txManager2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Book</span> merge(<span class="predefined-type">Book</span> book ) {}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_ulepszenia_swoje_adnotacje">190.1. Ulepszenia / swoje adnotacje</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.TYPE})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Transactional</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">txManager1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="annotation">@interface</span> BookTx {}


<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.TYPE})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Transactional</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">txManager2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="annotation">@interface</span> BookSecondTx {}

<span class="annotation">@OrderTx</span>
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> getAndSavePrice (<span class="predefined-type">Book</span> book) {}

<span class="annotation">@BookSecondTx</span>
<span class="directive">public</span> <span class="predefined-type">Book</span> merge(<span class="predefined-type">Book</span> book ) {}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dodatek">191. Dodatek</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wsparcie_jdbc">191.1. Wsparcie JDBC</h3>
<div class="ulist">
<ul>
<li>
<p>JdbcTemplate</p>
</li>
<li>
<p>NamedParameterJdbcTemplate</p>
</li>
<li>
<p>SimpleJdbcTemplate</p>
</li>
<li>
<p>SimpleJdbcInsert</p>
</li>
<li>
<p>SimpleJdbcCall</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_tworzenie_repozytorium_jdbc">191.2. Tworzenie repozytorium jdbc</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Repository</span>
<span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookJdbcRepository</span> <span class="directive">implements</span> BookRepository {
<span class="annotation">@Autowired</span>
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;
<span class="directive">private</span> JdbcTemplate jdbcTemplate;
<span class="annotation">@Autowired</span>
<span class="directive">public</span> BookJdbcRepository(<span class="predefined-type">DataSource</span> dataSource) {
<span class="local-variable">super</span>
<span class="local-variable">this</span>.jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);
}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_data">192. Spring Data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_najnowsze_features">192.1. Najnowsze features:)</h3>
<div class="ulist">
<ul>
<li>
<p>Support for Projections in repository query methods.</p>
</li>
<li>
<p>Support for Query by Example.</p>
</li>
<li>
<p>The following annotations have been enabled to build own, composed annotations: @EntityGraph, @Lock, @Modifying, @Query, @QueryHints and @Procedure.</p>
</li>
<li>
<p>Support for Contains keyword on collection expressions.</p>
</li>
<li>
<p>AttributeConverters for ZoneId of JSR-310 and ThreeTenBP.</p>
</li>
<li>
<p>Upgrade to Querydsl 4, Hibernate 5, OpenJPA 2.4 and EclipseLink 2.6.1.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_geneza">192.2. Geneza</h3>
<div class="literalblock">
<div class="content">
<pre>Powstał 2010 podczas sesji Roda Jonsona z Emilem Eifrem (Neo Technologies), jako próba integracji Spring z Neo4j</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_charakretystyka">192.3. Charakretystyka</h3>
<div class="ulist">
<ul>
<li>
<p>generyczna impl DAO</p>
</li>
<li>
<p>postawowa impl CRUD</p>
</li>
<li>
<p>kod dao generowany poprzez definicję metody np findByName , findByAgeBetween</p>
</li>
<li>
<p>paging i sortowanie w standardzie</p>
</li>
<li>
<p>wsparcie dla JPA, Mongo, Neo4j, Redis itd</p>
</li>
<li>
<p>wsparcie dla QueryDSL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>source : <em>www.patrick-gotthard.de</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/repository-inheritance-hierarchy.png" alt="repository inheritance hierarchy">
</div>
</div>
<div class="paragraph">
<p>source: <em><a href="https://visola.github.io" class="bare">https://visola.github.io</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/spring-data-001.png" alt="spring data 001">
</div>
</div>
<div class="paragraph">
<p>source: <em><a href="http://luxosuseadicto.blogspot.com" class="bare">http://luxosuseadicto.blogspot.com</a></em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dataaccess_jpa_basic_flow.png" alt="dataaccess jpa basic flow">
</div>
</div>
<div class="sect3">
<h4 id="_przykład_całej_minimalnej_konfiguracji">192.3.1. Przykład całej minimalnej konfiguracji</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableJpaRepositories</span>
<span class="annotation">@EnableTransactionManagement</span>
<span class="type">class</span> <span class="class">ApplicationConfig</span> {

  <span class="annotation">@Bean</span>
  <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {

    EmbeddedDatabaseBuilder builder = <span class="keyword">new</span> EmbeddedDatabaseBuilder();
    <span class="keyword">return</span> builder.setType(EmbeddedDatabaseType.HSQL).build();
  }

  <span class="annotation">@Bean</span>
  <span class="directive">public</span> EntityManagerFactory entityManagerFactory() {

    HibernateJpaVendorAdapter vendorAdapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();
    vendorAdapter.setGenerateDdl(<span class="predefined-constant">true</span>);

    LocalContainerEntityManagerFactoryBean factory = <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();
    factory.setJpaVendorAdapter(vendorAdapter);
    factory.setPackagesToScan(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.domain</span><span class="delimiter">&quot;</span></span>);
    factory.setDataSource(dataSource());
    factory.afterPropertiesSet();

    <span class="keyword">return</span> factory.getObject();
  }

  <span class="annotation">@Bean</span>
  <span class="directive">public</span> PlatformTransactionManager transactionManager() {

    JpaTransactionManager txManager = <span class="keyword">new</span> JpaTransactionManager();
    txManager.setEntityManagerFactory(entityManagerFactory());
    <span class="keyword">return</span> txManager;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tworzenie_proxy">192.3.2. Tworzenie proxy</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span>;

<span class="annotation">@EnableJpaRepositories</span>
<span class="type">class</span> <span class="class">Config</span> {}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_annotation_driven_configuration">192.3.3. Annotation-driven configuration</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableJpaRepositories</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.repositories.jpa</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@EnableMongoRepositories</span>(basePackages = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.repositories.mongo</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> <span class="class">Configuration</span> { }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_standalone">192.3.4. Standalone</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RepositoryFactorySupport factory = <span class="error">…</span> <span class="comment">// Instantiate factory here</span>
UserRepository repository = factory.getRepository(UserRepository.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wybór_metod_crud">192.3.5. Wybór metod CRUD</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NoRepositoryBean</span>
<span class="type">interface</span> <span class="class">MyBaseRepository</span>&lt;T, ID <span class="directive">extends</span> <span class="predefined-type">Serializable</span>&gt; <span class="directive">extends</span> Repository&lt;T, ID&gt; {

  T findOne(ID id);

  T save(T entity);
}

<span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> MyBaseRepository&lt;User, <span class="predefined-type">Long</span>&gt; {
  User findByEmailAddress(EmailAddress emailAddress);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wykorzystanie_pageable_slice_sort">192.3.6. Wykorzystanie Pageable, Slice, Sort</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Page&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">Pageable</span> pageable);

Slice&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">Pageable</span> pageable);

<span class="predefined-type">List</span>&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname, Sort sort);

<span class="predefined-type">List</span>&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">Pageable</span> pageable);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ograniczenie_wyników_zapytań">192.3.7. Ograniczenie wyników zapytań</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">User findFirstByOrderByLastnameAsc();

User findTopByOrderByAgeDesc();

Page&lt;User&gt; queryFirst10ByLastname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">Pageable</span> pageable);

Slice&lt;User&gt; findTop3ByLastname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">Pageable</span> pageable);

<span class="predefined-type">List</span>&lt;User&gt; findFirst10ByLastname(<span class="predefined-type">String</span> lastname, Sort sort);

<span class="predefined-type">List</span>&lt;User&gt; findTop10ByLastname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">Pageable</span> pageable);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_streaming">192.3.8. Streaming</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u from User u</span><span class="delimiter">&quot;</span></span>)
Stream&lt;User&gt; findAllByCustomQueryAndStream();

Stream&lt;User&gt; readAllByFirstnameNotNull();

<span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u from User u</span><span class="delimiter">&quot;</span></span>)
Stream&lt;User&gt; streamAllPaged(<span class="predefined-type">Pageable</span> pageable);

<span class="comment">///</span>


<span class="keyword">try</span> (Stream&lt;User&gt; stream = repository.findAllByCustomQueryAndStream()) {
  stream.forEach(<span class="error">…</span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_asynchroniczność">192.3.9. Asynchroniczność</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Async</span>
<span class="predefined-type">Future</span>&lt;User&gt; findByFirstname(<span class="predefined-type">String</span> firstname);

<span class="annotation">@Async</span>
CompletableFuture&lt;User&gt; findOneByFirstname(<span class="predefined-type">String</span> firstname);

<span class="annotation">@Async</span>
ListenableFuture&lt;User&gt; findOneByLastname(<span class="predefined-type">String</span> lastname);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dostrajanie_do_swoich_potrzeb">192.3.10. Dostrajanie do swoich potrzeb</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">UserRepositoryCustom</span> {
  <span class="directive">public</span> <span class="type">void</span> someCustomMethod(User user);
}



<span class="type">class</span> <span class="class">UserRepositoryImpl</span> <span class="directive">implements</span> UserRepositoryCustom {

  <span class="directive">public</span> <span class="type">void</span> someCustomMethod(User user) {
    <span class="comment">// Your custom implementation</span>
  }
}




<span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> CrudRepository&lt;User, <span class="predefined-type">Long</span>&gt;, UserRepositoryCustom {

  <span class="comment">// Declare query methods here</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dsl">192.3.11. DSL</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">QueryDslPredicateExecutor</span>&lt;T&gt; {

    T findOne(<span class="predefined-type">Predicate</span> predicate);

    <span class="predefined-type">Iterable</span>&lt;T&gt; findAll(<span class="predefined-type">Predicate</span> predicate);

    <span class="type">long</span> count(<span class="predefined-type">Predicate</span> predicate);

    <span class="type">boolean</span> exists(<span class="predefined-type">Predicate</span> predicate);

    <span class="comment">// … more functionality omitted.</span>




<span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> CrudRepository&lt;User, <span class="predefined-type">Long</span>&gt;, QueryDslPredicateExecutor&lt;User&gt; {

}


}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Predicate</span> predicate = user.firstname.equalsIgnoreCase(<span class="string"><span class="delimiter">&quot;</span><span class="content">dave</span><span class="delimiter">&quot;</span></span>)
        .and(user.lastname.startsWithIgnoreCase(<span class="string"><span class="delimiter">&quot;</span><span class="content">mathews</span><span class="delimiter">&quot;</span></span>));

userRepository.findAll(predicate);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nazwane_zapytania">192.4. Nazwane zapytania</h3>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@NamedQuery</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">User.findByEmailAddress</span><span class="delimiter">&quot;</span></span>,
  query = <span class="string"><span class="delimiter">&quot;</span><span class="content">select u from User u where u.emailAddress = ?1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {

}



<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> JpaRepository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="predefined-type">List</span>&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname);

  User findByEmailAddress(<span class="predefined-type">String</span> emailAddress);
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="__query">192.4.1. @Query</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> JpaRepository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u from User u where u.emailAddress = ?1</span><span class="delimiter">&quot;</span></span>)
  User findByEmailAddress(<span class="predefined-type">String</span> emailAddress);
}



<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> JpaRepository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u from User u where u.firstname like %?1</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;User&gt; findByFirstnameEndsWith(<span class="predefined-type">String</span> firstname);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_natywne_zapytania">192.4.2. Natywne zapytania</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> JpaRepository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="annotation">@Query</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM USERS WHERE EMAIL_ADDRESS = ?1</span><span class="delimiter">&quot;</span></span>, nativeQuery = <span class="predefined-constant">true</span>)
  User findByEmailAddress(<span class="predefined-type">String</span> emailAddress);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> JpaRepository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u from User u where u.firstname = :firstname or u.lastname = :lastname</span><span class="delimiter">&quot;</span></span>)
  User findByLastnameOrFirstname(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastname</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> lastname,
                                 <span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstname</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> firstname);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spel_expressions">192.4.3. SpEL expressions</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {

  <span class="annotation">@Id</span>
  <span class="annotation">@GeneratedValue</span>
  <span class="predefined-type">Long</span> id;

  <span class="predefined-type">String</span> lastname;
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> JpaRepository&lt;User,<span class="predefined-type">Long</span>&gt; {

  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u from #{#entityName} u where u.lastname = ?1</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modyfikacja_danych">192.4.4. Modyfikacja danych</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Modifying</span>
<span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">update User u set u.firstname = ?1 where u.lastname = ?2</span><span class="delimiter">&quot;</span></span>)
<span class="type">int</span> setFixedFirstnameFor(<span class="predefined-type">String</span> firstname, <span class="predefined-type">String</span> lastname);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hint_2">192.4.5. Hint</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> Repository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="annotation">@QueryHints</span>(value = { <span class="annotation">@QueryHint</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)},
              forCounting = <span class="predefined-constant">false</span>)
  Page&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">Pageable</span> pageable);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_load_entitygraph">192.4.6. Fetch load EntityGraph</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@NamedEntityGraph</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">GroupInfo.detail</span><span class="delimiter">&quot;</span></span>,
  attributeNodes = <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">members</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">GroupInfo</span> {

  <span class="comment">// default fetch mode is lazy.</span>
  <span class="annotation">@ManyToMany</span>
  <span class="predefined-type">List</span>&lt;GroupMember&gt; members = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;GroupMember&gt;();

  <span class="error">…</span>

}
<span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">GroupRepository</span> <span class="directive">extends</span> CrudRepository&lt;GroupInfo, <span class="predefined-type">String</span>&gt; {

  <span class="annotation">@EntityGraph</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">GroupInfo.detail</span><span class="delimiter">&quot;</span></span>, type = EntityGraphType.LOAD)
  GroupInfo getByGroupName(<span class="predefined-type">String</span> name);

}



<span class="annotation">@Repository</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">GroupRepository</span> <span class="directive">extends</span> CrudRepository&lt;GroupInfo, <span class="predefined-type">String</span>&gt; {

  <span class="annotation">@EntityGraph</span>(attributePaths = { <span class="string"><span class="delimiter">&quot;</span><span class="content">members</span><span class="delimiter">&quot;</span></span> })
  GroupInfo getByGroupName(<span class="predefined-type">String</span> name);

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_projection">192.4.7. Projection</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {

  <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
  <span class="directive">private</span> <span class="predefined-type">Long</span> id;
  <span class="directive">private</span> <span class="predefined-type">String</span> firstName, lastName;

  <span class="annotation">@OneToOne</span>
  <span class="directive">private</span> Address address;
  <span class="error">…</span>
}

<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {

  <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
  <span class="directive">private</span> <span class="predefined-type">Long</span> id;
  <span class="directive">private</span> <span class="predefined-type">String</span> street, state, country;

  <span class="error">…</span>
}


<span class="type">interface</span> <span class="class">PersonRepository</span> <span class="directive">extends</span> CrudRepository&lt;Person, <span class="predefined-type">Long</span>&gt; {

  Person findPersonByFirstName(<span class="predefined-type">String</span> firstName);
}



<span class="type">interface</span> <span class="class">AddressRepository</span> <span class="directive">extends</span> CrudRepository&lt;Address, <span class="predefined-type">Long</span>&gt; {}



<span class="type">interface</span> <span class="class">NoAddresses</span> {

  <span class="predefined-type">String</span> getFirstName();

  <span class="predefined-type">String</span> getLastName();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_procedury_składowane">192.4.8. Procedury składowane</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">/;
<span class="class">DROP</span> <span class="type">procedure</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> plus1inout
/;
<span class="class">CREATE</span> <span class="type">procedure</span> plus1inout (<span class="keyword">IN</span> arg <span class="predefined-type">int</span>, OUT res <span class="predefined-type">int</span>)
<span class="class">BEGIN</span> ATOMIC
 <span class="class">set</span> res = arg + <span class="integer">1</span>;
<span class="keyword">END</span>
/;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@NamedStoredProcedureQuery</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">User.plus1</span><span class="delimiter">&quot;</span></span>, procedureName = <span class="string"><span class="delimiter">&quot;</span><span class="content">plus1inout</span><span class="delimiter">&quot;</span></span>, parameters = {
  <span class="annotation">@StoredProcedureParameter</span>(mode = ParameterMode.IN, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">arg</span><span class="delimiter">&quot;</span></span>, type = <span class="predefined-type">Integer</span>.class),
  <span class="annotation">@StoredProcedureParameter</span>(mode = ParameterMode.OUT, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">res</span><span class="delimiter">&quot;</span></span>, type = <span class="predefined-type">Integer</span>.class) })
<span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {}


<span class="annotation">@Procedure</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">plus1inout</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">Integer</span> explicitlyNamedPlus1inout(<span class="predefined-type">Integer</span> arg);



<span class="annotation">@Procedure</span>(procedureName = <span class="string"><span class="delimiter">&quot;</span><span class="content">plus1inout</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">Integer</span> plus1inout(<span class="predefined-type">Integer</span> arg);



<span class="annotation">@Procedure</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">User.plus1IO</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">Integer</span> entityAnnotatedCustomNamedProcedurePlus1IO(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">arg</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">Integer</span> arg);




<span class="annotation">@Procedure</span>
<span class="predefined-type">Integer</span> plus1(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">arg</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">Integer</span> arg);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_specifications">192.4.9. Specifications</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CustomerRepository</span> <span class="directive">extends</span> CrudRepository&lt;Customer, <span class="predefined-type">Long</span>&gt;, JpaSpecificationExecutor {
 <span class="error">…</span>
}




<span class="predefined-type">List</span>&lt;T&gt; findAll(Specification&lt;T&gt; spec);



<span class="directive">public</span> <span class="type">interface</span> <span class="class">Specification</span>&lt;T&gt; {
  <span class="predefined-type">Predicate</span> toPredicate(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query,
            CriteriaBuilder builder);
}



<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerSpecs</span> {

  <span class="directive">public</span> <span class="directive">static</span> Specification&lt;Customer&gt; isLongTermCustomer() {
    <span class="keyword">return</span> <span class="keyword">new</span> Specification&lt;Customer&gt;() {
      <span class="directive">public</span> <span class="predefined-type">Predicate</span> toPredicate(Root&lt;Customer&gt; root, CriteriaQuery&lt;?&gt; query,
            CriteriaBuilder builder) {

         LocalDate date = <span class="keyword">new</span> LocalDate().minusYears(<span class="integer">2</span>);
         <span class="keyword">return</span> builder.lessThan(root.get(_Customer.createdAt), date);
      }
    };
  }

  <span class="directive">public</span> <span class="directive">static</span> Specification&lt;Customer&gt; hasSalesOfMoreThan(MontaryAmount value) {
    <span class="keyword">return</span> <span class="keyword">new</span> Specification&lt;Customer&gt;() {
      <span class="directive">public</span> <span class="predefined-type">Predicate</span> toPredicate(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query,
            CriteriaBuilder builder) {

         <span class="comment">// build query here</span>
      }
    };
  }
}

<span class="comment">// using</span>


<span class="predefined-type">List</span>&lt;Customer&gt; customers = customerRepository.findAll(isLongTermCustomer());</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład 2</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserSpecifications</span> {

    <span class="directive">public</span> <span class="directive">static</span> Specification&lt;User&gt; getUserByLogin(<span class="directive">final</span> <span class="predefined-type">String</span> str) {
        <span class="keyword">return</span> <span class="keyword">new</span> Specification&lt;User&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="predefined-type">Predicate</span> toPredicate(Root&lt;User&gt; personRoot, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb) {
                <span class="keyword">return</span> cb.equal(personRoot.&lt;<span class="predefined-type">String</span>&gt; get(User_.login), str);
            }
        };
    }

    <span class="directive">public</span> <span class="directive">static</span> Specification&lt;User&gt; getUsersWhoEarMoreThan(<span class="directive">final</span> <span class="predefined-type">BigDecimal</span> salary) {
        <span class="keyword">return</span> <span class="keyword">new</span> Specification&lt;User&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="predefined-type">Predicate</span> toPredicate(Root&lt;User&gt; personRoot, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb) {
                <span class="keyword">return</span> cb.greaterThan(personRoot.&lt;<span class="predefined-type">BigDecimal</span>&gt; get(User_.salary), salary);
            }
        };
    }
}

<span class="comment">//</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldSpecificationsPredicateWork() {
        assertThat(userRepository.findAll(getUserByLogin(<span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span>))).hasSize(<span class="integer">1</span>)
            .containsOnly(User.builder().login(<span class="string"><span class="delimiter">&quot;</span><span class="content">przodownik</span><span class="delimiter">&quot;</span></span>).name(<span class="string"><span class="delimiter">&quot;</span><span class="content">borowiec</span><span class="delimiter">&quot;</span></span>).salary(<span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="integer">120</span>)).build());
        assertThat(userRepository.findAll(getUsersWhoEarMoreThan(<span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="integer">300</span>)))).hasSize(<span class="integer">2</span>);
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_by_example">192.4.10. Query by Example</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">*** Przyk<span class="error">ł</span>ad</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>public class Person {

  @Id
  private String id;
  private String firstname;
  private String lastname;
  private Address address;

  // … getters and setters omitted
}

Person person = new Person();
person.setFirstname("Dave");

Example&lt;Person&gt; example = Example.of(person);

public interface QueryByExampleExecutor&lt;T&gt; {

  &lt;S extends T&gt; S findOne(Example&lt;S&gt; example);

  &lt;S extends T&gt; Iterable&lt;S&gt; findAll(Example&lt;S&gt; example);

  // … more functionality omitted.
}



//example

Person person = new Person();
person.setFirstname("Dave");

ExampleMatcher matcher = ExampleMatcher.matching()
  .withIgnorePaths("lastname")
  .withIncludeNullValues()
  .withStringMatcherEnding();

Example&lt;Person&gt; example = Example.of(person, matcher);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_transakcyjność">192.4.11. Transakcyjność</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> CrudRepository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="annotation">@Override</span>
  <span class="annotation">@Transactional</span>(timeout = <span class="integer">10</span>)
  <span class="directive">public</span> <span class="predefined-type">List</span>&lt;User&gt; findAll();

  <span class="comment">// Further query method declarations</span>
}



<span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> JpaRepository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="predefined-type">List</span>&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname);

  <span class="annotation">@Modifying</span>
  <span class="annotation">@Transactional</span>
  <span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete from User u where u.active = false</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> deleteInactiveUsers();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_locking">192.4.12. Locking</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> Repository&lt;User, <span class="predefined-type">Long</span>&gt; {

  <span class="comment">// Plain query method</span>
  <span class="annotation">@Lock</span>(LockModeType.READ)
  <span class="predefined-type">List</span>&lt;User&gt; findByLastname(<span class="predefined-type">String</span> lastname);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_audyt_audit">192.4.13. Audyt / Audit</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Customer</span> {

  <span class="annotation">@CreatedBy</span>
  <span class="directive">private</span> User user;

  <span class="annotation">@CreatedDate</span>
  <span class="directive">private</span> DateTime createdDate;

  <span class="comment">// … further properties omitted</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auditoraware">192.4.14. AuditorAware</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">SpringSecurityAuditorAware</span> <span class="directive">implements</span> AuditorAware&lt;User&gt; {

  <span class="directive">public</span> User getCurrentAuditor() {

    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    <span class="keyword">if</span> (authentication == <span class="predefined-constant">null</span> || !authentication.isAuthenticated()) {
      <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="keyword">return</span> ((MyUserDetails) authentication.getPrincipal()).getUser();
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@EntityListeners</span>(AuditingEntityListener.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyEntity</span> {

}



<span class="annotation">@Configuration</span>
<span class="annotation">@EnableJpaAuditing</span>
<span class="type">class</span> <span class="class">Config</span> {

  <span class="annotation">@Bean</span>
  <span class="directive">public</span> AuditorAware&lt;AuditableUser&gt; auditorProvider() {
    <span class="keyword">return</span> <span class="keyword">new</span> AuditorAwareImpl();
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_support">192.5. Web support</h3>
<div class="sect3">
<h4 id="_konfiguracja_3">192.5.1. Konfiguracja</h4>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebMvc</span>
<span class="annotation">@EnableSpringDataWebSupport</span>
<span class="type">class</span> <span class="class">WebConfiguration</span> { }</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_domainclassconverter">DomainClassConverter</h5>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/users</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserController</span> {

  <span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{id}</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="predefined-type">String</span> showUserForm(<span class="annotation">@PathVariable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) User user, Model model) {

    model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, user);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">userForm</span><span class="delimiter">&quot;</span></span>;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_handlermethodargumentresolver_dostęp_do_pageable_i_sort_z_poziomu_parametrów_requesta">HandlerMethodArgumentResolver  dostęp do  Pageable i  Sort z poziomu parametrów requesta</h5>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/users</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserController</span> {

  <span class="annotation">@Autowired</span> UserRepository repository;

  <span class="annotation">@RequestMapping</span>
  <span class="directive">public</span> <span class="predefined-type">String</span> showUsers(Model model, <span class="predefined-type">Pageable</span> pageable) {

    model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>, repository.findAll(pageable));
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_hypermedia_wsparcie_dla_pageables">Hypermedia wsparcie dla  Pageables</h5>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="type">class</span> <span class="class">PersonController</span> {

  <span class="annotation">@Autowired</span> PersonRepository repository;

  <span class="annotation">@RequestMapping</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/persons</span><span class="delimiter">&quot;</span></span>, method = RequestMethod.GET)
  HttpEntity&lt;PagedResources&lt;Person&gt;&gt; persons(<span class="predefined-type">Pageable</span> pageable,
    PagedResourcesAssembler assembler) {

    Page&lt;Person&gt; persons = repository.findAll(pageable);
    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(assembler.toResources(persons), HttpStatus.OK);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_querydsl_web_support_querydslpredicateargumentresolver">Querydsl web support  / QuerydslPredicateArgumentResolver.</h5>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">?firstname=Dave&amp;lastname=Matthews

=&gt;

QUser.user.firstname.eq(&quot;Dave&quot;).and(QUser.user.lastname.eq(&quot;Matthews&quot;))</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Przykład</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="type">class</span> <span class="class">UserController</span> {

  <span class="annotation">@Autowired</span> UserRepository repository;

  <span class="annotation">@RequestMapping</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>, method = RequestMethod.GET)
  <span class="predefined-type">String</span> index(Model model, <span class="annotation">@QuerydslPredicate</span>(root = User.class) <span class="predefined-type">Predicate</span> predicate,
          <span class="predefined-type">Pageable</span> pageable, <span class="annotation">@RequestParam</span> MultiValueMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; parameters) {

    model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>, repository.findAll(predicate, pageable));

    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>;
  }
}



<span class="type">interface</span> <span class="class">UserRepository</span> <span class="directive">extends</span> CrudRepository&lt;User, <span class="predefined-type">String</span>&gt;,
                                 QueryDslPredicateExecutor&lt;User&gt;,
                                 QuerydslBinderCustomizer&lt;QUser&gt; {

  <span class="annotation">@Override</span>
  <span class="keyword">default</span> <span class="directive">public</span> <span class="type">void</span> customize(QuerydslBindings bindings, QUser user) {

    bindings.bind(user.username).first((path, value) -&gt; path.contains(value))
    bindings.bind(<span class="predefined-type">String</span>.class)
      .first((StringPath path, <span class="predefined-type">String</span> value) -&gt; path.containsIgnoreCase(value));
    bindings.excluding(user.password);
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_envers">193. Envers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pozwala na zarządzanie historią zmian w bazie. Możemy traktować to jako narzędzie podobne do SVN&#8217;a czy Git&#8217;a</p>
</div>
<div class="sect2">
<h3 id="_konfiguracja_4">193.1. Konfiguracja</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
<span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
<span class="tag">&lt;artifactId&gt;</span>hibernate-envers<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;version&gt;</span>4.3.10.Final<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listener</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.envers.event.AuditEventListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post-insert</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;listener</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.envers.event.AuditEventListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post-update</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;listener</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.envers.event.AuditEventListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post-delete</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>@Audited</strong> = poziom klasy. Hibernate uaktywni audyt dla danej encji.
Jeśli obiekt encyjny będzie się zmieniał spowoduje to również zmiany w tabeli revision.</p>
</div>
<div class="paragraph">
<p><strong>NotAudited</strong> != @Audited</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Ćwiczenia">194. Ćwiczenia</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_tworzenie_prostego_szablonu_projektu_hibernate_only">194.1. Tworzenie prostego szablonu projektu : Hibernate only</h3>
<div class="literalblock">
<div class="content">
<pre>operowanie na obiektach  Session i SessionFactory oraz persistence.xml</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tworzenie_prostego_szablonu_projektu_jpa">194.2. Tworzenie prostego szablonu projektu : JPA</h3>
<div class="literalblock">
<div class="content">
<pre>operowanie na obiektach  EntityManager i EntityManagerFactory oraz persistence.xml</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tworzenie_prostego_szablonu_projektu_spring_spring_data">194.3. Tworzenie prostego szablonu projektu : Spring + Spring Data</h3>
<div class="literalblock">
<div class="content">
<pre>integracja Hibernate po JPA w Spring</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stworzenie_i_zapisanie_prostej_encji_oraz_jej_odczyt">194.4. Stworzenie i zapisanie prostej encji oraz jej odczyt</h3>

</div>
<div class="sect2">
<h3 id="_mapowania">194.5. Mapowania</h3>

</div>
<div class="sect2">
<h3 id="_metamodel_3">194.6. MetaModel</h3>

</div>
<div class="sect2">
<h3 id="_jpql">194.7. JPQL</h3>

</div>
<div class="sect2">
<h3 id="_pobieranie_danch_fetches">194.8. Pobieranie danch : Fetches</h3>

</div>
<div class="sect2">
<h3 id="_cache">194.9. Cache</h3>

</div>
<div class="sect2">
<h3 id="_criteria_api_3">194.10. Criteria API</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_koniec">195. Koniec :)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://undermineddeveloper.com/2013/09/11/hibernating/" class="bare">http://undermineddeveloper.com/2013/09/11/hibernating/</a></p>
</div>
<div class="paragraph">
<p>INFO
== info adoc</p>
</div>
<div class="dlist">
<div class="title">Built-in</div>
<dl>
<dt class="hdlist1">asciidoctor-version</dt>
<dd>
<p>1.5.2</p>
</dd>
<dt class="hdlist1">safe-mode-name</dt>
<dd>
<p>unsafe</p>
</dd>
<dt class="hdlist1">docdir</dt>
<dd>
<p>/home/przodownik/blog/springJpaKata/docs</p>
</dd>
<dt class="hdlist1">docfile</dt>
<dd>
<p>/home/przodownik/blog/springJpaKata/docs/hib_jpa_pl.adoc</p>
</dd>
<dt class="hdlist1">imagesdir</dt>
<dd>
<p>img</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Custom</div>
<dl>
<dt class="hdlist1">sourcedir</dt>
<dd>
<p>./src/main/java/</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-05-06 15:33:53 +02:00
</div>
</div>
</body>
</html>